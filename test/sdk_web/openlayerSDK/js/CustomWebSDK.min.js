var $jscomp={scope:{},inherits:function(C,b){function n(){}n.prototype=b.prototype;C.prototype=new n;C.prototype.constructor=C;for(var p in b)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(b,p);g&&Object.defineProperty(C,p,g)}else C[p]=b[p]}};(function(C){"object"===typeof exports&&"undefined"!==typeof module?module.exports=C():"function"===typeof define&&define.amd?define([],C):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Custom=C()})(function(){return function b(n,p,g){function e(d,c){if(!p[d]){if(!n[d]){var f="function"==typeof require&&require;if(!c&&f)return f(d,!0);if(a)return a(d,!0);f=Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",f;}f=p[d]={exports:{}};n[d][0].call(f.exports,function(a){var c=n[d][1][a];return e(c?c:a)},f,f.exports,b,n,p,g)}return p[d].exports}for(var a="function"==typeof require&&require,c=0;c<g.length;c++)e(g[c]);return e}({1:[function(b,n,p){OpenLayers.Kinetic.prototype.move=function(b){return function(){var e=Array.prototype.slice.call(arguments);b.apply(this,[e[0],function(a,c,d){d&&(a=Math.round(a),c=Math.round(c));e[1](a,c,d)}])}}(OpenLayers.Kinetic.prototype.move);OpenLayers.Handler.Drag.prototype.down=function(b){this.map.dragging&&(this.map.setCenter(this.map.getCenter()),this.map.dragging=!1)};OpenLayers.Tile.prototype.shouldDraw=function(b){return function(){return this.layer?b.apply(this):!1}}(OpenLayers.Tile.prototype.shouldDraw);if(window.ActiveXObject||"ActiveXObject"in window)String.prototype.startsWith=function(b){return null==b||""==b||0==this.length||b.length>this.length||this.substr(0,b.length)!=b?!1:!0},String.prototype.endsWith=function(b){return window.ActiveXObject||"ActiveXObject"in window?-1!==this.indexOf(b,this.length-b.length):this.endsWith(b)}},{}],2:[function(b,n,p){n.exports="jssdk_bate@ leaflet 2.0.5"},{}],3:[function(b,n,p){b=function(){this.otherDisplay=!0;this.layers=[];this.order=[]};b.prototype.addFilterLayer=function(b){this.layers.push(b)};b.prototype.removeFilterLayerById=function(b){for(var e=0;e<this.layers.length;e++)this.layers[e].id==b&&this.layers.splice(e,1)};n.exports=b},{}],4:[function(b,n,p){var g=b("./Filter");b=function(){g.call(this);this.id=null;this.filters={};this.filterStr=this.idFilter=null;this.display=!0};$jscomp.inherits(b,g);b.prototype.addFilterField=function(e,a){this.filters[e]=a};b.prototype.removeFilterField=function(e){delete this.filters[e]};n.exports=b},{"./Filter":3}],5:[function(b,n,p){n=n.exports={};b("./ext/OlExt");n.DataSource=b("./layer/datasource/DataSource");n.URLDataSource=b("./layer/datasource/URLDataSource");n.LocalDataSource=b("./layer/datasource/LocalDataSource");OpenLayers.Layer.GWVTAnno=b("./layer/label/GWVTAnno");n.Feature=b("./layer/label/feature/Feature");OpenLayers.Layer.GXYZ=b("./layer/vector/GXYZ");n.GServiceGroup=b("./layer/GServiceGroup")},{"./ext/OlExt":1,"./layer/GServiceGroup":6,"./layer/datasource/DataSource":7,"./layer/datasource/LocalDataSource":8,"./layer/datasource/URLDataSource":9,"./layer/label/GWVTAnno":10,"./layer/label/feature/Feature":20,"./layer/vector/GXYZ":21}],6:[function(b,n,p){b=function(b,e,a,c){this.url=this.label=this.layer=this.map=null;this.layerType=0;this.labelType=2;this.map=a;this.url=e;this.styleId=this.layerId=null;this.tileSize=256};b.prototype.addServiceGroup=function(){options&&options.styleId&&(this.styleId=options.styleId);options&&options.tileSize&&(this.tileSize=options.tileSize);switch(this.layerType){case 0:this.addBaseLayer();break;case 1:this.addFrontBaseLayer()}switch(this.labelType){case 2:this.addFrontLabel();break;case 3:this.AddImgLabel();break;case 4:this.addAvoidLabel()}};b.prototype.addBaseLayer=function(b){b=new OpenLayers.Size(this.tileSize,this.tileSize);this.layer=new OpenLayers.Layer.GXYZ(this.layerId,this.url+"\x26x\x3d${x}\x26y\x3d${y}\x26l\x3d${z}\x26tileType\x3d"+this.layerType,{sphericalMercator:!1,isBaseLayer:!0,tileSize:b});this.map.addLayers([this.layer])};b.prototype.addFrontBaseLayer=function(b){};b.prototype.AddImgLabel=function(){var b=new OpenLayers.Size(this.tileSize,this.tileSize);this.label=new OpenLayers.Layer.GXYZ(this.layerId+"_Label",this.url+"\x26x\x3d${x}\x26y\x3d${y}\x26l\x3d${z}\x26tileType\x3d"+this.labelType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:b});this.map.addLayers([this.label])};b.prototype.addAvoidLabel=function(b){this.label=new OpenLayers.Layer.GWVTAnno(this.url+"\x26x\x3d${x}\x26y\x3d${y}\x26l\x3d${z}\x26tileType\x3d"+this.labelType,{tileSize:this.tileSize,hitDetection:!0,keepBuffer:0,updateWhenZooming:!1});this.map.addLayers([this.label])};b.prototype.addFrontLabel=function(b){b=new OpenLayers.Size(this.tileSize,this.tileSize);this.label=new OpenLayers.Layer.GWVTAnno("GWVTanno",{tileSize:b});b=new Custom.URLDataSource;b.url=this.url+"\x26x\x3d${x}\x26y\x3d${y}\x26l\x3d${z}\x26tileType\x3d"+this.labelType;b.styleId=this.styleId;this.label.addDataSource(b);this.map.addLayers([this.label])};b.prototype.setLayerType=function(b){"Img"==b&&(this.layerType=0)};b.prototype.setLabelType=function(b){"Data"==b?this.labelType=2:"Img"==b&&(this.labelType=3)};b.prototype.setTileSize=function(b){this.tileSize=b};b.prototype.getLayer=function(){return this.layer};b.prototype.getLabel=function(){return this.label};b.prototype.removeGroupLayer=function(){this.layer&&this.map.removeLayer(this.layer);this.label&&this.map.removeLayer(this.label)};n.exports=b},{}],7:[function(b,n,p){var g=b("../../utils/UUID");n.exports=function(){this.id=(new g).valueOf();this.type="";this.textures={}}},{"../../utils/UUID":24}],8:[function(b,n,p){var g=b("./DataSource");b=function(){g.call(this);this.type="LocalDataSource";this.features=[];this.textureUrls={}};$jscomp.inherits(b,g);b.prototype.addFeature=function(e){this.features.push(e)};b.prototype.addTextureUrl=function(e,a){this.textureUrls[e]=a};b.prototype.removeTextureUrl=function(e){delete this.textureUrls[e]};b.prototype.loadTexture=function(){var e=new Deferred,a=0,c;for(c in this.textureUrls)a++;if(0==a)e.resolve();else{var d=0,f;for(f in this.textureUrls)c=new Image,c.name=f,c.onload=function(c){d++;this.textures[c.target.name]=c.target;d==a&&e.resolve()}.bind(this),c.src=this.textureUrls[f];return e}};b.prototype.removeFeatureById=function(e){for(var a=0;a<this.features.length;a++)this.features[a].id==e&&this.features.splice(a,1)};n.exports=b},{"./DataSource":7}],9:[function(b,n,p){var g=b("./DataSource");p=b("./../../utils/es6-promise");var e=p.Deferred,a=p.getJSON,c=b("../../ext/Version");b=function(){g.call(this);this.urlArray=[];this.type="URLDataSource";this.styleUrl=this.url=null;this.styleId="style";this.filter=null;this.textures={};this.sourceUrl=this.controlId=this.control=null;this.servername=this.host=""};$jscomp.inherits(b,g);b.prototype.loadStyle=function(d){var f=new e,h=new e,k=new e;this.parseUrl();this.sourceUrl||(this.sourceUrl=this.url+"\x26clientVersion\x3d"+c,this.url=this.url+"\x26clientVersion\x3d"+c);this.control&&this.isIE()?a({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control\x3d"+this.control,dataType:"json"}).then(function(a){this.controlId=a.id;this.url=this.sourceUrl+"\x26controlId\x3d"+a.id;f.resolve()}.bind(this)):(this.url=this.control?this.sourceUrl+"\x26control\x3d"+this.control:this.sourceUrl,f.resolve());d||(d="label");a({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/"+d+"/style.js",dataType:"text"}).then(function(a){this.styleFun=new Function("drawer","level",a);h.resolve()}.bind(this));a({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/label/texture.js",dataType:"text"}).then(function(a){a=JSON.parse(a);var d=0,c;for(c in a)d++;if(0==d)k.resolve();else{var f=0,h;for(h in a)c=new Image,c.name=h,c.onload=function(a){f++;this.textures[a.target.name]=a.target;f==d&&k.resolve()}.bind(this),c.src=a[h]}}.bind(this));return[f,h,k]};b.prototype.parseUrl=function(){var a=this.url.split("?"),c=a[0].split("/mapserver/");this.host=c[0];this.servername=c[1].split("/")[1];a=a[1].split("\x26");for(c=0;c<a.length;c++){var h=a[c].split("\x3d");if("styleId"==h[0]){this.styleId=h[1];break}}};b.prototype.setFilter=function(a){this.control=null;if(this.url&&a&&(0!=a.layers.length||0!=a.order.length)){for(var d=0;d<a.layers.length;d++)a.layers[d].id||a.layers.splice(d,1);this.control=JSON.stringify(a)}};b.prototype.getTexture=function(a){return this.textures[a]};b.prototype.addTexture=function(a,c){this.textures[a]=c};b.prototype.isIE=function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1};n.exports=b},{"../../ext/Version":2,"./../../utils/es6-promise":25,"./DataSource":7}],10:[function(b,n,p){var g=b("./draw/CanvasLayer");b=OpenLayers.Class(OpenLayers.Layer,{tileSize:256,hitDetection:!0,canvasLayer:null,initialize:function(e,a){OpenLayers.Layer.prototype.initialize.apply(this,[e,a]);this.options&&this.options.tileSize&&(this.tileSize=this.options.tileSize.w);this.options.hasOwnProperty("hitDetection")&&(this.hitDetection=this.options.hitDetection);this.canvasLayer=new g;this.canvasLayer.tileSize=this.tileSize;this.canvasLayer.hitDetection=this.hitDetection;this.animating=!1},onMapResize:function(){var e=this.map.getSize();this.canvasLayer.tileSize=this.tileSize;this.canvasLayer.gwvtAnno=this;this.canvasLayer.initCanvas(e.w,e.h);this.map.setCenter(this.map.getCenter())},moveTo:function(e,a,c){a&&this.canvasLayer.clean();this.animating=!1;OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=this.getGrid(e),f=this.map.getMaxExtent();this.canvasLayer.maxExtent=[f.left,f.bottom,f.right,f.top];this.canvasLayer.extent=[e.left,e.bottom,e.right,e.top];this.canvasLayer.res=this.map.getResolution();this.canvasLayer.requestLabelTiles(d,a)},getGrid:function(e){var a=this.map.getMaxExtent(),c=this.map.getResolution(),d=Math.floor((a.top-e.top)/(c*this.tileSize)),f=Math.ceil((a.top-e.bottom)/(c*this.tileSize)),h=Math.floor((e.left-a.left)/(c*this.tileSize));e=Math.ceil((e.right-a.left)/(c*this.tileSize));a=this.map.getZoom();for(c=[];h<e;h++)for(var k=d;k<f;k++)c.push({row:k,col:h,level:a});return c},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments);var a=this.map.getSize();this.canvasLayer.init(a.w,a.h,this.tileSize,this);this.div.appendChild(this.canvasLayer.root);this.map.events.register("movestart",this.map,function(){this.animating=!0}.bind(this));this.map.getExtent()&&this.moveTo(this.map.getExtent())},resetCanvasDiv:function(){this.div.style.margin="0px";this.canvasLayer.root.style.transform="translate("+-this.map.layerContainerDiv.offsetLeft+"px,"+-this.map.layerContainerDiv.offsetTop+"px)"},redraw:function(){this.canvasLayer&&this.canvasLayer.redraw()},addDataSource:function(e){this.canvasLayer.addDataSource(e)},removeDataSourceById:function(e){this.canvasLayer.removeDataSourceById(e)},addToMap:function(e){e.addLayer(this)},getFeatureByXY:function(e,a){return this.canvasLayer.getFeatureByXY(e,a)},setHasImportant:function(e){this.canvasLayer&&(this.canvasLayer.hasImportant=e)},getHasImportant:function(){return this.canvasLayer?this.canvasLayer.hasImportant:!0},CLASS_NAME:"OpenLayers.Layer.GWVTAnno"});n.exports=b},{"./draw/CanvasLayer":18}],11:[function(b,n,p){var g=b("./GGridIndex"),e=b("./GLabelBox");b=function(a,c){this.grid=null;this.GLabelBox=new e(a,c)};b.prototype.avoid=function(a,c){if(0==c.length)return a;for(var d=0;d<a.length;d++){var f=a[d];1==f.type&&this.avoidPointLine(f,c);2==f.type&&(f.isCollision=this.avoidLineLine(f,c))}return a};b.prototype.avoidPointLine=function(a,c){var d=a.style.direction;c=this.getAvoidLineFeatures(a.weight,c);for(var f=0,h=0;h<c.length;h++)for(var k=c[h],e=0;4>e;e++){var b=d+e;4<=b&&(b-=4);if(this.crashBoxLine(a.boxs[b],k.sourceDatas,!1)&&a.directions[b]&&(delete a.directions[b],f++,4==f))return!0}return!1};b.prototype.avoidLineLine=function(a,c){c=this.getAvoidLineFeatures(a.weight,c);for(var d=0;d<c.length;d++)for(var f=c[d],h,k=0;k<a.boxs.length;k++)if(h=this.crashPartLineLine(a.boxs[k],f.sourceDatas))return!0;return!1};b.prototype.getAvoidLineFeatures=function(a,c){for(var d=[],f=0;f<c.length;f++){var h=c[f];h.weight>a&&d.push(h)}return d};b.prototype.crashBoxLine=function(a,c,d){var f=[];d?(f.push([a[0],a[1],a[2],a[1]]),f.push([a[2],a[1],a[2],a[3]]),f.push([a[2],a[3],a[0],a[3]]),f.push([a[0],a[3],a[0],a[1]])):(f.push([a[0],a[1],a[2],a[3]]),f.push([a[2],a[1],a[0],a[3]]));for(a=0;a<f.length;a++){d=f[a];for(var h=0;h<c.length/2-1;h++)if(this.crashPartLinePartLine(d,[c[2*h],c[2*h+1],c[2*(h+1)],c[2*(h+1)+1]]))return!0}return!1};b.prototype.crashLineLine=function(a,c){for(var d=0;d<a.length/2-1;d++)for(var f=[a[2*d],a[2*d+1],a[2*(d+1)],a[2*(d+1)+1]],h=0;h<c.length/2-1;h++)if(this.crashPartLinePartLine(f,[c[2*h],c[2*h+1],c[2*(h+1)],c[2*(h+1)+1]]))return!0;return!1};b.prototype.crashPartLineLine=function(a,c){for(var d=0;d<c.length/2-1;d++)if(this.crashPartLinePartLine(a,[c[2*d],c[2*d+1],c[2*(d+1)],c[2*(d+1)+1]]))return!0;return!1};b.prototype.crashPartLinePartLine=function(a,c){var d=a[0],f=a[1],h=a[3],k=c[0],e=c[1],b=c[2],g=c[3],r,u;r=a[2]-d;h-=f;b-=k;u=g-e;g=r*u-b*h;if(0==g)return 0;var q=0<g,d=d-k,f=f-e;r=r*f-h*d;if(0>r==q)return 0;f=b*f-u*d;return 0>f==q||r>g==q||f>g==q?0:1};b.prototype.defaultAvoid=function(a,c){this.grid=new g(8192,16,0);if(null==a||1>a.length)return[];a=this.GLabelBox.setBox(a,!1);a=this.mergeFeatures(a);this.sort(a,c);for(var d=0;d<a.length;d++)this.avoidFeature(a[d]);a=this.GLabelBox.filterFeature(a);this.removeRepeat(a);return this.prevFeatures=a=this.filterFeature(a)};b.prototype.avoidFeature=function(a){0==a.style.show||1==a.hidden?a.hidden=!0:a.boxs?1==a.type?this.avoidPoint(a):a.isCollision?a.hidden=!0:this.avoidLine(a):a.hidden=!0};b.prototype.avoidPoint=function(a){if(1==a.style.isImportant)this.addBoxToCells(a.primaryId,a.boxs[a.style.direction]);else if(a.style.isFourDirections&&a.style.texture)this.addFourCollisionFeatureToCells(a,a.style.direction);else if(a.directions[a.style.direction]){var c=a.boxs[a.style.direction];this.isCollision(c)?a.hidden=!0:this.addBoxToCells(a.primaryId,c)}else a.hidden=!0};b.prototype.avoidLine=function(a){if(1==a.style.isImportant)for(var c=0;c<a.boxs.length;c++)this.addBoxToCells(a.primaryId+"index_"+c,a.boxs[c]);else{for(var c=!1,d=0;d<a.boxs.length;d++)if(this.isCollision(a.boxs[d])){c=!0;break}if(c)a.hidden=!0;else for(c=0;c<a.boxs.length;c++)this.addBoxToCells(a.primaryId+"index_"+c,a.boxs[c])}};b.prototype.addFourCollisionFeatureToCells=function(a,c){var d=!0,f=[];a.directions[c]&&(f=a.boxs[c],d=this.isCollision(f));d?(c++,4==c&&(c-=4),c==a.style.direction?a.hidden=!0:this.addFourCollisionFeatureToCells(a,c)):(a.style.textPoint=a.fourPoints[c],this.addBoxToCells(a.primaryId,f))};b.prototype.isCollision=function(a){return 0<this.grid.query(a[0],a[1],a[2],a[3]).length};b.prototype.addBoxToCells=function(a,c){this.grid.insert(a,c[0],c[1],c[2],c[3])};b.prototype.mergeFeatures=function(a){for(var c={},d=0;d<a.length;d++){var f=a[d];c[f.attributeId]||(c[f.attributeId]=[]);c[f.attributeId].push(f)}for(var h in c)if(d=c[h],1<d.length){f=d[0];if("1"==f.type){for(var k=d[0].directions,e=1;e<d.length;e++)k=this.getBothDirection(k,d[e].directions);var e=!1,b;for(b in k){e=!0;break}for(var g=0;g<d.length;g++)e?d[0].hidden=!0:d[0].directions=k}if("2"==f.type){f=!1;for(k=0;k<d.length;k++)if(1==d[k].isCollision){f=!0;break}if(f)for(f=0;f<d.length;f++)d[f].hidden=!0}}return this.GLabelBox.filterFeature(a)};b.prototype.sort=function(a,c){if(0<a.length)return a.sort(function(a,f){if(c){if(a.style.isImportant&&!f.style.isImportant)return-1;if(f.style.isImportant&&!a.style.isImportant)return 1}var d=a.weight,k=f.weight,e=a.primaryId,b=f.primaryId;d||(d=-1);k||(k=-1);return d<k?1:d==k?e<b?1:-1:-1}.bind(this))};b.prototype.getBothDirection=function(a,c){var d={},f;for(f in a)c[f]&&(d[f]=1);return d};b.prototype.removeRepeat=function(a){for(var c=[],d=[],f=[],e=[],k=[],b=[],l=0;l<a.length;l++){var g=a[l];1==g.type?1==g.drawed?e.push(g):c.push(g):2==g.type&&("text"==g.lineType&&(1==g.drawed?k.push(g):d.push(g)),"code"==g.lineType&&(1==g.drawed?b.push(g):f.push(g)))}for(a=0;a<c.length;a++)this.getShowPointFeatrues(e,c[a]);for(c=0;c<d.length;c++)this.getShowLineTextFeatrues(k,d[c]);for(d=0;d<f.length;d++)this.getShowLineCodeFeatrues(b,f[d]);if(this.prevFeatures)for(f=0;f<this.prevFeatures.length;f++)this.prevFeatures[f].drawed=!1};b.prototype.getShowPointFeatrues=function(a,c){for(var d=!1,f=0;f<a.length;f++){var e=a[f];e.label==c.label&&e.style.distance&&c.style.distance&&this.getDistance(e.style.textPoint,c.style.textPoint)<e.style.distance&&(d=!0,c.hidden=!0)}d||a.push(c)};b.prototype.getShowLineTextFeatrues=function(a,c){for(var d=!1,f=0;f<a.length;f++){var e=a[f];e.label==c.label&&e.style.lineTextDistance&&c.style.lineTextDistance&&this.getDistance(e.centerPoint,c.centerPoint)<e.style.lineTextDistance&&(d=!0,c.hidden=!0)}d||a.push(c)};b.prototype.getShowLineCodeFeatrues=function(a,c){for(var d=!1,f=0;f<a.length;f++){var e=a[f];e.label==c.label&&e.style.lineCodeDistance&&c.style.lineCodeDistance&&this.getDistance(e.centerPoint,c.centerPoint)<e.style.lineCodeDistance&&(d=!0,c.hidden=!0)}d||a.push(c)};b.prototype.getDistance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1];return Math.pow(d*d+f*f,.5)};b.prototype.filterFeature=function(a){for(var c=[],d=0;d<a.length;d++)a[d].hidden||(a[d].drawed=!0,c.push(a[d]));return c};n.exports=b},{"./GGridIndex":15,"./GLabelBox":16}],12:[function(b,n,p){var g=b("./GDistance"),e=b("./Util");b=function(){};b.cutLineFeature=function(a){var c=[],d;if(4>a.sourceData.length)return c;var f=this.createLineTextFeatrue(a,0);d=f.index;f.feature&&c.push(f.feature);f=this.createLineCodeFeatrue(a,d);d=f.index;f.feature&&c.push(f.feature);a=this.createLineArrowFeatrue(a,d);a.feature&&c.push(a.feature);return c};b.createLineTextFeatrue=function(a,c){var d=a.style,f=a.sourceData,h=new g,k=[],b=null;if(e.isNotNull(a.label)){a.label+="";for(var l=0;l<a.label.length+1;l++)k.push(1.2*d.lineHeight+2+d.gap);l=[].concat(k);k=h.getNodePath(f,k);h=k.pointList;if(1<h.length){c=k.index;var k=!1,t=a.label.length>h.length?h.length-1:a.label.length-1,r=[h[0][0][0],h[0][0][1]],u=h[t][0],q=e.getAngle(r,u),b=this.cloneFeature(a);b.angle=q;0!=d.changeDirection&&(k=this.isChangeDirection(a.label,r,u,q))&&(h=this.changeDirection(f,h,l,c,t));b.attributeId+="_text";b.sourceAngleData=h;b.lineType="text";h.length<a.label.length&&(c=a.sourceData.length,h.length>.5*a.label.length?this.delayTextPoint(f,h,a.label,d.chinaLabelWidth+d.gap,k):b=null)}else d.showRoadCode||(b=this.cloneFeature(a),b.attributeId+="_text",b.sourceAngleData=[[[f[0],f[1]],0]],b.lineType="text",c=2)}return{feature:b,index:c}};b.createLineCodeFeatrue=function(a,c){var d=a.style,f=a.sourceData,b=new g,k=[],m=null,l=a.roadCodeLabel;return d.showRoadCode&&e.isNotNull(l)&&c<f.length&&(d=f.slice(c,f.length-1),k.push(30),b=b.getNodePath(d,k),k=b.pointList,1==k.length&&(c+=b.index,m=this.cloneFeature(a),m.attributeId+="_code",m.sourceAngleData=k,m.lineType="code",m.label=l+""),0==k.length)?(m=this.cloneFeature(a),m.attributeId+="_code",m.sourceAngleData=[[f,0]],m.lineType="code",m.label=l+"",{feature:m,index:2}):{feature:m,index:c}};b.createLineArrowFeatrue=function(a,c){var d=a.style,f=a.sourceData,e=new g,k=[],b=null;d.showArrow&&c<f.length&&(d=f.slice(c,f.length-1),k.push(16),k.push(16),e=e.getNodePath(d,k).pointList,2==e.length&&(b=this.cloneFeature(a),b.attributeId+="_arrow",b.sourceAngleData=e,b.lineType="arrow"));return{feature:b,index:c}};b.delayTextPoint=function(a,c,d,f,e){a=1==c.length?e?[a[a.length-2],a[a.length-1]]:[a[0],a[1]]:c[c.length-2][0];e=c[c.length-1][0];for(var k=c[c.length-1][1],b=c.length,h=1;h<d.length-b+1;h++){var g=[this.getPoint(a,e,f*h),k];c.push(g)}};b.cloneFeature=function(a){return{type:a.type,datas:a.datas,sourceData:a.sourceData,label:a.label,roadCodeLabel:a.roadCodeLabel,attributeId:a.attributeId,style:a.style,textures:a.textures,xyz:a.xyz,lineType:a.lineType,weight:a.weight,attributes:a.attributes}};b.changeDirection=function(a,c,d,f,e){f=f>=a.length?a.length:f;f=a.slice(0,f);a=[];for(var k=0;k<f.length-1;k++)a.push([f[k],f[k+1]]),k++;a=a.reverse();c=c[e][0];f=[c[0],c[1]];for(c=0;c<a.length;c++)f.push(a[c][0]),f.push(a[c][1]);return c=(new g).getNodePath(f,d).pointList};b.isChangeDirection=function(a,c,d,f){var e=!1;if(/.*[\u4e00-\u9fa5]+.*$/.test(a)){if(c[0]==d[0]&&c[1]>d[1])return!0;-45>f&&-90<f?c[0]<d[0]&&(e=!0):c[0]>d[0]&&(e=!0)}else c[0]>d[0]&&(e=!0);return e};b.getDistance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1];return Math.pow(d*d+f*f,.5)};b.getLineDistance=function(a){if(4>a.length)return 0;for(var c=0,d=0;d<a.length/2-1;d++)c+=this.getDistance([a[2*d],a[2*d+1]],[a[2*(d+1)],a[2*(d+1)+1]]);return c};b.getPoint=function(a,c,d){var f=c[0]-a[0],e=c[1]-a[1];a=c[0];0==f?c=0<e?c[1]+d:c[1]-d:(d=Math.sqrt(d*d/(e/f*(e/f)+1)),0>f&&(d=-d),a=c[0]+d,c=c[1]+e/f*d);return[a,c]};n.exports=b},{"./GDistance":13,"./Util":17}],13:[function(b,n,p){b=function(){};b.prototype.getLengthPoint=function(b,e,a,c,d,f){var h=a-b;c-=e;if(0==h)return b=a,e=0<c?e+d:e-d,null==f?[b,e]:[b,e,f];a=c/h;d=Math.abs(d/Math.sqrt(a*a+1));a=Math.abs(d*a);b=0<h?b+d:b-d;e=0<c?e+a:e-a;return null==f?[b,e]:[b,e,f]};b.prototype.getAngle=function(b,e){return 0==e[0]-b[0]?e[1]>b[0]?90:-90:360*Math.atan((e[1]-b[1])/(e[0]-b[0]))/(2*Math.PI)};b.prototype.length=function(b,e,a,c){b=a-b;e=c-e;return Math.sqrt(b*b+e*e)};b.prototype.getNodePath=function(b,e){for(var a=[],c={},d=[],f=e.length,h=function(a){var d=a[0];a.splice(0,1);return d},k=h(e),m=0;;){if(d.length==f||m>=b.length)return c.index=m,c.pointList=d,c;var l=b[m],g=b[m+1];if(0==a.length)a[0]=l,a[1]=g;else{var r=this.length(a[0],a[1],l,g);r>=k?(k=this.getLengthPoint(a[0],a[1],l,g,k,null),l=this.getAngle(a,[l,g]),90==l&&(l=0),-90==l&&(l=0),0==l&&(l=.5),45<=l?l-=90:-45>=l&&(l+=90),d.push([k,l]),a[0]=k[0],a[1]=k[1],k=h(e)):(k-=r,a[0]=l,a[1]=g,m+=2)}}};n.exports=b},{}],14:[function(b,n,p){p=b("../../../utils/gistools/BoxSet");var g=new p(0,512,0,512,512,5),e=new p(0,256,0,256,256,5),a=b("../../../utils/gistools/GisTools"),c=b("./Util");b=function(){};b.draw=function(a,c,e,k,b,l,g){var d=null;k&&(d=new Map);for(k=0;k<c.length;k++){var f=c[k];1==f.type?(this.drawPointIcon(a,f,e,d,l,g),this.drawPoint(a,f,e,d,b,l,g)):2==f.type&&this.drawLine(a,f,e,d,b,l,g)}};b.drawPointIcon=function(a,c,e,k,b,l){var d=c.style;if(d.texture){var f=d.graphicWidth,h=d.graphicHeight,m=c.iconImg;if(m){f&&h||(f=m.width,h=m.height,k&&(f/=e,h/=e));var g=d.graphicXOffset-.5*f,n=d.graphicYOffset-.5*h,p=d.pointOffsetX,v=d.pointOffsetY;p||(p=0);v||(v=0);var x=[c.datas[0][0][0],c.datas[0][0][1]];x[0]+=p;x[1]+=v;g=x[0]+g;n=x[1]+n;x=d.pointFillAlpha||1;if(k)if(d=d.texture+"_"+g+"_"+n,null==k.get(d))k.set(d,!0);else return;a.save();a.globalAlpha=x;a.drawImage(m,g*e,n*e,f*e,h*e);a.restore();l&&(b.save(),this.setHitContextStyle(b,c.id),b.fillRect(g,n,f,h),b.restore())}}};b.drawPoint=function(d,f,e,k,b,l,g){if(f.label){var h=f.style,m=h.textPoint;if(k){var t=a.boxToPolyArr(f.box[0],f.box[1],f.box[2],f.box[3]),w;512==d.canvas.width/e?w=a.boxToPolyArr(-20,-20,532,532):256==d.canvas.width/e&&(w=a.boxToPolyArr(-15,-15,271,271));if(3==a.polyWith(w,t))return;t=f.label+"_"+m[0]+"_"+m[1];if(null==k.get(t))k.set(t,!0);else return}k=f.label.split(" ");t=k.length;w=h.pointHeight;w+=2;var n=c.formatFont(h.pointFillFont,e,b);b=c.formatFont(h.pointStrokeFont,e,b);if(1==h.pointHashBackground){d.save();d.globalAlpha=h.pointBackgroundAlpha;d.strokeStyle=h.pointBackgroundLineColor;d.lineWidth=h.pointBackgroundLineWidth;d.fillStyle=h.pointBackgroundColor;d.font=h.pointFillFont;for(var p=m[0]-h.pointBackgroundGap,v=m[1]-h.pointBackgroundGap-h.pointHeight/2,x=0,z=0;z<t;z++){var y=d.measureText(k[z]).width;y>x&&(x=y)}this.drawRoundRect(d,p,v,x+2*h.pointBackgroundGap,h.pointHeight*t+2*h.pointBackgroundGap+2*(t-1),h.pointBackgroundRadius,e);d.fill();d.restore();for(z=0;z<t;z++)1==h.pointHashOutline&&(d.save(),d.textBaseline="middle",d.globalAlpha=h.pointStrokeAlpha,d.strokeStyle=h.pointStrokeStyle,d.lineWidth=h.pointLineWidth,d.font=b,d.strokeText(k[z],m[0]*e,(m[1]+w*z)*e),d.restore()),d.save(),d.textBaseline="middle",d.globalAlpha=h.pointFillAlpha,d.fillStyle=h.pointFillStyle,d.font=n,d.fillText(k[z],m[0]*e,(m[1]+w*z)*e),d.restore();g&&(l.save(),this.setHitContextStyle(l,f.id),this.drawHitRoundRect(l,p,v,x+2*h.pointBackgroundGap,h.pointHeight+2*h.pointBackgroundGap,h.pointBackgroundRadius),l.fill(),l.restore())}else{for(v=p=0;v<t;v++)1==h.pointHashOutline&&(d.save(),d.textBaseline="middle",d.globalAlpha=h.pointStrokeAlpha,d.strokeStyle=h.pointStrokeStyle,d.lineWidth=h.pointLineWidth,d.font=b,d.strokeText(k[v],m[0]*e,(m[1]+w*v)*e),d.restore()),d.save(),d.textBaseline="middle",d.globalAlpha=h.pointFillAlpha,d.fillStyle=h.pointFillStyle,d.font=n,d.fillText(k[v],m[0]*e,(m[1]+w*v)*e),p=d.measureText(k[v]).width>p?d.measureText(k[v]).width:p,d.restore();g&&(l.save(),this.setHitContextStyle(l,f.id),l.textBaseline="middle",l.fillRect(m[0],m[1]-h.pointHeight/2,p,w*t),l.restore())}}};b.drawLine=function(a,c,e,k,b,l,g){"text"==c.lineType&&this.drawLineText(a,c,e,k,b,l,g);"code"==c.lineType&&this.drawLineCode(a,c,e,k,b,l,g);"arrow"==c.lineType&&this.drawLineArrow(a,c,e,k,l,g)};b.drawLineText=function(a,f,b,k,m,l,t){var d=f.style,h=f.label,q=f.textPoints,w;k&&(512==a.canvas.width/b?w=g:256==a.canvas.width/b&&(w=e));var n=c.formatFont(d.lineFillFont,b,m),p=c.formatFont(d.lineStrokeFont,b,m);if(1==d.lineHashBackground||1==q.length)k=q[Math.floor(q.length/2)][0],1==q.length?this.drawBgText(a,h,b,k,d.backgroundAlpha,d.backgroundLineColor,d.backgroundLineWidth,d.backgroundColor,d.lineFillFont,d.lineBackgroundGap,d.lineHeight,d.lineBackgroundRadius,d.lineHashOutline,d.lineStrokeAlpha,d.lineStrokeStyle,d.lineLineWidth,d.lineStrokeFont,d.lineFillAlpha,d.lineFillStyle,l,t,f.id,!1,m):this.drawBgText(a,h,b,k,d.backgroundAlpha,d.backgroundLineColor,d.backgroundLineWidth,d.backgroundColor,d.lineFillFont,d.lineBackgroundGap,d.lineHeight,d.lineBackgroundRadius,d.lineHashOutline,d.lineStrokeAlpha,d.lineStrokeStyle,d.lineLineWidth,d.lineStrokeFont,d.lineFillAlpha,d.lineFillStyle,l,t,f.id,!0,m);else for(m=0;m<h.length;m++){var v=q[m],x=v[1],v=v[0],z=h.charAt(m);if(k){var y=z+"_"+v[0]+"_"+v[1]+"_"+x;if(null!=k.get(y))continue;k.set(y,!0);if(!w["in"]([v[0]/b,v[1]/b]))continue}1==d.lineHashOutline&&(a.save(),a.textAlign="center",a.textBaseline="middle",a.globalAlpha=d.lineStrokeAlpha,a.strokeStyle=d.lineStrokeStyle,a.lineWidth=d.lineLineWidth,a.font=p,a.translate(v[0]*b,v[1]*b),a.rotate(x*Math.PI/180),a.strokeText(z,0,0),a.restore());a.save();a.textAlign="center";a.textBaseline="middle";a.globalAlpha=d.lineFillAlpha;a.fillStyle=d.lineFillStyle;a.font=n;a.translate(v[0]*b,v[1]*b);a.rotate(x*Math.PI/180);a.fillText(z,0,0);a.restore();t&&(l.save(),this.setHitContextStyle(l,f.id),l.translate(v[0],v[1]),l.rotate(x*Math.PI/180),l.fillRect(.6*-d.lineHeight,.6*-d.lineHeight,1.2*d.lineHeight,1.2*d.lineHeight),l.restore())}};b.drawLineCode=function(a,c,e,b,m,l,g){b=c.style;var d=c.codePoint,f=c.label;1==b.showRoadCode&&f&&0<f.length&&this.drawBgText(a,f,e,d,b.codeBackgroundAlpha,b.codeBackgroundLineColor,b.codeBackgroundLineWidth,b.codeBackgroundColor,b.codeLineFillFont,b.codeLineBackgroundGap,b.codeLineHeight,b.codeLineBackgroundRadius,b.codeLineHashOutline,b.codeLineStrokeAlpha,b.codeLineStrokeStyle,b.codeLineLineWidth,b.codeLineStrokeFont,b.codeLineFillAlpha,b.codeLineFillStyle,l,g,c.id,!0,m)};b.drawLineArrow=function(a,c,e,b,m,l){b=c.arrowPoint;m=c.style;c=b[0][0];b=b[1][0];a.save();a.lineWidth=2;a.strokeStyle="#666666";a.fillStyle="#666666";a.beginPath();a.moveTo(c[0]*e,c[1]*e);a.lineTo(b[0]*e,b[1]*e);a.stroke();0==m.arrowDirectionValue?(m=Math.atan((b[1]-c[1])/(b[0]-c[0])),m+=(b[0]>c[0]?-90:90)*Math.PI/180,this.drawArrowhead(a,c[0],c[1],m,e)):(m=Math.atan((b[1]-c[1])/(b[0]-c[0])),m+=(b[0]>c[0]?90:-90)*Math.PI/180,this.drawArrowhead(a,b[0],b[1],m,e));a.restore()};b.drawArrowhead=function(a,c,b,e,m){a.beginPath();a.translate(c*m,b*m);a.rotate(e);a.moveTo(0,0);a.lineTo(3*m,6*m);a.lineTo(0,5);a.lineTo(-3*m,6*m);a.closePath();a.fill()};b.drawRoundRect=function(a,c,b,e,m,l,g){a.beginPath();a.arc((c+l)*g,(b+l)*g,l*g,Math.PI,3*Math.PI/2);a.lineTo((e-l+c)*g,b*g);a.arc((e-l+c)*g,(l+b)*g,l*g,3*Math.PI/2,2*Math.PI);a.lineTo((e+c)*g,(m+b-l)*g);a.arc((e-l+c)*g,(m-l+b)*g,l*g,0,1*Math.PI/2);a.lineTo((l+c)*g,(m+b)*g);a.arc((l+c)*g,(m-l+b)*g,l*g,1*Math.PI/2,Math.PI);a.closePath()};b.drawBgText=function(a,b,e,k,g,l,t,r,u,q,w,n,p,v,x,z,y,A,K,D,O,P,U,F){a.save();a.globalAlpha=g;a.strokeStyle=l;a.lineWidth=t;a.fillStyle=r;a.font=c.formatFont(u,1,F);g=a.measureText(b).width;l=k[0]-g/2-q;t=k[1]-w/2-q;U&&(this.drawRoundRect(a,l,t,g+2*q,w+2*q,n,e),a.fill());a.restore();u=c.formatFont(u,e,F);y=c.formatFont(y,e,F);1==p&&(a.save(),a.textAlign="center",a.textBaseline="middle",a.globalAlpha=v,a.strokeStyle=x,a.lineWidth=z,a.font=y,a.translate(k[0]*e,k[1]*e),a.strokeText(b,0,0),a.restore());a.save();a.textAlign="center";a.textBaseline="middle";a.globalAlpha=A;a.fillStyle=K;a.font=u;a.translate(k[0]*e,k[1]*e);a.fillText(b,0,0);a.restore();O&&(D.save(),this.setHitContextStyle(D,P),this.drawHitRoundRect(D,l,t,g+2*q,w+2*q,n),D.fill(),D.restore())};b.featureIdToHex=function(a){a="000000"+(Number(a)+1).toString(16);var c=a.length;return a="#"+a.substring(c-6,c)};b.setHitContextStyle=function(a,c){var d=this.featureIdToHex(c);a.globalAlpha=1;a.fillStyle=d};b.drawHitRoundRect=function(a,c,b,e,g,l){a.beginPath();a.arc(c+l,b+l,l,Math.PI,3*Math.PI/2);a.lineTo(e-l+c,b);a.arc(e-l+c,l+b,l,3*Math.PI/2,2*Math.PI);a.lineTo(e+c,g+b-l);a.arc(e-l+c,g-l+b,l,0,1*Math.PI/2);a.lineTo(l+c,g+b);a.arc(l+c,g-l+b,l,1*Math.PI/2,Math.PI);a.closePath()};n.exports=b},{"../../../utils/gistools/BoxSet":26,"../../../utils/gistools/GisTools":27,"./Util":17}],15:[function(b,n,p){function g(a,c,d){var b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var h=new Int32Array(this.arrayBuffer);a=h[0];c=h[1];d=h[2];this.d=c+2*d;for(var k=0;k<this.d*this.d;k++){var g=h[e+k],l=h[e+k+1];b.push(g===l?null:h.subarray(g,l))}k=h[e+b.length+1];this.keys=h.subarray(h[e+b.length],k);this.bboxes=h.subarray(k);this.insert=this._insertReadonly}else{this.d=c+2*d;for(h=0;h<this.d*this.d;h++)b.push([]);this.keys=[];this.bboxes=[]}this.n=c;this.extent=a;this.padding=d;this.scale=c/a;this.uid=0;c=d/c*a;this.min=-c;this.max=a+c}n.exports=g;var e=3;g.prototype.insert=function(a,c,d,b,e){this._forEachCell(c,d,b,e,this._insertCell,this.uid++);this.keys.push(a);this.bboxes.push(c);this.bboxes.push(d);this.bboxes.push(b);this.bboxes.push(e)};g.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer.";};g.prototype._insertCell=function(a,c,d,b,e,k){this.cells[e].push(k)};g.prototype.query=function(a,c,d,b){var e=this.min,f=this.max;if(a<=e&&c<=e&&f<=d&&f<=b)return Array.prototype.slice.call(this.keys);e=[];this._forEachCell(a,c,d,b,this._queryCell,e,{});return e};g.prototype._queryCell=function(a,c,d,b,e,k,g){e=this.cells[e];if(null!==e)for(var f=this.keys,h=this.bboxes,m=0;m<e.length;m++){var u=e[m];if(void 0===g[u]){var q=4*u;a<=h[q+2]&&c<=h[q+3]&&d>=h[q+0]&&b>=h[q+1]?(g[u]=!0,k.push(f[u])):g[u]=!1}}};g.prototype._forEachCell=function(a,c,d,b,e,k,g){for(var f=this._convertToCellCoord(a),h=this._convertToCellCoord(c),m=this._convertToCellCoord(d),u=this._convertToCellCoord(b);f<=m;f++)for(var q=h;q<=u;q++)if(e.call(this,a,c,d,b,this.d*q+f,k,g))return};g.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))};g.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,c=e+this.cells.length+1+1,d=0,b=0;b<this.cells.length;b++)d+=this.cells[b].length;d=new Int32Array(c+d+this.keys.length+this.bboxes.length);d[0]=this.extent;d[1]=this.n;d[2]=this.padding;for(b=0;b<a.length;b++){var g=a[b];d[e+b]=c;d.set(g,c);c+=g.length}d[e+a.length]=c;d.set(this.keys,c);c+=this.keys.length;d[e+a.length+1]=c;d.set(this.bboxes,c);return d.buffer}},{}],16:[function(b,n,p){var g=b("./Util");b=function(b,a){this.boxDistance=0;this.ctx=b;this.formatFont=a};b.prototype.setBox=function(b,a){b.forEach(function(c,d){c.hidden=!1;c.label=g.formatLabel(c.label);0==c.style.show?c.hidden=!0:(1==c.type&&(a?this.setPointBox(c,c.sourceAngleData,this.ctx):this.setPointBox(c,c.datas,this.ctx)),2==c.type&&("text"==c.lineType&&(a?this.setTextLineBox(c,c.sourceAngleData,this.ctx):this.setTextLineBox(c,c.datas,this.ctx)),"code"==c.lineType&&(a?this.setCodeLineBox(c,c.sourceAngleData,this.ctx):this.setCodeLineBox(c,c.datas,this.ctx)),"arrow"==c.lineType&&(a?this.setArrowLineBox(c,c.sourceAngleData):this.setArrowLineBox(c,c.datas))))}.bind(this));return this.filterFeature(b)};b.prototype.setPointBox=function(b,a,c){var d=b.style,e,h,k=d.graphicWidth,m=d.graphicHeight;(e=b.iconImg)?k&&m||(k=e.width,m=e.height):m=k=0;e=k;h=m;if(d.labelFunction){var l=new Function("label",d.labelFunction);try{b.label=l.call({},b.label)}catch(u){console.warn(b.label+": \u8c03\u7528labelFunction\u5931\u8d25!")}}if((l=g.isNotNull(b.label))||0!=k&&0!=m){if(l){b.label+="";h=b.label.split(" ");e=0;c.save();c.font=this.formatFont?g.formatFont(d.pointFillFont,1,!0):d.pointFillFont;for(l=0;l<h.length;l++){var t=c.measureText(h[l]).width;e=t>e?t:e}c.restore();h=d.pointHeight*h.length+2*(h.length-1);h=h>m?h:m}c=d.pointOffsetX;l=d.pointOffsetY;c||(c=0);l||(l=0);a=[a[0][0][0],a[0][0][1]];a[0]+=c;a[1]+=l;1!=d.pointHashBackground&&(d.pointBackgroundGap=0);if(0==m||0==k)d.graphicDistance=0;c=[a[0]-.5*k,a[1]-d.pointBackgroundGap-.5*h,a[0]+.5*k+d.graphicDistance+e+2*d.pointBackgroundGap,a[1]+.5*h+d.pointBackgroundGap];var l=[a[0]-.5*k-d.graphicDistance-e-2*d.pointBackgroundGap,c[1],a[0]+.5*k,c[3]],t=[a[0]-.5*e-d.pointBackgroundGap,a[1]-.5*m,a[0]+.5*e+d.pointBackgroundGap,a[1]+.5*m+d.graphicDistance+2*d.pointBackgroundGap+h],r=[t[0],a[1]-d.graphicDistance-2*d.pointBackgroundGap-h-.5*m,t[2],a[1]+.5*m];c=this.boxScale(c,d.pointBoxDisance);l=this.boxScale(l,d.pointBoxDisance);t=this.boxScale(t,d.pointBoxDisance);r=this.boxScale(r,d.pointBoxDisance);c=[c,l,t,r];d.direction||(d.direction=0);b.boxs=c;b.box=c[d.direction];c=m;d.pointHeight>m&&(c=d.pointHeight);l=[a[0]-.5*e,a[1]+d.graphicDistance+d.pointBackgroundGap+.5*c+.5*m];k=[[a[0]+.5*k+d.graphicDistance+d.pointBackgroundGap,a[1]-.5*h+.5*c],[a[0]-.5*k-d.graphicDistance-d.pointBackgroundGap-e,a[1]-.5*h+.5*c],l,[l[0],a[1]-d.graphicDistance-d.pointBackgroundGap-h+.5*c-.5*m]];b.fourPoints=k;b.style.textPoint=k[d.direction]}else b.hidden=!0};b.prototype.setTextLineBox=function(b,a,c){var d=b.label;if(0==a.length)b.hidden=!0;else{var e=b.style;b.textPoints=a;var h=[];if(1==e.lineHashBackground||1==a.length){var k=a[0][0];1<a.length&&(k=a[Math.floor(d.length/2)][0]);c.save();c.font=this.formatFont?g.formatFont(e.lineFillFont,1,!0):e.lineFillFont;a=c.measureText(b.label).width;c.restore();a=[k[0]-a/2-e.lineBackgroundGap,k[1]-.5*e.lineHeight-e.lineBackgroundGap,k[0]+a/2+e.lineBackgroundGap,k[1]+.5*e.lineHeight+e.lineBackgroundGap];this.boxScale(a,e.lineTextBoxDisance);h.push(a)}else{if(e.lineTextRotate)for(c=0;c<a.length;c++)a[c][1]=e.lineTextRotate;else if(this.textToSameBearing(b.angle,a),!e.isImportant&&this.isMessy(a,e,d)){b.hidden=!0;return}if(e=this.getLineBoxs(d,a,e))h=h.concat(e);else{b.hidden=!0;return}}b.boxs=h}};b.prototype.setCodeLineBox=function(b,a,c){if(0==a.length)b.hidden=!0;else{var d=b.style;a=a[0][0];c.save();c.font=this.formatFont?g.formatFont(d.codeLineFillFont,1,!0):d.codeLineFillFont;var e=c.measureText(b.label).width;c.restore();c=[a[0]-e/2-d.codeLineBackgroundGap,a[1]-.5*d.codeLineHeight-d.codeLineBackgroundGap,a[0]+e/2+d.codeLineBackgroundGap,a[1]+.5*d.codeLineHeight+d.codeLineBackgroundGap];this.boxScale(c,d.lineCodeBoxDisance);b.boxs=[c];b.codePoint=a}};b.prototype.setArrowLineBox=function(b,a){if(2!=a.length)b.hiden=!0;else{var c=a[0][0],d=a[1][0],c=[c[0]<d[0]?c[0]:d[0],c[1]<d[1]?c[1]:d[1],c[0]>d[0]?c[0]:d[0],c[1]>d[1]?c[1]:d[1]];this.boxScale(c,b.style.lineArrowBoxDisance);b.boxs=[c];b.arrowPoint=a}};b.prototype.filterFeature=function(b){for(var a=[],c=0;c<b.length;c++)b[c].hidden||a.push(b[c]);return a};b.prototype.isMessy=function(b,a,c){for(var d=b[0][0],e=d[0],g=d[1],k=d[0],d=d[1],m=b[0][1],l=b[0][1],t=0;t<c.length;t++){var r=b[t][0],u=b[t][1];r[0]>k&&(k=r[0]);r[0]<e&&(e=r[0]);r[1]>d&&(d=r[1]);r[1]<g&&(g=r[1]);u>l&&(l=u);u<m&&(m=u)}if(l-m>a.angle)if(0==a.angleSwitch&&a.angleColor)a.lineFillStyle=a.angleColor;else return!0;return!1};b.prototype.getLineBoxs=function(b,a,c){for(var d=[],e=[],g=0;g<b.length;g++){var k=a[g][0];0==a[g][1]&&(a[g][1]=.5);var m=[k[0]-.6*c.lineHeight,k[1]-.6*c.lineHeight,k[0]+.6*c.lineHeight,k[1]+.6*c.lineHeight];this.boxScale(m,c.lineTextBoxDisance);e.push([k[0]-.5*c.lineHeight,k[1]-.6*c.lineHeight,k[0]+.5*c.lineHeight,k[1]+.5*c.lineHeight]);d.push(m)}if(!c.isImportant)for(b=0;b<e.length-1;b++)for(a=e[b],c=b+1;c<e.length;c++)if(this.crashBox(a,e[c]))return null;return d};b.prototype.crashBox=function(b,a){return b[0]<=a[2]&&b[2]>=a[0]&&b[1]<=a[3]&&b[3]>=a[1]};b.prototype.boxScale=function(b,a){a||(a=this.boxDistance);b[0]-=.5*a;b[1]-=.5*a;b[2]+=.5*a;b[3]+=.5*a;return b};b.prototype.textToSameBearing=function(b,a){45<=b?b-=90:-45>=b&&(b+=90);for(var c=0;c<a.length;c++){var d=a[c][1],e=b-d;45<e&&(a[c][1]=d+90);-45>e&&(a[c][1]=d-90)}};n.exports=b},{"./Util":17}],17:[function(b,n,p){b=function(){};b.getRealLength=function(b){for(var e=b.length,a=0,c=0;c<e;c++)var d=b.charCodeAt(c),a=0<=d&&128>=d?a+.5:a+1;return a};b.isNotNull=function(b){return!b&&0!=b||"string"==typeof b&&(b=b.toLowerCase(),""==b||"undefined"==b||"null"==b)?!1:!0};b.formatFont=function(b,e,a){var c=b;a&&(b=b.split(" "),b[b.length-1]="SimHei",c=b.join(" "));return c.replace(/(\d+\.?\d*)(px|em|rem|pt)/g,function(a,c,b){c=12>c?12*e:Math.round(c)*e;return c+b})};b.formatLabel=function(b){b&&0<b.length&&(b=b.replace(/([\x00-\x1f\x7f])/g,""),b=b.replace(/(\s*$)/g,""),b=b.replace(/<br\/>/g,""));return b};b.getAngle=function(b,e){return 0==e[0]-b[0]?e[1]>b[0]?90:-90:360*Math.atan((e[1]-b[1])/(e[0]-b[0]))/(2*Math.PI)};n.exports=b},{}],18:[function(b,n,p){var g=b("../../../utils/Cache"),e=b("../avoid/GDrawGeomerty");p=b("./../../../utils/es6-promise");var a=p.Promise,c=p.getParamJSON,d=b("./LabelDrawer"),f=b("./../avoid/GAnnoAvoid"),h=b("./../avoid/GCutLine");b=function(){this.height=this.width=0;this.grid=[];this.cache=new g(256);this.gwvtAnno=null;this.dataSource=[];this.isReady=!1;this.maxExtent=[];this.extent=[];this.res=0;this.tileSize=256;this.hitDetection=!1;this.features=[];this.requestingTiles={};this.hasImportant=!0;this.ratio=1;var a=document.createElement("CANVAS").getContext("2d",{isQuality:!0});this.GAnnoAvoid=new f(a,!1)};b.prototype.init=function(a,c,b,d){this.tileSize=b;this.gwvtAnno=d;this.initCanvas(a,c);this.loadResources()};b.prototype.loadResources=function(){if(0==this.dataSource.length)this.isReady=!1;else{this.cache.clean();for(var c=[],b=0;b<this.dataSource.length;b++){var d=this.dataSource[b];"URLDataSource"==d.type&&(c=c.concat(d.loadStyle()));"LocalDataSource"==d.type&&(c=c.concat(d.loadTexture()))}0<c.length?a.all(c).then(function(){this.isReady=!0;0<this.grid.length&&this.requestLabelTiles(this.grid)}.bind(this)):this.isReady=!0}};b.prototype.initCanvas=function(a,c){this.width=a;this.height=c;this.root||(this.root=document.createElement("canvas"));this.root.style.width=this.width+"px";this.root.style.height=this.height+"px";this.root.width=this.width*this.ratio;this.root.height=this.height*this.ratio;this.root.id="labelCanvas";this.canvas=this.root.getContext("2d",{isQuality:!0});this.hitDetection&&(this.hitCanvas||(this.hitCanvas=document.createElement("canvas")),this.hitCanvas.style.width=this.width+"px",this.hitCanvas.style.height=this.height+"px",this.hitCanvas.width=this.width,this.hitCanvas.height=this.height,this.hitContext=this.hitCanvas.getContext("2d",{isQuality:!0}))};b.prototype.addDataSource=function(a){"URLDataSource"==a.type&&(a.url=a.url+"\x26tilesize\x3d"+this.tileSize);"URLDataSource"!=a.type&&"LocalDataSource"!=a.type||this.dataSource.push(a)};b.prototype.removeDataSourceById=function(a){for(var c=0;c<this.dataSource.length;c++)if(this.dataSource[c].id==a){this.dataSource.splice(c,1);break}};b.prototype.getDataSourceById=function(a){for(var c=0;c<this.dataSource.length;c++)if(this.dataSource[c].id==a)return this.dataSource[c]};b.prototype.clean=function(){this.canvas.clearRect(0,0,this.width*this.ratio,this.height*this.ratio);this.hitContext&&this.hitContext.clearRect(0,0,this.width,this.height)};b.prototype.redraw=function(){0!=this.grid.length&&(this.cache.clean(),this.loadResources())};b.prototype.requestLabelTiles=function(a,c){this.grid=a;if(this.isReady){var b=this.getRequestTileUrls(a);this.sendRequest(b)}};b.prototype.getLocalLabelDatas=function(){for(var a=[],c=0;c<this.dataSource.length;c++){var b=this.dataSource[c];if("LocalDataSource"==b.type)for(var d=0;d<b.features.length;d++){var e=b.features[d];e.inBounds(this.extent)&&(1==e.type&&(e.sourceAngleData=[[e.sourceData,0]],e.transformData(this.extent,this.res),e.label=e.getFeatureLabel(),e.textures=b.textures,a.push(e)),2==e.type&&(e.label=e.getFeatureLabel(),e.textures=b.textures,a=a.concat(this.cutLineFeature(e,!0))))}}return a};b.prototype.getRequestTileUrls=function(a){this.hitCacheUrls=[];this.currentTileDatas=[];for(var c={},b={},d=0;d<this.dataSource.length;d++){var e=this.dataSource[d];if("URLDataSource"==e.type)for(var f=e.url,k=0;k<a.length;k++){var g=a[k],h=f.replace("${x}",g.col).replace("{x}",g.col),h=h.replace("${y}",g.row).replace("{y}",g.row),h=h.replace("${z}",g.level).replace("{z}",g.level);if(0<e.urlArray.length)var n=e.urlArray[Math.round(Math.random()*(e.urlArray.length-1))],h=h.split("/mapserver")[1],h=n+"/mapserver"+h;this.cache.getItem(h)?this.hitCacheUrls.push(h):this.requestingTiles[h]?b[h]=!0:c[h]={url:h,xyz:g,dataSourceId:e.id,dataType:"json"}}}this.cancelRequest(b);return c};b.prototype.cancelRequest=function(a){for(var c in this.requestingTiles)if(!a[c]){var b=this.requestingTiles[c];delete this.requestingTiles[c];b.xhr.abort();b.requestItem.cancel=!0}};b.prototype.sendRequest=function(a){var b=0,d;for(d in a){var e=a[d],f=c(e);this.requestingTiles[e.url]={xhr:f.xhr,requestItem:e};f.then(this.tileSuccessFunction.bind(this),this.tileFailFunction.bind(this));b++}0==b&&this.sendSuccess([])};b.prototype.tileSuccessFunction=function(a){if(1!=a.param.cancel){var c=a.param.url;delete this.requestingTiles[c];a=this.parseFeature(a);var b=this.GAnnoAvoid.GLabelBox.setBox(a.labelFeatures,a.avoidLineFeatures,!0),b=this.GAnnoAvoid.avoid(b,a.avoidLineFeatures);this.currentTileDatas.push({url:c,labelFeatures:b,avoidLineFeatures:a.avoidLineFeatures});this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas)}};b.prototype.isEmptyObject=function(a){for(var c in a)return!1;return!0};b.prototype.tileFailFunction=function(a){1!=a.param.cancel&&(delete this.requestingTiles[a.param.url],this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas))};b.prototype.sendSuccess=function(a){if(!this.gwvtAnno.animating){for(var c=this.mergeLabelData(a,this.hitCacheUrls).labelFeatures,b=0;b<a.length;b++){var d=a[b];this.cache.push(d.url,d)}a=this.getLocalLabelDatas();c=c.concat(a);this.avoidlabelDatas=this.GAnnoAvoid.defaultAvoid(c,this.hasImportant);this.gwvtAnno.resetCanvasDiv();this.clean();if(this.hitDetection)for(this.features=[],c=0;c<this.avoidlabelDatas.length;c++)a=this.avoidlabelDatas[c],this.features[a.id]=a;e.draw(this.canvas,this.avoidlabelDatas,this.ratio,!1,!1,this.hitContext,this.hitDetection)}};b.prototype.drawAvoidLine=function(a){this.canvas.save();this.canvas.beginPath();for(var c=0;c<a.length;c++){var b=a[c];this.canvas.lineWidth=1;this.canvas.strokeStyle="#fff000";this.canvas.moveTo(b.datas[0],b.datas[1]);for(j=1;j<b.datas.length/2;j++)this.canvas.lineTo(b.datas[2*j],b.datas[2*j+1])}this.canvas.stroke();this.canvas.restore()};b.prototype.parseFeature=function(a){var c=a.data,b=a.param.xyz,e=0,f;for(f in c)c[f].xyz=b,e++;f=[];var k=this.getDataSourceById(a.param.dataSourceId);if(0<e&&k&&k.styleFun){e=[];a=a.param.xyz.level;var h=new d(c,a,e);k.styleFun.call({},h,a);for(a=0;a<e.length;a++)h=e[a],h.textures=k.textures,f=f.concat(this.parseItemData(h))}c=this.parseAvoidLine(c._layerAvoids,b);return{labelFeatures:f,avoidLineFeatures:c}};b.prototype.parseAvoidLine=function(a,c){var b=[],d;for(d in a){var e=a[d];d=parseInt(d);for(var f=0;f<e.length;f++){var k={};k.weight=d;k.sourceDatas=e[f];k.datas=this.transformAvoidLine(e[f],c);k.xyz=c;b.push(k)}}return b};b.prototype.transformAvoidLine=function(a,c){for(var b=(this.extent[0]-this.maxExtent[0])/this.res,d=(this.maxExtent[3]-this.extent[3])/this.res,e=[],f=0;f<a.length/2;f++){var k=a[2*f+1]+c.row*this.tileSize;e.push(a[2*f]+c.col*this.tileSize-b);e.push(k-d)}return e};b.prototype.parseItemData=function(a){var c=[];1==a.type&&(c=this.parsePoint(a));2==a.type&&("LINESTRING"==a[0]&&(c=c.concat(this.parseLine(a))),"MULTILINESTRING"==a[0]&&(c=c.concat(this.parseMultiLine(a,a[2][0][0]))));return c};b.prototype.parsePoint=function(a){var c=[],b=a[2],d=[[b,0]],e=this.transformData(d,a.xyz),f=a.style,h=a.fieldValueMap[f.labelfield],k=a.fieldValueMap.attributeId+"_row_"+a.xyz.row+"_col_"+a.xyz.col+"_level_"+a.xyz.level+"_x_"+d[0][0][0]+"_y_"+d[0][0][1],g=0;a.fieldValueMap[f.avoidField]&&(g=parseInt(a.fieldValueMap[f.avoidField]),isNaN(g)&&(g=0));c.push({id:Math.round(16777216*Math.random()),type:a.type,datas:e,sourceData:b,sourceAngleData:d,label:h,attributeId:a.fieldValueMap.attributeId,primaryId:k,style:f,iconImg:a.textures[f.texture],xyz:a.xyz,weight:g,directions:{0:1,1:1,2:1,3:1},attributes:a.fieldValueMap});return c};b.prototype.parseLine=function(a){return 0==a[2].length?[]:Array.isArray(a[2][0][0])?this.parseMultiLine(a,a[2][0]):this.parseMultiLine(a,a[2])};b.prototype.parseMultiLine=function(a,c){for(var b=[],d=a.style,e=0;e<c.length;e++){var f=c[e];if(0!=f.length){var h=a.fieldValueMap[d.labelfield],g=a.fieldValueMap[d.roadCodeLabel],k=0;a.fieldValueMap[d.avoidField]&&(k=parseInt(a.fieldValueMap[d.avoidField]));b=b.concat(this.cutLineFeature({type:a.type,sourceData:f,label:h,weight:k,roadCodeLabel:g,attributeId:a.fieldValueMap.attributeId,style:d,textures:a.textures,xyz:a.xyz,attributes:a.fieldValueMap},!1))}}return b};b.prototype.cutLineFeature=function(a,c){for(var b=h.cutLineFeature(a),d=0;d<b.length;d++){var e=b[d];e.datas=c?a.transformData(this.extent,this.res):this.transformData(e.sourceAngleData,e.xyz);e.primaryId=e.attributeId+"_row_"+a.xyz.row+"_col_"+a.xyz.col+"_level_"+a.xyz.level+"_x_"+e.sourceAngleData[0][0][0]+"_y_"+e.sourceAngleData[0][0][1];e.id=Math.round(16777216*Math.random());"text"==e.lineType&&(e.centerPoint=e.datas[Math.floor(e.datas.length/2)][0]);"code"==e.lineType&&(e.centerPoint=e.datas[0][0])}return b};b.prototype.transformData=function(a,c){for(var b=(this.extent[0]-this.maxExtent[0])/this.res,d=(this.maxExtent[3]-this.extent[3])/this.res,e=[],f=0;f<a.length;f++){var h=a[f][0];e.push([[h[0]+c.col*this.tileSize-b,h[1]+c.row*this.tileSize-d],a[f][1]])}return e};b.prototype.mergeLabelData=function(a,c){for(var b=[],d=[],e=0;e<a.length;e++)var f=a[e],b=b.concat(f.labelFeatures),d=d.concat(f.avoidLineFeatures);for(e=0;e<c.length;e++){for(var f=this.cache.getItem(c[e]).labelFeatures,h=0;h<f.length;h++){var g=f[h];g.datas=this.transformData(g.sourceAngleData,g.xyz);"text"==g.lineType&&(g.centerPoint=g.datas[Math.floor(g.datas.length/2)][0]);"code"==g.lineType&&(g.centerPoint=g.datas[0][0])}b=b.concat(f);f=this.cache.getItem(c[e]).avoidLineFeatures;for(h=0;h<f.length;h++)g=f[h],g.datas=this.transformAvoidLine(g.sourceDatas,g.xyz);d=d.concat(f)}return{labelFeatures:b,avoidLineFeatures:d}};b.prototype.getFeatureByXY=function(a,c){var b=null;if(this.hitDetection){var d=this.hitContext.getImageData(a,c,1,1).data;if(255===d[3]&&(d=d[2]+256*(d[1]+256*d[0])))try{b=this.features[d-1]}catch(r){}}return b};n.exports=b},{"../../../utils/Cache":23,"../avoid/GDrawGeomerty":14,"./../../../utils/es6-promise":25,"./../avoid/GAnnoAvoid":11,"./../avoid/GCutLine":12,"./LabelDrawer":19}],19:[function(b,n,p){b=function(b,e,a){this.layerDataMap=b;this.level=e;this.features=a};b.prototype.getLayer=function(b){this.labelDatas=[];var e=this.layerDataMap[b];if(null==e||null==e.features)return this;for(var a=0;a<e.features.length;a++){var c=e.features[a];c.layerName=b;c.xyz=e.xyz;c.type=e.type;c.fieldValueMap||(c.fieldValueMap=this.getFieldValueMap(e,c));this.labelDatas.push(c)}return this};b.prototype.getGroupLayer=function(b,e){this.labelDatas=[];var a=e.split(","),c=a.length;if(0==c)return this;var d=this.layerDataMap[b];if(null==d||null==d.features)return this;for(var f=0;f<c;f++)if(null!=d.features[a[f]]){var h=d.features[i];h.layerName=b;h.xyz=d.xyz;h.type=d.type;h.fieldValueMap||(h.fieldValueMap=this.getFieldValueMap(d,h));this.labelDatas.push(h)}return this};b.prototype.setStyle=function(b){for(var e={},a=0;a<this.labelDatas.length;e={labelData:e.labelData},a++){e.labelData=this.labelDatas[a];var c=function(a){return function(c){return a.labelData.fieldValueMap[c]}}(e);(c=b.call({},this.level,c))&&1==c.show&&(e.labelData.style=c,e.labelData.fieldValueMap.avoidWeight=c.avoidWeight,this.features.push(e.labelData))}};b.prototype.getFieldValueMap=function(b,e){for(var a={},c=0;c<b.fieldsConfig.length;c++){var d=b.fieldsConfig[c].name,f=b.fieldsConfig[c].index;1==b.fieldsConfig[c].id&&(a.attributeId=e.layerName+e[1][f]);a[d]=e[1][f]}return a};b.prototype.draw=function(){};n.exports=b},{}],20:[function(b,n,p){b=function(){this.id=Math.round(16777216*Math.random());this.type=1;this.sourceData=[];this.datas=[];this.sourceAngleData=[];this.attributes={};this.style={}};b.prototype.addAttribute=function(b,e){this.attributes[b]=e};b.prototype.removeAttributeByKey=function(b){delete this.attributes[b]};b.prototype.getMaxExtent=function(){if(0==this.sourceData.length)return null;for(var b=this.sourceData[0],e=this.sourceData[0],a=this.sourceData[1],c=this.sourceData[1],d=2;d<this.sourceData.length;d++){var f=this.sourceData[d],h=this.sourceData[d+1];f>e&&(e=f);f<b&&(b=f);h>c&&(c=h);h<a&&(a=h);d++}return[b,a,e,c]};b.prototype.inBounds=function(b){var e=this.getMaxExtent();return e?e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]:!1};b.prototype.transformData=function(b,e){this.datas=[];if(0!=this.sourceData.length){for(var a=b[0],c=b[3],d=[],f=0;f<this.sourceAngleData.length;f++){var h=this.sourceAngleData[f][0];d.push([[(h[0]-a)/e,(c-h[1])/e],this.sourceAngleData[f][1]])}this.datas=d}};b.prototype.getFeatureLabel=function(){var b=this.style.labelfield;return b&&this.attributes[b]?this.attributes[b]+"":null};n.exports=b},{}],21:[function(b,n,p){var g=b("./draw/GXYZUtil"),e=b("../../ext/Version");b=OpenLayers.Class(OpenLayers.Layer.XYZ,{urlArray:[],sourceUrl:null,isReady:!0,gxyzUtil:null,highlightLayer:null,ratio:1,control:null,controlId:null,tilesize:256,initialize:function(a,c,b){1.5<window.devicePixelRatio&&(this.ratio=2);this.sourceUrl||(this.sourceUrl=c);b&&b.tileSize&&(this.tilesize=b.tileSize.w);this.url=c+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+e;this.gxyzUtil=new g;this.gxyzUtil.tileSize=this.tilesize;this.gxyzUtil.parseUrl(c);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[a,this.url,b])},moveTo:function(a,c,b){this.isReady&&OpenLayers.Layer.XYZ.prototype.moveTo.apply(this,arguments)},setMap:function(a){this.control&&(this.url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+e+"\x26control\x3d"+this.control);this.controlId&&(this.url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+e+"\x26controlId\x3d"+this.controlId);OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments)},getURL:function(a){a=this.getXYZ(a);var c=this.url;if(0!=this.urlArray.length)var b=""+a.x+a.y+a.z,c=c.split("/mapserver")[1],c=this.selectUrl(b,this.urlArray)+"/mapserver"+c;return OpenLayers.String.format(c,a)},setFilter:function(a){this.url&&(!a||0==a.layers.length&&0==a.order.length?(this.url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+e,this.map&&(this.clearGrid(),a=this.map.getCenter(),a.lon+=1E-11,this.map.setCenter(a))):(this.isReady=!1,this.gxyzUtil.setFilter(a,function(a){a.isIE?(this.controlId=a.id,this.url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+e+"\x26controlId\x3d"+a.id):(this.control=a.id,this.url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+e+"\x26control\x3d"+a.id);this.isReady=!0;this.map&&(this.clearGrid(),a=this.map.getCenter(),a.lon+=1E-11,this.map.setCenter(a))}.bind(this))))},getFeatureByXY:function(a,b,d){a=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a,b));this.getFeatureByLonlat(a,d)},getFeatureByLonlat:function(a,b){var c=this.map.getMaxExtent(),e=this.map.getResolution(),h=this.tileSize.w,g=(c.top-a.lat)/(e*h),c=(a.lon-c.left)/(e*h),e=this.map.getZoom();this.gxyzUtil.pickupFeatures(g,c,e,(c-Math.floor(c))*h,(g-Math.floor(g))*h,this.control,this.controlId,function(a){b(a)})},highlightFeatures:function(a,b){var c=this.gxyzUtil.CreateHighlightFilter(a,b);if(0!=c.layers.length){b.color=b.color.replace("#","%23");if(!this.highlightLayer){var e=this.cloneOptions(this.options);e.opacity=b.opacity;e.isBaseLayer=!1;this.highlightLayer=new OpenLayers.Layer.GXYZ("highlightLayer",this.sourceUrl,e);this.map.addLayer(this.highlightLayer)}this.highlightLayer.setFilter(c);c=this.map.getLayerIndex(this);this.map.setLayerIndex(this.highlightLayer,c+1)}},highlightEveryFeatures:function(a,b){var c=this.gxyzUtil.CreateEveryHighlightFilter(a);if(0!=c.layers.length){if(!this.highlightLayer){var e=this.cloneOptions(this.options);e.isBaseLayer=!1;e.opacity=b;this.highlightLayer=new OpenLayers.Layer.GXYZ("highlightLayer",this.sourceUrl,e);this.map.addLayer(this.highlightLayer)}this.highlightLayer.setFilter(c);c=this.map.getLayerIndex(this);this.map.setLayerIndex(this.highlightLayer,c+1)}},cloneOptions:function(a){if("object"!=typeof a||null==a)return a;var b={},d;for(d in a)b[d]=this.cloneOptions(a[d]);return b},cancelHighlight:function(){this.highlightLayer&&(this.map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});n.exports=b},{"../../ext/Version":2,"./draw/GXYZUtil":22}],22:[function(b,n,p){var g=b("./../../../utils/es6-promise").getJSON,e=b("./../../../filter/Filter"),a=b("./../../../filter/FilterLayer"),c=b("../../../ext/Version");b=function(){this.tileSize=256};b.prototype.setFilter=function(a,b){for(var c=0;c<a.layers.length;c++)a.layers[c].id||a.layers.splice(c,1);c=JSON.stringify(a);this.isIE()?g({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control\x3d "+c,dataType:"json"}).then(function(a){a.isIE=!0;b(a)}.bind(this)):b({isIE:!1,id:c})};b.prototype.parseUrl=function(a){a=a.split("?");var b=a[0].split("/mapserver/");this.host=b[0];this.servername=b[1].split("/")[1];a=a[1].split("\x26");for(b=0;b<a.length;b++){var c=a[b].split("\x3d");if("styleId"==c[0]){this.styleId=c[1];break}}};b.prototype.pickupFeatures=function(a,b,e,k,m,l,n,r){a=this.host+"/mapserver/pickup/"+this.servername+"/getData?x\x3d"+b+"\x26y\x3d"+a+"\x26l\x3d"+e+"\x26pixelX\x3d"+k+"\x26pixelY\x3d"+m+"\x26styleId\x3d"+this.styleId+"\x26tilesize\x3d"+this.tileSize+"\x26clientVersion\x3d"+c;l&&(a=a+"\x26control\x3d"+l);n&&(a=a+"\x26controlId\x3d"+n);g({url:a,dataType:"json"}).then(function(a){r(a)},function(){r([])})};b.prototype.CreateHighlightFilter=function(b,c){var d=new e;d.otherDisplay=!1;for(var f in b){var g=b[f],l=!1,n;for(n in g)g=new a,g.id=f,g.idFilter=n,g.color=c,d.addFilterLayer(g),l=!0;l||(g=new a,g.id=f,g.color=c,d.addFilterLayer(g))}return d};b.prototype.CreateEveryHighlightFilter=function(b){var c=new e;c.otherDisplay=!1;for(var d in b){var g=b[d],m=g.style,l=!1,n;for(n in g){l=g[n].style;l.color=l.color.replace("#","%23");var r=new a;r.id=d;r.idFilter=n;r.color=l;c.addFilterLayer(r);l=!0}!l&&m&&(m.color=m.color.replace("#","%23"),r=new a,r.id=d,r.color=m,c.addFilterLayer(r))}return c};b.prototype.isIE=function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1};n.exports=b},{"../../../ext/Version":2,"./../../../filter/Filter":3,"./../../../filter/FilterLayer":4,"./../../../utils/es6-promise":25}],23:[function(b,n,p){b=function(b){this.size=b;this.map={};this.list=[]};b.prototype.push=function(b,e){if(this.list.length>this.size-1){var a=this.list.shift();delete this.map[a]}this.list.push(b);this.map[b]=e};b.prototype.getItem=function(b){return this.map[b]};b.prototype.clean=function(){this.map={};this.list=[]};b.prototype.length=function(){return this.list.length};n.exports=b},{}],24:[function(b,n,p){function g(){this.id=this.createUUID()}g.prototype.valueOf=function(){return this.id};g.prototype.toString=function(){return this.id};g.prototype.createUUID=function(){var b=new Date(1582,10,15,0,0,0,0),a=(new Date).getTime()-b.getTime(),b=g.getIntegerBits(a,0,31),c=g.getIntegerBits(a,32,47),a=g.getIntegerBits(a,48,59)+"2",d=g.getIntegerBits(g.rand(4095),0,7),f=g.getIntegerBits(g.rand(4095),0,7),h=g.getIntegerBits(g.rand(8191),0,7)+g.getIntegerBits(g.rand(8191),8,15)+g.getIntegerBits(g.rand(8191),0,7)+g.getIntegerBits(g.rand(8191),8,15)+g.getIntegerBits(g.rand(8191),0,15);return b+c+a+d+f+h};g.getIntegerBits=function(b,a,c){b=g.returnBase(b,16);var d=[],e="",h;for(h=0;h<b.length;h++)d.push(b.substring(h,h+1));for(h=Math.floor(a/4);h<=Math.floor(c/4);h++)e=d[h]&&""!=d[h]?e+d[h]:e+"0";return e};g.returnBase=function(b,a){var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");if(b<a)c=c[b];else var d=""+Math.floor(b/a),e=b-d*a,c=d>=a?this.returnBase(d,a)+c[e]:c[d]+c[e];return c};g.rand=function(b){return Math.floor(Math.random()*b)};n.exports=g},{}],25:[function(b,n,p){(function(g,e){var a=function(){function a(){return function(){return g.nextTick(m)}}function d(){return"undefined"!==typeof V?function(){V(m)}:k()}function f(){var a=0,b=new Y(m),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function h(){var a=new MessageChannel;a.port1.onmessage=m;return function(){return a.port2.postMessage(0)}}function k(){var a=setTimeout;return function(){return a(m,1)}}function m(){for(var a=0;a<G;a+=2)(0,H[a])(H[a+1]),H[a]=void 0,H[a+1]=void 0;G=0}function l(){try{var a=b("vertx");V=a.runOnLoop||a.runOnContext;return d()}catch(Z){return k()}}function n(a,b){var c=arguments,d=this,e=new this.constructor(p);void 0===e[Q]&&F(e);var f=d._state;f?function(){var a=c[f-1];E(function(){return P(f,e,a,d._result)})}():K(d,e,a,b);return e}function r(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(p);x(b,a);return b}function p(){}function q(a){try{return a.then}catch(Z){return L.error=Z,L}}function w(a,b,c,d){try{a.call(b,c,d)}catch(fa){return fa}}function S(a,b,c){E(function(a){var d=!1,e=w(c,b,function(c){d||(d=!0,b!==c?x(a,c):y(a,c))},function(b){d||(d=!0,A(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,A(a,e))},a)}function T(a,b){b._state===M?y(a,b._result):b._state===I?A(a,b._result):K(b,void 0,function(b){return x(a,b)},function(b){return A(a,b)})}function v(a,b,c){b.constructor===a.constructor&&c===n&&b.constructor.resolve===r?T(a,b):c===L?(A(a,L.error),L.error=null):void 0===c?y(a,b):"function"===typeof c?S(a,b,c):y(a,b)}function x(a,b){if(a===b)A(a,new TypeError("You cannot resolve a promise with itself"));else{var c=typeof b;null===b||"object"!==c&&"function"!==c?y(a,b):v(a,b,q(b))}}function z(a){a._onerror&&a._onerror(a._result);D(a)}function y(a,b){a._state===J&&(a._result=b,a._state=M,0!==a._subscribers.length&&E(D,a))}function A(a,b){a._state===J&&(a._state=I,a._result=b,E(z,a))}function K(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null;e[f]=b;e[f+M]=c;e[f+I]=d;0===f&&a._state&&E(D,a)}function D(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,h=0;h<b.length;h+=3)d=b[h],e=b[h+c],d?P(c,d,e,f):e(f);a._subscribers.length=0}}function O(){this.error=null}function P(a,b,c,d){var e="function"===typeof c,f=void 0,h=void 0,g=void 0;if(e){if(c=c(d),c===ga?(g=!0,f=c.error,c.error=null):h=!0,b===c){A(b,new TypeError("A promises callback cannot return that same promise."));return}}else c=d,h=!0;b._state===J&&(e&&h?x(b,c):g?A(b,f):a===M?y(b,c):a===I&&A(b,c))}function U(a,b){try{b(function(b){x(a,b)},function(b){A(a,b)})}catch(da){A(a,da)}}function F(a){a[Q]=aa++;a._state=void 0;a._result=void 0;a._subscribers=[]}function N(a,b){this._instanceConstructor=a;this.promise=new a(p);this.promise[Q]||F(this.promise);ba(b)?(this._remaining=this.length=b.length,this._result=Array(this.length),0===this.length?y(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&y(this.promise,this._result))):A(this.promise,Error("Array Methods must be provided an Array"))}function B(a){this[Q]=aa++;this._result=this._state=void 0;this._subscribers=[];if(p!==a){if("function"!==typeof a)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof B)U(this,a);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}}var W=void 0,ba=W=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},G=0,V=void 0,X=void 0,E=function(a,b){H[G]=a;H[G+1]=b;G+=2;2===G&&(X?X(m):ca())},R=(W="undefined"!==typeof window?window:void 0)||{},Y=R.MutationObserver||R.WebKitMutationObserver,R="undefined"===typeof self&&"undefined"!==typeof g&&"[object process]"==={}.toString.call(g),ha="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,H=Array(1E3),ca=void 0,ca=R?a():Y?f():ha?h():void 0===W&&"function"===typeof b?l():k(),Q=Math.random().toString(36).substring(16),J=void 0,M=1,I=2,L=new O,ga=new O,aa=0;N.prototype._enumerate=function(a){for(var b=0;this._state===J&&b<a.length;b++)this._eachEntry(a[b],b)};N.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;d===r?(d=q(a),d===n&&a._state!==J?this._settledAt(a._state,b,a._result):"function"!==typeof d?(this._remaining--,this._result[b]=a):c===B?(c=new c(p),v(c,a,d),this._willSettleAt(c,b)):this._willSettleAt(new c(function(b){return b(a)}),b)):this._willSettleAt(d(a),b)};N.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===J&&(this._remaining--,a===I?A(d,c):this._result[b]=c);0===this._remaining&&y(d,this._result)};N.prototype._willSettleAt=function(a,b){var c=this;K(a,void 0,function(a){return c._settledAt(M,b,a)},function(a){return c._settledAt(I,b,a)})};B.all=function(a){return(new N(this,a)).promise};B.race=function(a){var b=this;return ba(a)?new b(function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}):new b(function(a,b){return b(new TypeError("You must pass an array to race."))})};B.resolve=r;B.reject=function(a){var b=new this(p);A(b,a);return b};B._setScheduler=function(a){X=a};B._setAsap=function(a){E=a};B._asap=E;B.prototype={constructor:B,then:n,"catch":function(a){return this.then(null,a)}};B.polyfill=function(){var a=void 0;if("undefined"!==typeof e)a=e;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(ea){throw Error("polyfill failed because global object is unavailable in this environment");}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(ea){}if("[object Promise]"===c&&!b.cast)return}a.Promise=B};return B.Promise=B}().Promise;n.exports={Promise:a,Deferred:function(){this.promise=new a(function(a,b){this.resolve=a;this.reject=b}.bind(this));this.then=this.promise.then.bind(this.promise);this["catch"]=this.promise["catch"].bind(this.promise)},getJSON:function(b){b.type||(b.type="GET");b.dataType||(b.dataType="json");return new a(function(a,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("text/html");d.open(b.type,b.url);d.onreadystatechange=function(){if(this.readyState===this.DONE)if(200===this.status){var d=this.responseText;"json"==b.dataType&&"string"==typeof d&&(d=JSON.parse(d));a(d)}else c(Error("getJSON: "+b.url+" failed with status: ["+this.status+"]"))};d.responseType="text";"GET"==b.type.toUpperCase()&&d.setRequestHeader("Content-Type","text/plain; charset\x3dutf-8");"POST"==b.type.toUpperCase()&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.send(b.data)})},getParamJSON:function(b){b.type||(b.type="GET");b.dataType||(b.dataType="json");var c=new XMLHttpRequest,e=new a(function(a,d){c.overrideMimeType&&c.overrideMimeType("text/html");var e=!1;setTimeout(function(){"200"!=c.status&&(e=!0,c.abort())},3E4);c.open(b.type,b.url);c.onreadystatechange=function(){if(e)d({param:b,data:"getParamJSON: "+b.url+" timeout"});else if(this.readyState===this.DONE)if(200===this.status){var c=this.responseText;"json"==b.dataType&&"string"==typeof c&&(c=JSON.parse(c));a({param:b,data:c})}else d({param:b,data:"getParamJSON: "+b.url+" failed with status: ["+this.status+"]"})};c.responseType="text";"GET"==b.type.toUpperCase()&&c.setRequestHeader("Content-Type","text/plain; charset\x3dutf-8");"POST"==b.type.toUpperCase()&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(b.data)});e.xhr=c;return e}}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{_process:28}],26:[function(b,n,p){var g=function(b,a,c,d,f,h){f=5*f/100;this.left=b-f;this.right=a+f;this.bottom=c-f;this.top=d+f;this.previous=g.createEmptyDoubleArray();this.now=g.createEmptyDoubleArray();this.question=g.createEmptyDoubleArray();this.point_question_quadrant=this.point_now_quadrant=this.point_previous_quadrant=-1};g.createEmptyDoubleArray=function(){return[NaN,NaN]};g.prototype.copy=function(b,a){a[0]=b[0];a[1]=b[1]};g.isEmpty=function(b){return null==b?!0:isNaN(b[0])||isNaN(b[1])?!0:!1};g.prototype.isQuadrant=function(b){var a=b[0];b=b[1];return a<this.left?b>this.top?8:b<this.bottom?2:1:a>this.right?b>this.top?6:b<this.bottom?4:5:b>this.top?7:b<this.bottom?3:9};g.prototype.passrule=function(b,a){return 1==b?1==a||2==a||8==a?2:1:2==b?1==a||2==a||8==a||3==a||4==a?2:1:3==this.point_previous_quadrant?2==this.point_now_quadrant||3==this.point_now_quadrant||4==this.point_now_quadrant?2:1:4==b?2==a||3==a||4==a||5==a||6==a?2:1:5==b?4==a||5==a||6==a?2:1:6==b?4==a||5==a||6==a||7==a||8==a?2:1:7==b?6==a||7==a||8==a?2:1:8==b?6==a||7==a||8==a||1==a||2==a?2:1:1};g.prototype.reset=function(){this.previous[0]=NaN;this.previous[1]=NaN;this.question[0]=NaN;this.question[1]=NaN;this.now[0]=NaN;this.now[1]=NaN;this.point_question_quadrant=this.point_now_quadrant=this.point_previous_quadrant=-1};g.prototype["in"]=function(b){return b[0]<this.left||b[0]>this.right||b[1]<this.bottom||b[1]>this.top?!1:!0};g.length=function(b,a,c,d){b=c-b;a=d-a;return Math.sqrt(b*b+a*a)};g.prototype.push=function(b,a){this.now[0]=b;this.now[1]=a;if(g.isEmpty(this.previous))return this.copy(this.now,this.previous),this.point_previous_quadrant=this.isQuadrant(this.now),[this.now];this.point_now_quadrant=this.isQuadrant(this.now);var c=this.passrule(this.point_previous_quadrant,this.point_now_quadrant);if(1==c){this.point_previous_quadrant=this.isQuadrant(this.now);this.copy(this.now,this.previous);if(g.isEmpty(this.question))return[this.now];c=[];this.copy(this.question,c);this.question=g.createEmptyDoubleArray();return[c,this.now]}if(2==c){if(!g.isEmpty(this.question)&&(c=this.passrule(this.point_question_quadrant,this.point_now_quadrant),1==c))return c=[],this.copy(this.question,c),this.question=g.createEmptyDoubleArray(),[c,this.now];this.copy(this.now,this.question);this.point_question_quadrant=this.point_now_quadrant}return null};n.exports=g},{}],27:[function(b,n,p){var g=function(){};g.pointDistToLine=function(b,a,c,d,f,g){var e=((b-c)*(f-c)+(a-d)*(g-d))/((c-f)*(c-f)+(d-g)*(d-g));c+=e*(f-c);d+=e*(g-d);return Math.sqrt((b-c)*(b-c)+(a-d)*(a-d))};g.isPointOnSegment=function(b,a,c,d,f,h){return b-3>c&&b+3>f||b+3<c&&b-3<f||a-3>d&&a+3>h||a+3<d&&a-3<h?0:3>g.pointDistToLine(b,a,c,d,f,h)?1:0};g.pointInLine=function(b,a,c){var d=[];Array.isArray(c[0])?d=c:d.push(c);for(c=0;c<d.length;c++)for(var e=d[c],h=e.length/2,k=0;k<h-1;k++){var m;m=k+1;if(1==g.isPointOnSegment(b,a,e[2*k],e[2*k+1],e[2*m],e[2*m+1]))return 1}return 0};g.pointInPolygon=function(b,a,c){var d=0,e=[];Array.isArray(c[0])?e=c:e.push(c);for(c=0;c<e.length;c++)for(var g=e[c],k=0,m=g.length/2,l=m-1;k<m;l=k,k++){var n=g[2*k],p=g[2*k+1],u=g[2*l],l=g[2*l+1];if(n===b&&p===a||u===b&&l===a)return 1;if(p<a&&l>=a||p>=a&&l<a){n+=(a-p)*(u-n)/(l-p);if(n===b)return 1;n>b&&(d=!d)}}return d?1:0};g.lineIntersects=function(b,a,c,d,f,g,k,m){var e,h,n,p,q=[null,null];e=(m-g)*(c-b)-(k-f)*(d-a);if(0===e)return null!==q[0]&&null!==q[1]?q:!1;h=a-g;n=b-f;p=(c-b)*h-(d-a)*n;h=((k-f)*h-(m-g)*n)/e;n=p/e;q[0]=b+h*(c-b);q[1]=a+h*(d-a);return 0<n&&1>n?q:!1};g.polyWith=function(b,a){for(var c=b.length/2,d=a.length/2,e,h,k,m,l,n,p,u,q=0;q<c;q++){q!=c-1?(h=b[2*q],k=b[2*q+1],m=b[2*q+2],e=b[2*q+3]):(h=b[2*q],k=b[2*q+1],m=b[0],e=b[1]);for(var w=0;w<d;w++)if(w!=d-1?(n=a[2*w],p=a[2*w+1],u=a[2*w+2],l=a[2*w+3]):(n=a[2*w],p=a[2*w+1],u=a[0],l=a[1]),0!=g.lineIntersects(h,k,m,e,n,p,u,l))return 1}return g.pointInPolygon(a[0],a[1],b)?2:3};g.boxToPolyArr=function(b,a,c,d){var e=[];e.push(b);e.push(a);e.push(b);e.push(d);e.push(c);e.push(d);e.push(c);e.push(a);e.push(b);e.push(a);return e};g.getExtensionPoint=function(b,a,c){var d=a[0]-b[0],e=a[1]-b[1];b=a[0];0==d?a=0<e?a[1]+c:a[1]-c:(c=Math.sqrt(c*c/(e/d*(e/d)+1)),0>d&&(c=-c),b=a[0]+c,a=a[1]+e/d*c);return[b,a]};n.exports=g},{}],28:[function(b,n,p){function g(){throw Error("setTimeout has not been defined");}function e(){throw Error("clearTimeout has not been defined");}function a(a){if(m===setTimeout)return setTimeout(a,0);if((m===g||!m)&&setTimeout)return m=setTimeout,setTimeout(a,0);try{return m(a,0)}catch(S){try{return m.call(null,a,0)}catch(T){return m.call(this,a,0)}}}function c(a){if(l===clearTimeout)return clearTimeout(a);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(S){try{return l.call(null,a)}catch(T){return l.call(this,a)}}}function d(){r&&u&&(r=!1,u.length?t=u.concat(t):q=-1,t.length&&f())}function f(){if(!r){var b=a(d);r=!0;for(var e=t.length;e;){u=t;for(t=[];++q<e;)u&&u[q].run();q=-1;e=t.length}u=null;r=!1;c(b)}}function h(a,b){this.fun=a;this.array=b}function k(){}b=n.exports={};var m,l;try{m="function"===typeof setTimeout?setTimeout:g}catch(w){m=g}try{l="function"===typeof clearTimeout?clearTimeout:e}catch(w){l=e}var t=[],r=!1,u,q=-1;b.nextTick=function(b){var c=Array(arguments.length-1);if(1<arguments.length)for(var d=1;d<arguments.length;d++)c[d-1]=arguments[d];t.push(new h(b,c));1!==t.length||r||a(f)};h.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=k;b.addListener=k;b.once=k;b.off=k;b.removeListener=k;b.removeAllListeners=k;b.emit=k;b.prependListener=k;b.prependOnceListener=k;b.listeners=function(a){return[]};b.binding=function(a){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}]},{},[5])(5)});