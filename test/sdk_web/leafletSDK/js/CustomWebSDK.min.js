var $jscomp={scope:{},inherits:function(D,f){function l(){}l.prototype=f.prototype;D.prototype=new l;D.prototype.constructor=D;for(var q in f)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(f,q);e&&Object.defineProperty(D,q,e)}else D[q]=f[q]}};(function(D){"object"===typeof exports&&"undefined"!==typeof module?module.exports=D():"function"===typeof define&&define.amd?define([],D):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Custom=D()})(function(){return function f(l,q,e){function d(c,b){if(!q[c]){if(!l[c]){var h="function"==typeof require&&require;if(!b&&h)return h(c,!0);if(a)return a(c,!0);h=Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h;}h=q[c]={exports:{}};l[c][0].call(h.exports,function(a){var b=l[c][1][a];return d(b?b:a)},h,h.exports,f,l,q,e)}return q[c].exports}for(var a="function"==typeof require&&require,b=0;b<e.length;b++)d(e[b]);return d}({1:[function(f,l,q){f=L.extend({},L.CRS.Earth,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/180,1,-1/180,.5),scale:function(e){return 256*Math.pow(2,e-1)}});l.exports=f},{}],2:[function(f,l,q){L.Control.Attribution.prototype.options={position:"bottomright"};L.Map.TouchZoom.prototype._onTouchMove=function(e){return function(d){if(d.touches&&2===d.touches.length&&this._zooming){var a=this._map,b=a.mouseEventToContainerPoint(d.touches[0]),c=a.mouseEventToContainerPoint(d.touches[1]),h=b.distanceTo(c)/this._startDist;this._zoom=a.getScaleZoom(h,this._startZoom)+1;!a.options.bounceAtZoomLimits&&(this._zoom<a.getMinZoom()&&1>h||this._zoom>a.getMaxZoom()&&1<h)&&(this._zoom=a._limitZoom(this._zoom));if("center"===a.options.touchZoom){if(this._center=this._startLatLng,1===h)return}else{b=b._add(c)._divideBy(2)._subtract(this._centerPoint);if(1===h&&0===b.x&&0===b.y)return;this._center=a.unproject(a.project(this._pinchStartLatLng,this._zoom).subtract(b),this._zoom)}this._moved||(a._moveStart(!0),this._moved=!0);L.Util.cancelAnimFrame(this._animRequest);a=L.bind(a._move,a,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=L.Util.requestAnimFrame(a,this,!0);L.DomEvent.preventDefault(d)}}}(L.Map.TouchZoom.prototype._onTouchMove);L.Map.prototype.flyTo=function(e){return function(d,a,b){function c(c){c=(l*l-r*r+2.0164*(c?-1:1)*2.0164*q*q)/(4.0328*(c?l:r)*q);c=Math.sqrt(c*c+1)-c;return 1E-9>c?-18:Math.log(c)}function h(c){return(Math.exp(c)+Math.exp(-c))/2}function m(c){return r*(h(x)/h(x+1.42*c))}function g(c){var a=h(x);c=x+1.42*c;c=(Math.exp(c)-Math.exp(-c))/2/h(c);return r*(a*c-(Math.exp(x)-Math.exp(-x))/2)/2.0164}function e(){var c=(Date.now()-u)/y,b=(1-Math.pow(1-c,1.5))*w;1>=c?(this._flyToFrame=L.Util.requestAnimFrame(e,this),this._move(this.unproject(f.add(p.subtract(f).multiplyBy(g(b)/q)),v),this.getScaleZoom(r/m(b),v),{flyTo:!0})):(a=Math.round(a),this._move(d,a)._moveEnd(!0))}b=b||{};if(!1===b.animate||!L.Browser.any3d)return this.setView(d,a,b);this._stop();var f=this.project(this.getCenter()),p=this.project(d),t=this.getSize(),v=this._zoom;d=L.latLng(d);a=void 0===a?v:a;var r=Math.max(t.x,t.y),l=r*this.getZoomScale(v,a),q=p.distanceTo(f)||1,x=c(0),u=Date.now(),w=(c(1)-x)/1.42,y=b.duration?1E3*b.duration:800*w;this._moveStart(!0);e.call(this);return this}}(L.Map.prototype.flyTo);if(window.ActiveXObject||"ActiveXObject"in window)String.prototype.startsWith=function(e){return null==e||""==e||0==this.length||e.length>this.length||this.substr(0,e.length)!=e?!1:!0},String.prototype.endsWith=function(e){return window.ActiveXObject||"ActiveXObject"in window?-1!==this.indexOf(e,this.length-e.length):this.endsWith(e)}},{}],3:[function(f,l,q){l.exports="jssdk_bate@ leaflet 2.0.5"},{}],4:[function(f,l,q){f=function(){this.otherDisplay=!0;this.layers=[];this.order=[]};f.prototype.addFilterLayer=function(e){this.layers.push(e)};f.prototype.removeFilterLayerById=function(e){for(var d=0;d<this.layers.length;d++)this.layers[d].id==e&&this.layers.splice(d,1)};l.exports=f},{}],5:[function(f,l,q){var e=f("./Filter");f=function(){e.call(this);this.id=null;this.filters={};this.filterStr=this.idFilter=null;this.display=!0};$jscomp.inherits(f,e);f.prototype.addFilterField=function(d,a){this.filters[d]=a};f.prototype.removeFilterField=function(d){delete this.filters[d]};l.exports=f},{"./Filter":4}],6:[function(f,l,q){l=l.exports={};f("./ext/LeafletExt");L.CRS.CustomEPSG4326=f("./ext/CRS.CustomEPSG4326");l.DataSource=f("./layer/datasource/DataSource");l.URLDataSource=f("./layer/datasource/URLDataSource");l.LocalDataSource=f("./layer/datasource/LocalDataSource");L.GLabelGrid=f("./layer/label/GLabelGrid");L.GWVTAnno=f("./layer/label/GWVTAnno");l.Feature=f("./layer/label/feature/Feature");l.GGroup=f("./layer/vector/stylejs/GGroup");l.GLevels=f("./layer/vector/stylejs/GLevels");l.GStyleItem=f("./layer/vector/stylejs/GStyleItem");L.GDynamicMap=f("./layer/vector/GDynamicMap");L.GVMapGrid=f("./layer/vector/GVMapGrid");L.GXYZ=f("./layer/vector/GXYZ");l.GServiceGroup=f("./layer/GServiceGroup");l.GVMapGridUtil=f("./layer/vector/draw/GVMapGridUtil");l.GGroup=f("./layer/vector/stylejs/GGroup");l.GLevels=f("./layer/vector/stylejs/GLevels");l.GStyleItem=f("./layer/vector/stylejs/GStyleItem")},{"./ext/CRS.CustomEPSG4326":1,"./ext/LeafletExt":2,"./layer/GServiceGroup":7,"./layer/datasource/DataSource":8,"./layer/datasource/LocalDataSource":9,"./layer/datasource/URLDataSource":10,"./layer/label/GLabelGrid":11,"./layer/label/GWVTAnno":12,"./layer/label/feature/Feature":22,"./layer/vector/GDynamicMap":23,"./layer/vector/GVMapGrid":24,"./layer/vector/GXYZ":25,"./layer/vector/draw/GVMapGridUtil":26,"./layer/vector/stylejs/GGroup":28,"./layer/vector/stylejs/GLevels":29,"./layer/vector/stylejs/GStyleItem":30}],7:[function(f,l,q){f=function(e,d,a,b){this.label=this.layer=this.map=null;this.layerType=0;this.labelType=2;this.map=a;this.url=d;this.layerId=e;this.styleId=null;this.tileSize=256};f.prototype.addServiceGroup=function(){options&&options.styleId&&(this.styleId=options.styleId);options&&options.tileSize&&(this.tileSize=options.tileSize);switch(this.layerType){case 0:this.addBaseLayer();break;case 1:this.addFrontBaseLayer()}switch(this.labelType){case 2:this.addFrontLabel();break;case 3:this.AddImgLabel();break;case 4:this.addAvoidLabel()}};f.prototype.addBaseLayer=function(){this.layer=new L.GXYZ(this.url+"\x26x\x3d{x}\x26y\x3d{y}\x26l\x3d{z}\x26tileType\x3d"+this.layerType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:this.tileSize});this.map.addLayer(this.layer)};f.prototype.addFrontBaseLayer=function(){this.layer=new L.GVMapGrid(this.url+"\x26x\x3d{x}\x26y\x3d{y}\x26l\x3d{z}\x26tileType\x3d"+this.layerType,{maxZoom:21,keepBuffer:0,updateWhenZooming:!1,tileSize:this.tileSize});this.map.addLayer(this.layer)};f.prototype.AddImgLabel=function(){this.label=new L.GXYZ(this.url+"\x26x\x3d{x}\x26y\x3d{y}\x26l\x3d{z}\x26tileType\x3d"+this.labelType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:this.tileSize});this.map.addLayer(this.label)};f.prototype.addAvoidLabel=function(e){this.label=new L.GLabelGrid(this.url+"\x26x\x3d{x}\x26y\x3d{y}\x26l\x3d{z}\x26tileType\x3d"+this.labelType,{hitDetection:!0,keepBuffer:0,updateWhenZooming:!1,tileSize:this.tileSize});this.map.addLayer(this.label)};f.prototype.addFrontLabel=function(e){this.label=new L.GWVTAnno("GWVTanno",{tileSize:this.tileSize});e=new Custom.URLDataSource;e.url=this.url+"\x26x\x3d${x}\x26y\x3d${y}\x26l\x3d${z}\x26tileType\x3d"+this.labelType;this.label.addDataSource(e);this.map.addLayer(this.label)};f.prototype.setLayerType=function(e){"Img"==e?this.layerType=0:"Data"==e&&(this.layerType=1)};f.prototype.setLabelType=function(e){"Data"==e?this.labelType=2:"Img"==e?this.labelType=3:"AvoidImg"==e&&(this.labelType=4)};f.prototype.setTileSize=function(e){this.tileSize=e};f.prototype.getLayer=function(){return this.layer};f.prototype.getLabel=function(){return this.label};f.prototype.removeGroupLayer=function(){this.layer&&this.map.removeLayer(this.layer);this.label&&this.map.removeLayer(this.label)};l.exports=f},{}],8:[function(f,l,q){var e=f("../../utils/UUID");l.exports=function(){this.id=(new e).valueOf();this.type="";this.textures={}}},{"../../utils/UUID":32}],9:[function(f,l,q){var e=f("./DataSource");f=function(){e.call(this);this.type="LocalDataSource";this.features=[];this.textureUrls={}};$jscomp.inherits(f,e);f.prototype.addFeature=function(d){this.features.push(d)};f.prototype.addTextureUrl=function(d,a){this.textureUrls[d]=a};f.prototype.removeTextureUrl=function(d){delete this.textureUrls[d]};f.prototype.loadTexture=function(){var d=new Deferred,a=0,b;for(b in this.textureUrls)a++;if(0==a)d.resolve();else{var c=0,h;for(h in this.textureUrls)b=new Image,b.name=h,b.onload=function(b){c++;this.textures[b.target.name]=b.target;c==a&&d.resolve()}.bind(this),b.src=this.textureUrls[h];return d}};f.prototype.removeFeatureById=function(d){for(var a=0;a<this.features.length;a++)this.features[a].id==d&&this.features.splice(a,1)};l.exports=f},{"./DataSource":8}],10:[function(f,l,q){var e=f("./DataSource");q=f("./../../utils/es6-promise");var d=q.Deferred,a=q.getJSON,b=f("../../ext/Version");f=function(){e.call(this);this.urlArray=[];this.type="URLDataSource";this.styleUrl=this.url=null;this.styleId="style";this.filter=null;this.textures={};this.sourceUrl=this.controlId=this.control=null;this.servername=this.host=""};$jscomp.inherits(f,e);f.prototype.loadStyle=function(c){var h=new d,m=new d,g=new d;this.parseUrl();this.sourceUrl||(this.sourceUrl=this.url+"\x26clientVersion\x3d"+b,this.url=this.url+"\x26clientVersion\x3d"+b);this.control&&this.isIE()?a({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control\x3d"+this.control,dataType:"json"}).then(function(c){this.controlId=c.id;this.url=this.sourceUrl+"\x26controlId\x3d"+c.id;h.resolve()}.bind(this)):(this.url=this.control?this.sourceUrl+"\x26control\x3d"+this.control:this.sourceUrl,h.resolve());c||(c="label");a({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/"+c+"/style.js",dataType:"text"}).then(function(c){this.styleFun=new Function("drawer","level",c);m.resolve()}.bind(this));a({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/label/texture.js",dataType:"text"}).then(function(c){c=JSON.parse(c);var a=0,b;for(b in c)a++;if(0==a)g.resolve();else{var h=0,d;for(d in c)b=new Image,b.name=d,b.onload=function(c){h++;this.textures[c.target.name]=c.target;h==a&&g.resolve()}.bind(this),b.src=c[d]}}.bind(this));return[h,m,g]};f.prototype.parseUrl=function(){var c=this.url.split("?"),a=c[0].split("/mapserver/");this.host=a[0];this.servername=a[1].split("/")[1];c=c[1].split("\x26");for(a=0;a<c.length;a++){var b=c[a].split("\x3d");if("styleId"==b[0]){this.styleId=b[1];break}}};f.prototype.setFilter=function(c){this.control=null;if(this.url&&c&&(0!=c.layers.length||0!=c.order.length)){for(var a=0;a<c.layers.length;a++)c.layers[a].id||c.layers.splice(a,1);this.control=JSON.stringify(c)}};f.prototype.getTexture=function(c){return this.textures[c]};f.prototype.addTexture=function(c,a){this.textures[c]=a};f.prototype.isIE=function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1};l.exports=f},{"../../ext/Version":3,"./../../utils/es6-promise":33,"./DataSource":8}],11:[function(f,l,q){var e=f("../vector/draw/GXYZUtil"),d=f("../../ext/Version"),a=f("./avoid/GDrawGeomerty");f=L.TileLayer.extend({urlArray:[],sourceUrl:null,textures:{},tileQueue:[],ratio:1,tilesize:256,control:null,controlId:null,hitDetection:!1,initialize:function(a,c){1.5<window.devicePixelRatio&&(this.ratio=2);this.sourceUrl||(this.sourceUrl=a);c&&c.tileSize&&(this.tilesize=c.tileSize);this.gxyzUtil=new e;this.gxyzUtil.tileSize=this.tilesize;this.gxyzUtil.parseUrl(a);this._url=a+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d;L.setOptions(this,c);this.hitDetection=c.hitDetection;this.on("tileunload",this._onTileRemove);this.on("tileload",this._onTileLoad);this.on("tileerror",this._onTileError)},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-pane leaflet-overlay-pane"),this.getPane().appendChild(this._container))},onAdd:function(){this.control&&(this._url=this.sourceUrl+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26control\x3d"+this.control);this.controlId&&(this._url=this.sourceUrl+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26controlId\x3d"+this.controlId);this._initContainer();this._levels={};this._tiles={};Custom.getJSON({url:this.gxyzUtil.host+"/mapserver/styleInfo/"+this.gxyzUtil.servername+"/"+this.gxyzUtil.styleId+"/label/texture.js",dataType:"text"}).then(function(a){a=JSON.parse(a);var c=0,b;for(b in a)c++;0==c&&(this._resetView(),this._update());var d=0,g;for(g in a)b=new Image,b.name=g,b.onload=function(a){d++;this.textures[a.target.name]=a.target;d==c&&(this._resetView(),this._update())}.bind(this),b.src=a[g]}.bind(this))},createTile:function(a,c){var b=this.tileQueue.pop();b?this._cleanTile(b):b=this.initTile();var d=this.getTileUrl(a);Custom.getJSON({url:d,dataType:"json"}).then(function(a){b.data=a;this._tileOnLoad.apply(this,[c,b])}.bind(this),function(a){this._tileOnError.apply(this,[c,b,a])}.bind(this));return b},getTileUrl:function(a){var c={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(a),x:a.x,y:a.y,z:this._getZoomForUrl()};this._map&&!this._map.options.crs.infinite&&(a=this._globalTileRange.max.y-a.y,this.options.tms&&(c.y=a),c["-y"]=a);if(0==this.urlArray.length)return L.Util.template(this._url,L.extend(c,this.options));a=this.urlArray[Math.round(Math.random()*(this.urlArray.length-1))];var b=this._url.split("/mapserver")[1];return L.Util.template(a+"/mapserver"+b,L.extend(c,this.options))},initTile:function(){var a=document.createElement("canvas");a.style.width=this.tilesize+"px";a.style.height=this.tilesize+"px";a.width=this.tilesize;a.height=this.tilesize;var c=a.getContext("2d",{isQuality:!0});a.ctx=c;this.hitDetection&&(c=document.createElement("canvas"),c.style.width=this.tilesize+"px",c.style.height=this.tilesize+"px",c.width=this.tilesize,c.height=this.tilesize,c=c.getContext("2d",{isQuality:!0}),a.hitCtx=c);return a},_onTileRemove:function(a){this.tileQueue.push(a.tile)},_abortLoading:function(){var a,c;for(a in this._tiles)this._tiles[a].coords.z!==this._tileZoom&&(c=this._tiles[a].el,L.DomUtil.remove(c))},_onTileLoad:function(a){a=a.tile;this._drawTile(a,a.data);a.complete=!0},_onTileError:function(a){a=a.tile;a.complete=!0;this.tileQueue.push(a)},_tileOnError:function(a,c,h){a(h,c)},_drawTile:function(b,c){for(var h=b.ctx,d={},g=0;g<c.length;g++){var e=c[g];1==e.type?(e.id=Math.round(16777216*Math.random()),d[e.id]=e,e.iconImg=this.textures[e.style.texture],a.drawPointIcon(h,e,this.ratio,!1,b.hitCtx,this.hitDetection),a.drawPoint(h,e,this.ratio,!1,!1,b.hitCtx,this.hitDetection)):2==e.type&&a.drawLine(h,e,this.ratio)}b.featureIdMap=d},_cleanTile:function(a){a.ctx.clearRect(0,0,this.tilesize,this.tilesize);a.hitCtx&&a.hitCtx.clearRect(0,0,this.tilesize,this.tilesize)},getFeatureByXY:function(a,c){var b=null;if(this.hitDetection){var d=this._map.containerPointToLatLng(new L.point(a,c)),g=this._map.options.crs.projection.bounds,e=this._map.getBounds(),f=this._map.getPixelBounds(),p=(e._northEast.lat-e._southWest.lat)/(f.max.y-f.min.y),e=this.tilesize,f=(g.max.y-d.lat)/(p*e),g=(d.lng-g.min.x)/(p*e),p=Math.floor(f),t=Math.floor(g),d=this._map.getZoom(),d=this._tiles[t+":"+p+":"+d].el,e=d.hitCtx.getImageData((g-t)*e,(f-p)*e,1,1).data;if(255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))try{b=d.featureIdMap[e-1]}catch(v){}}return b},setFilter:function(a){this._url&&a&&(0!=a.layers.length||0!=a.order.length)&&this.gxyzUtil.setFilter(a,function(a){a.isIE?(this.controlId=a.id,this.setUrl(this.sourceUrl+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26controlId\x3d"+a.id)):(this.control=a.id,this.setUrl(this.sourceUrl+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26control\x3d"+a.id))}.bind(this))}});l.exports=f},{"../../ext/Version":3,"../vector/draw/GXYZUtil":27,"./avoid/GDrawGeomerty":16}],12:[function(f,l,q){var e=f("./draw/CanvasLayer");f=L.Layer.extend({canvasLayer:null,currLevel:2,ratio:1,hitDetection:!0,options:{tileSize:256},initialize:function(d){L.setOptions(this,d);this.options.hasOwnProperty("hitDetection")&&(this.hitDetection=this.options.hitDetection);1.5<window.devicePixelRatio&&(this.ratio=2);this.canvasLayer=new e;this.canvasLayer.tileSize=this.options.tileSize;this.canvasLayer.hitDetection=this.hitDetection;this.canvasLayer.ratio=this.ratio;this.animating=!1},onAdd:function(){var d=this._map.options.crs.projection.bounds;this.canvasLayer.init(this._map._size.x,this._map._size.y,this.options.tileSize,this);this.canvasLayer.maxExtent=[d.min.x,d.min.y,d.max.x,d.max.y];this._container=this.canvasLayer.root;this._zoomAnimated&&L.DomUtil.addClass(this._container,"leaflet-zoom-animated");this.getPane().appendChild(this.canvasLayer.root);this._update()},getEvents:function(){var d={resize:this.onResize,movestart:this.onMoveStart,zoom:this._onZoom,moveend:this._onMoveend};this._zoomAnimated&&(d.zoomanim=this._onAnimZoom);return d},onResize:function(d){this.canvasLayer.tileSize=this.options.tileSize;this.canvasLayer.gwvtAnno=this;this.canvasLayer.initCanvas(this._map._size.x,this._map._size.y);this._update()},_onAnimZoom:function(d){this.updateTransform(d.center,d.zoom)},_onZoom:function(){this.updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveend:function(){this.animating=!1;this._update()},updateTransform:function(d,a){this._zoom&&this._center||(this._zoom=this._map.getZoom(),this._center=this._map.getCenter());var b=this._map.getZoomScale(a,this._zoom),c=this.getCanvasXY(),h=this._map.getSize().multiplyBy(.5),m=this._map.project(this._center,a),m=this._map.project(d,a).subtract(m),c=h.multiplyBy(-b).add(c).add(h).subtract(m);L.Browser.any3d?L.DomUtil.setTransform(this.canvasLayer.root,c,b):L.DomUtil.setPosition(this.canvasLayer.root,c)},onMoveStart:function(){this.animating=!0},_update:function(){var d=this._map;if(d){var a=d.getBounds(),b=d.getPixelBounds(),b=(a._northEast.lat-a._southWest.lat)/(b.max.y-b.min.y),c=d.options.crs.projection.bounds,h=Math.floor((c.max.y-a._northEast.lat)/(b*this.options.tileSize)),m=Math.ceil((c.max.y-a._southWest.lat)/(b*this.options.tileSize)),g=Math.floor((a._southWest.lng-c.min.x)/(b*this.options.tileSize)),c=Math.ceil((a._northEast.lng-c.min.x)/(b*this.options.tileSize)),d=d.getZoom(),e=this.currLevel!=d,h=this.getGrid(h,m,g,c,d);this.canvasLayer.extent=[a._southWest.lng,a._southWest.lat,a._northEast.lng,a._northEast.lat];this.canvasLayer.res=b;this.canvasLayer.requestLabelTiles(h,e);this.currLevel=d}},getGrid:function(d,a,b,c,h){for(var e=[];b<c;b++)for(var g=d;g<a;g++)e.push({row:g,col:b,level:h});return e},resetCanvasDiv:function(){var d=this.getCanvasXY();L.DomUtil.setPosition(this._container,d);this._center=this._map.getCenter();this._zoom=this._map.getZoom()},getCanvasXY:function(){if(this._map){var d=this._map.dragging._draggable._element.style.transform.match(/(-?\d+\.?\d*)(px)/g),a=d[0].replace("px",""),d=d[1].replace("px","");return{x:-a,y:-d}}},redraw:function(){this.canvasLayer&&this.canvasLayer.redraw()},addDataSource:function(d){this.canvasLayer.addDataSource(d)},removeDataSourceById:function(d){this.canvasLayer.removeDataSourceById(d)},onRemove:function(d){L.DomUtil.remove(this.canvasLayer.root)},addToMap:function(d){d.addLayer(this)},getFeatureByXY:function(d,a){return this.canvasLayer.getFeatureByXY(d,a)},setHasImportant:function(d){this.canvasLayer&&(this.canvasLayer.hasImportant=d)},getHasImportant:function(){return this.canvasLayer?this.canvasLayer.hasImportant:!0},CLASS_NAME:"OpenLayers.Layer.GWVTAnno"});l.exports=f},{"./draw/CanvasLayer":20}],13:[function(f,l,q){var e=f("./GGridIndex"),d=f("./GLabelBox");f=function(a,b){this.grid=null;this.GLabelBox=new d(a,b)};f.prototype.avoid=function(a,b){if(0==b.length)return a;for(var c=0;c<a.length;c++){var h=a[c];1==h.type&&this.avoidPointLine(h,b);2==h.type&&(h.isCollision=this.avoidLineLine(h,b))}return a};f.prototype.avoidPointLine=function(a,b){var c=a.style.direction;b=this.getAvoidLineFeatures(a.weight,b);for(var h=0,d=0;d<b.length;d++)for(var g=b[d],e=0;4>e;e++){var f=c+e;4<=f&&(f-=4);if(this.crashBoxLine(a.boxs[f],g.sourceDatas,!1)&&a.directions[f]&&(delete a.directions[f],h++,4==h))return!0}return!1};f.prototype.avoidLineLine=function(a,b){b=this.getAvoidLineFeatures(a.weight,b);for(var c=0;c<b.length;c++)for(var h=b[c],d,g=0;g<a.boxs.length;g++)if(d=this.crashPartLineLine(a.boxs[g],h.sourceDatas))return!0;return!1};f.prototype.getAvoidLineFeatures=function(a,b){for(var c=[],h=0;h<b.length;h++){var d=b[h];d.weight>a&&c.push(d)}return c};f.prototype.crashBoxLine=function(a,b,c){var h=[];c?(h.push([a[0],a[1],a[2],a[1]]),h.push([a[2],a[1],a[2],a[3]]),h.push([a[2],a[3],a[0],a[3]]),h.push([a[0],a[3],a[0],a[1]])):(h.push([a[0],a[1],a[2],a[3]]),h.push([a[2],a[1],a[0],a[3]]));for(a=0;a<h.length;a++){c=h[a];for(var d=0;d<b.length/2-1;d++)if(this.crashPartLinePartLine(c,[b[2*d],b[2*d+1],b[2*(d+1)],b[2*(d+1)+1]]))return!0}return!1};f.prototype.crashLineLine=function(a,b){for(var c=0;c<a.length/2-1;c++)for(var h=[a[2*c],a[2*c+1],a[2*(c+1)],a[2*(c+1)+1]],d=0;d<b.length/2-1;d++)if(this.crashPartLinePartLine(h,[b[2*d],b[2*d+1],b[2*(d+1)],b[2*(d+1)+1]]))return!0;return!1};f.prototype.crashPartLineLine=function(a,b){for(var c=0;c<b.length/2-1;c++)if(this.crashPartLinePartLine(a,[b[2*c],b[2*c+1],b[2*(c+1)],b[2*(c+1)+1]]))return!0;return!1};f.prototype.crashPartLinePartLine=function(a,b){var c=a[0],d=a[1],e=a[3],g=b[0],f=b[1],k=b[2],p=b[3],t,v;t=a[2]-c;e-=d;k-=g;v=p-f;p=t*v-k*e;if(0==p)return 0;var r=0<p,c=c-g,d=d-f;t=t*d-e*c;if(0>t==r)return 0;d=k*d-v*c;return 0>d==r||t>p==r||d>p==r?0:1};f.prototype.defaultAvoid=function(a,b){this.grid=new e(8192,16,0);if(null==a||1>a.length)return[];a=this.GLabelBox.setBox(a,!1);a=this.mergeFeatures(a);this.sort(a,b);for(var c=0;c<a.length;c++)this.avoidFeature(a[c]);a=this.GLabelBox.filterFeature(a);this.removeRepeat(a);return this.prevFeatures=a=this.filterFeature(a)};f.prototype.avoidFeature=function(a){0==a.style.show||1==a.hidden?a.hidden=!0:a.boxs?1==a.type?this.avoidPoint(a):a.isCollision?a.hidden=!0:this.avoidLine(a):a.hidden=!0};f.prototype.avoidPoint=function(a){if(1==a.style.isImportant)this.addBoxToCells(a.primaryId,a.boxs[a.style.direction]);else if(a.style.isFourDirections&&a.style.texture)this.addFourCollisionFeatureToCells(a,a.style.direction);else if(a.directions[a.style.direction]){var b=a.boxs[a.style.direction];this.isCollision(b)?a.hidden=!0:this.addBoxToCells(a.primaryId,b)}else a.hidden=!0};f.prototype.avoidLine=function(a){if(1==a.style.isImportant)for(var b=0;b<a.boxs.length;b++)this.addBoxToCells(a.primaryId+"index_"+b,a.boxs[b]);else{for(var b=!1,c=0;c<a.boxs.length;c++)if(this.isCollision(a.boxs[c])){b=!0;break}if(b)a.hidden=!0;else for(b=0;b<a.boxs.length;b++)this.addBoxToCells(a.primaryId+"index_"+b,a.boxs[b])}};f.prototype.addFourCollisionFeatureToCells=function(a,b){var c=!0,d=[];a.directions[b]&&(d=a.boxs[b],c=this.isCollision(d));c?(b++,4==b&&(b-=4),b==a.style.direction?a.hidden=!0:this.addFourCollisionFeatureToCells(a,b)):(a.style.textPoint=a.fourPoints[b],this.addBoxToCells(a.primaryId,d))};f.prototype.isCollision=function(a){return 0<this.grid.query(a[0],a[1],a[2],a[3]).length};f.prototype.addBoxToCells=function(a,b){this.grid.insert(a,b[0],b[1],b[2],b[3])};f.prototype.mergeFeatures=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.attributeId]||(b[d.attributeId]=[]);b[d.attributeId].push(d)}for(var e in b)if(c=b[e],1<c.length){d=c[0];if("1"==d.type){for(var g=c[0].directions,f=1;f<c.length;f++)g=this.getBothDirection(g,c[f].directions);var f=!1,k;for(k in g){f=!0;break}for(var p=0;p<c.length;p++)f?c[0].hidden=!0:c[0].directions=g}if("2"==d.type){d=!1;for(g=0;g<c.length;g++)if(1==c[g].isCollision){d=!0;break}if(d)for(d=0;d<c.length;d++)c[d].hidden=!0}}return this.GLabelBox.filterFeature(a)};f.prototype.sort=function(a,b){if(0<a.length)return a.sort(function(a,d){if(b){if(a.style.isImportant&&!d.style.isImportant)return-1;if(d.style.isImportant&&!a.style.isImportant)return 1}var c=a.weight,h=d.weight,e=a.primaryId,f=d.primaryId;c||(c=-1);h||(h=-1);return c<h?1:c==h?e<f?1:-1:-1}.bind(this))};f.prototype.getBothDirection=function(a,b){var c={},d;for(d in a)b[d]&&(c[d]=1);return c};f.prototype.removeRepeat=function(a){for(var b=[],c=[],d=[],e=[],g=[],f=[],k=0;k<a.length;k++){var p=a[k];1==p.type?1==p.drawed?e.push(p):b.push(p):2==p.type&&("text"==p.lineType&&(1==p.drawed?g.push(p):c.push(p)),"code"==p.lineType&&(1==p.drawed?f.push(p):d.push(p)))}for(a=0;a<b.length;a++)this.getShowPointFeatrues(e,b[a]);for(b=0;b<c.length;b++)this.getShowLineTextFeatrues(g,c[b]);for(c=0;c<d.length;c++)this.getShowLineCodeFeatrues(f,d[c]);if(this.prevFeatures)for(d=0;d<this.prevFeatures.length;d++)this.prevFeatures[d].drawed=!1};f.prototype.getShowPointFeatrues=function(a,b){for(var c=!1,d=0;d<a.length;d++){var e=a[d];e.label==b.label&&e.style.distance&&b.style.distance&&this.getDistance(e.style.textPoint,b.style.textPoint)<e.style.distance&&(c=!0,b.hidden=!0)}c||a.push(b)};f.prototype.getShowLineTextFeatrues=function(a,b){for(var c=!1,d=0;d<a.length;d++){var e=a[d];e.label==b.label&&e.style.lineTextDistance&&b.style.lineTextDistance&&this.getDistance(e.centerPoint,b.centerPoint)<e.style.lineTextDistance&&(c=!0,b.hidden=!0)}c||a.push(b)};f.prototype.getShowLineCodeFeatrues=function(a,b){for(var c=!1,d=0;d<a.length;d++){var e=a[d];e.label==b.label&&e.style.lineCodeDistance&&b.style.lineCodeDistance&&this.getDistance(e.centerPoint,b.centerPoint)<e.style.lineCodeDistance&&(c=!0,b.hidden=!0)}c||a.push(b)};f.prototype.getDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.pow(c*c+d*d,.5)};f.prototype.filterFeature=function(a){for(var b=[],c=0;c<a.length;c++)a[c].hidden||(a[c].drawed=!0,b.push(a[c]));return b};l.exports=f},{"./GGridIndex":17,"./GLabelBox":18}],14:[function(f,l,q){var e=f("./GDistance"),d=f("./Util");f=function(){};f.cutLineFeature=function(a){var b=[],c;if(4>a.sourceData.length)return b;var d=this.createLineTextFeatrue(a,0);c=d.index;d.feature&&b.push(d.feature);d=this.createLineCodeFeatrue(a,c);c=d.index;d.feature&&b.push(d.feature);a=this.createLineArrowFeatrue(a,c);a.feature&&b.push(a.feature);return b};f.createLineTextFeatrue=function(a,b){var c=a.style,h=a.sourceData,f=new e,g=[],n=null;if(d.isNotNull(a.label)){a.label+="";for(var k=0;k<a.label.length+1;k++)g.push(1.2*c.lineHeight+2+c.gap);k=[].concat(g);g=f.getNodePath(h,g);f=g.pointList;if(1<f.length){b=g.index;var g=!1,p=a.label.length>f.length?f.length-1:a.label.length-1,t=[f[0][0][0],f[0][0][1]],v=f[p][0],r=d.getAngle(t,v),n=this.cloneFeature(a);n.angle=r;0!=c.changeDirection&&(g=this.isChangeDirection(a.label,t,v,r))&&(f=this.changeDirection(h,f,k,b,p));n.attributeId+="_text";n.sourceAngleData=f;n.lineType="text";f.length<a.label.length&&(b=a.sourceData.length,f.length>.5*a.label.length?this.delayTextPoint(h,f,a.label,c.chinaLabelWidth+c.gap,g):n=null)}else c.showRoadCode||(n=this.cloneFeature(a),n.attributeId+="_text",n.sourceAngleData=[[[h[0],h[1]],0]],n.lineType="text",b=2)}return{feature:n,index:b}};f.createLineCodeFeatrue=function(a,b){var c=a.style,h=a.sourceData,f=new e,g=[],n=null,k=a.roadCodeLabel;return c.showRoadCode&&d.isNotNull(k)&&b<h.length&&(c=h.slice(b,h.length-1),g.push(30),f=f.getNodePath(c,g),g=f.pointList,1==g.length&&(b+=f.index,n=this.cloneFeature(a),n.attributeId+="_code",n.sourceAngleData=g,n.lineType="code",n.label=k+""),0==g.length)?(n=this.cloneFeature(a),n.attributeId+="_code",n.sourceAngleData=[[h,0]],n.lineType="code",n.label=k+"",{feature:n,index:2}):{feature:n,index:b}};f.createLineArrowFeatrue=function(a,b){var c=a.style,d=a.sourceData,f=new e,g=[],n=null;c.showArrow&&b<d.length&&(c=d.slice(b,d.length-1),g.push(16),g.push(16),f=f.getNodePath(c,g).pointList,2==f.length&&(n=this.cloneFeature(a),n.attributeId+="_arrow",n.sourceAngleData=f,n.lineType="arrow"));return{feature:n,index:b}};f.delayTextPoint=function(a,b,c,d,e){a=1==b.length?e?[a[a.length-2],a[a.length-1]]:[a[0],a[1]]:b[b.length-2][0];e=b[b.length-1][0];for(var g=b[b.length-1][1],h=b.length,f=1;f<c.length-h+1;f++){var m=[this.getPoint(a,e,d*f),g];b.push(m)}};f.cloneFeature=function(a){return{type:a.type,datas:a.datas,sourceData:a.sourceData,label:a.label,roadCodeLabel:a.roadCodeLabel,attributeId:a.attributeId,style:a.style,textures:a.textures,xyz:a.xyz,lineType:a.lineType,weight:a.weight,attributes:a.attributes}};f.changeDirection=function(a,b,c,d,f){d=d>=a.length?a.length:d;d=a.slice(0,d);a=[];for(var g=0;g<d.length-1;g++)a.push([d[g],d[g+1]]),g++;a=a.reverse();b=b[f][0];d=[b[0],b[1]];for(b=0;b<a.length;b++)d.push(a[b][0]),d.push(a[b][1]);return b=(new e).getNodePath(d,c).pointList};f.isChangeDirection=function(a,b,c,d){var e=!1;if(/.*[\u4e00-\u9fa5]+.*$/.test(a)){if(b[0]==c[0]&&b[1]>c[1])return!0;-45>d&&-90<d?b[0]<c[0]&&(e=!0):b[0]>c[0]&&(e=!0)}else b[0]>c[0]&&(e=!0);return e};f.getDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.pow(c*c+d*d,.5)};f.getLineDistance=function(a){if(4>a.length)return 0;for(var b=0,c=0;c<a.length/2-1;c++)b+=this.getDistance([a[2*c],a[2*c+1]],[a[2*(c+1)],a[2*(c+1)+1]]);return b};f.getPoint=function(a,b,c){var d=b[0]-a[0],e=b[1]-a[1];a=b[0];0==d?b=0<e?b[1]+c:b[1]-c:(c=Math.sqrt(c*c/(e/d*(e/d)+1)),0>d&&(c=-c),a=b[0]+c,b=b[1]+e/d*c);return[a,b]};l.exports=f},{"./GDistance":15,"./Util":19}],15:[function(f,l,q){f=function(){};f.prototype.getLengthPoint=function(e,d,a,b,c,f){var h=a-e;b-=d;if(0==h)return e=a,d=0<b?d+c:d-c,null==f?[e,d]:[e,d,f];a=b/h;c=Math.abs(c/Math.sqrt(a*a+1));a=Math.abs(c*a);e=0<h?e+c:e-c;d=0<b?d+a:d-a;return null==f?[e,d]:[e,d,f]};f.prototype.getAngle=function(e,d){return 0==d[0]-e[0]?d[1]>e[0]?90:-90:360*Math.atan((d[1]-e[1])/(d[0]-e[0]))/(2*Math.PI)};f.prototype.length=function(e,d,a,b){e=a-e;d=b-d;return Math.sqrt(e*e+d*d)};f.prototype.getNodePath=function(e,d){for(var a=[],b={},c=[],f=d.length,m=function(a){var c=a[0];a.splice(0,1);return c},g=m(d),n=0;;){if(c.length==f||n>=e.length)return b.index=n,b.pointList=c,b;var k=e[n],p=e[n+1];if(0==a.length)a[0]=k,a[1]=p;else{var t=this.length(a[0],a[1],k,p);t>=g?(g=this.getLengthPoint(a[0],a[1],k,p,g,null),k=this.getAngle(a,[k,p]),90==k&&(k=0),-90==k&&(k=0),0==k&&(k=.5),45<=k?k-=90:-45>=k&&(k+=90),c.push([g,k]),a[0]=g[0],a[1]=g[1],g=m(d)):(g-=t,a[0]=k,a[1]=p,n+=2)}}};l.exports=f},{}],16:[function(f,l,q){q=f("../../../utils/gistools/BoxSet");var e=new q(0,512,0,512,512,5),d=new q(0,256,0,256,256,5),a=f("../../../utils/gistools/GisTools"),b=f("./Util");f=function(){};f.draw=function(a,b,d,g,e,f,p){var c=null;g&&(c=new Map);for(g=0;g<b.length;g++){var h=b[g];1==h.type?(this.drawPointIcon(a,h,d,c,f,p),this.drawPoint(a,h,d,c,e,f,p)):2==h.type&&this.drawLine(a,h,d,c,e,f,p)}};f.drawPointIcon=function(a,b,d,g,e,f){var c=b.style;if(c.texture){var h=c.graphicWidth,n=c.graphicHeight,m=b.iconImg;if(m){h&&n||(h=m.width,n=m.height,g&&(h/=d,n/=d));var k=c.graphicXOffset-.5*h,l=c.graphicYOffset-.5*n,q=c.pointOffsetX,u=c.pointOffsetY;q||(q=0);u||(u=0);var w=[b.datas[0][0][0],b.datas[0][0][1]];w[0]+=q;w[1]+=u;k=w[0]+k;l=w[1]+l;w=c.pointFillAlpha||1;if(g)if(c=c.texture+"_"+k+"_"+l,null==g.get(c))g.set(c,!0);else return;a.save();a.globalAlpha=w;a.drawImage(m,k*d,l*d,h*d,n*d);a.restore();f&&(e.save(),this.setHitContextStyle(e,b.id),e.fillRect(k,l,h,n),e.restore())}}};f.drawPoint=function(c,d,e,g,f,k,p){if(d.label){var h=d.style,n=h.textPoint;if(g){var m=a.boxToPolyArr(d.box[0],d.box[1],d.box[2],d.box[3]),l;512==c.canvas.width/e?l=a.boxToPolyArr(-20,-20,532,532):256==c.canvas.width/e&&(l=a.boxToPolyArr(-15,-15,271,271));if(3==a.polyWith(l,m))return;m=d.label+"_"+n[0]+"_"+n[1];if(null==g.get(m))g.set(m,!0);else return}g=d.label.split(" ");m=g.length;l=h.pointHeight;l+=2;var q=b.formatFont(h.pointFillFont,e,f);f=b.formatFont(h.pointStrokeFont,e,f);if(1==h.pointHashBackground){c.save();c.globalAlpha=h.pointBackgroundAlpha;c.strokeStyle=h.pointBackgroundLineColor;c.lineWidth=h.pointBackgroundLineWidth;c.fillStyle=h.pointBackgroundColor;c.font=h.pointFillFont;for(var x=n[0]-h.pointBackgroundGap,u=n[1]-h.pointBackgroundGap-h.pointHeight/2,w=0,y=0;y<m;y++){var z=c.measureText(g[y]).width;z>w&&(w=z)}this.drawRoundRect(c,x,u,w+2*h.pointBackgroundGap,h.pointHeight*m+2*h.pointBackgroundGap+2*(m-1),h.pointBackgroundRadius,e);c.fill();c.restore();for(y=0;y<m;y++)1==h.pointHashOutline&&(c.save(),c.textBaseline="middle",c.globalAlpha=h.pointStrokeAlpha,c.strokeStyle=h.pointStrokeStyle,c.lineWidth=h.pointLineWidth,c.font=f,c.strokeText(g[y],n[0]*e,(n[1]+l*y)*e),c.restore()),c.save(),c.textBaseline="middle",c.globalAlpha=h.pointFillAlpha,c.fillStyle=h.pointFillStyle,c.font=q,c.fillText(g[y],n[0]*e,(n[1]+l*y)*e),c.restore();p&&(k.save(),this.setHitContextStyle(k,d.id),this.drawHitRoundRect(k,x,u,w+2*h.pointBackgroundGap,h.pointHeight+2*h.pointBackgroundGap,h.pointBackgroundRadius),k.fill(),k.restore())}else{for(u=x=0;u<m;u++)1==h.pointHashOutline&&(c.save(),c.textBaseline="middle",c.globalAlpha=h.pointStrokeAlpha,c.strokeStyle=h.pointStrokeStyle,c.lineWidth=h.pointLineWidth,c.font=f,c.strokeText(g[u],n[0]*e,(n[1]+l*u)*e),c.restore()),c.save(),c.textBaseline="middle",c.globalAlpha=h.pointFillAlpha,c.fillStyle=h.pointFillStyle,c.font=q,c.fillText(g[u],n[0]*e,(n[1]+l*u)*e),x=c.measureText(g[u]).width>x?c.measureText(g[u]).width:x,c.restore();p&&(k.save(),this.setHitContextStyle(k,d.id),k.textBaseline="middle",k.fillRect(n[0],n[1]-h.pointHeight/2,x,l*m),k.restore())}}};f.drawLine=function(a,b,d,e,f,k,p){"text"==b.lineType&&this.drawLineText(a,b,d,e,f,k,p);"code"==b.lineType&&this.drawLineCode(a,b,d,e,f,k,p);"arrow"==b.lineType&&this.drawLineArrow(a,b,d,e,k,p)};f.drawLineText=function(a,f,m,g,n,k,p){var c=f.style,h=f.label,l=f.textPoints,A;g&&(512==a.canvas.width/m?A=e:256==a.canvas.width/m&&(A=d));var q=b.formatFont(c.lineFillFont,m,n),x=b.formatFont(c.lineStrokeFont,m,n);if(1==c.lineHashBackground||1==l.length)g=l[Math.floor(l.length/2)][0],1==l.length?this.drawBgText(a,h,m,g,c.backgroundAlpha,c.backgroundLineColor,c.backgroundLineWidth,c.backgroundColor,c.lineFillFont,c.lineBackgroundGap,c.lineHeight,c.lineBackgroundRadius,c.lineHashOutline,c.lineStrokeAlpha,c.lineStrokeStyle,c.lineLineWidth,c.lineStrokeFont,c.lineFillAlpha,c.lineFillStyle,k,p,f.id,!1,n):this.drawBgText(a,h,m,g,c.backgroundAlpha,c.backgroundLineColor,c.backgroundLineWidth,c.backgroundColor,c.lineFillFont,c.lineBackgroundGap,c.lineHeight,c.lineBackgroundRadius,c.lineHashOutline,c.lineStrokeAlpha,c.lineStrokeStyle,c.lineLineWidth,c.lineStrokeFont,c.lineFillAlpha,c.lineFillStyle,k,p,f.id,!0,n);else for(n=0;n<h.length;n++){var u=l[n],w=u[1],u=u[0],y=h.charAt(n);if(g){var z=y+"_"+u[0]+"_"+u[1]+"_"+w;if(null!=g.get(z))continue;g.set(z,!0);if(!A["in"]([u[0]/m,u[1]/m]))continue}1==c.lineHashOutline&&(a.save(),a.textAlign="center",a.textBaseline="middle",a.globalAlpha=c.lineStrokeAlpha,a.strokeStyle=c.lineStrokeStyle,a.lineWidth=c.lineLineWidth,a.font=x,a.translate(u[0]*m,u[1]*m),a.rotate(w*Math.PI/180),a.strokeText(y,0,0),a.restore());a.save();a.textAlign="center";a.textBaseline="middle";a.globalAlpha=c.lineFillAlpha;a.fillStyle=c.lineFillStyle;a.font=q;a.translate(u[0]*m,u[1]*m);a.rotate(w*Math.PI/180);a.fillText(y,0,0);a.restore();p&&(k.save(),this.setHitContextStyle(k,f.id),k.translate(u[0],u[1]),k.rotate(w*Math.PI/180),k.fillRect(.6*-c.lineHeight,.6*-c.lineHeight,1.2*c.lineHeight,1.2*c.lineHeight),k.restore())}};f.drawLineCode=function(a,b,d,e,f,k,p){e=b.style;var c=b.codePoint,g=b.label;1==e.showRoadCode&&g&&0<g.length&&this.drawBgText(a,g,d,c,e.codeBackgroundAlpha,e.codeBackgroundLineColor,e.codeBackgroundLineWidth,e.codeBackgroundColor,e.codeLineFillFont,e.codeLineBackgroundGap,e.codeLineHeight,e.codeLineBackgroundRadius,e.codeLineHashOutline,e.codeLineStrokeAlpha,e.codeLineStrokeStyle,e.codeLineLineWidth,e.codeLineStrokeFont,e.codeLineFillAlpha,e.codeLineFillStyle,k,p,b.id,!0,f)};f.drawLineArrow=function(a,b,d,e,f,k){e=b.arrowPoint;f=b.style;b=e[0][0];e=e[1][0];a.save();a.lineWidth=2;a.strokeStyle="#666666";a.fillStyle="#666666";a.beginPath();a.moveTo(b[0]*d,b[1]*d);a.lineTo(e[0]*d,e[1]*d);a.stroke();0==f.arrowDirectionValue?(f=Math.atan((e[1]-b[1])/(e[0]-b[0])),f+=(e[0]>b[0]?-90:90)*Math.PI/180,this.drawArrowhead(a,b[0],b[1],f,d)):(f=Math.atan((e[1]-b[1])/(e[0]-b[0])),f+=(e[0]>b[0]?90:-90)*Math.PI/180,this.drawArrowhead(a,e[0],e[1],f,d));a.restore()};f.drawArrowhead=function(a,b,d,e,f){a.beginPath();a.translate(b*f,d*f);a.rotate(e);a.moveTo(0,0);a.lineTo(3*f,6*f);a.lineTo(0,5);a.lineTo(-3*f,6*f);a.closePath();a.fill()};f.drawRoundRect=function(a,b,d,e,f,k,p){a.beginPath();a.arc((b+k)*p,(d+k)*p,k*p,Math.PI,3*Math.PI/2);a.lineTo((e-k+b)*p,d*p);a.arc((e-k+b)*p,(k+d)*p,k*p,3*Math.PI/2,2*Math.PI);a.lineTo((e+b)*p,(f+d-k)*p);a.arc((e-k+b)*p,(f-k+d)*p,k*p,0,1*Math.PI/2);a.lineTo((k+b)*p,(f+d)*p);a.arc((k+b)*p,(f-k+d)*p,k*p,1*Math.PI/2,Math.PI);a.closePath()};f.drawBgText=function(a,d,e,f,n,k,p,t,l,r,q,G,x,u,w,y,z,B,N,E,R,S,V,H){a.save();a.globalAlpha=n;a.strokeStyle=k;a.lineWidth=p;a.fillStyle=t;a.font=b.formatFont(l,1,H);n=a.measureText(d).width;k=f[0]-n/2-r;p=f[1]-q/2-r;V&&(this.drawRoundRect(a,k,p,n+2*r,q+2*r,G,e),a.fill());a.restore();l=b.formatFont(l,e,H);z=b.formatFont(z,e,H);1==x&&(a.save(),a.textAlign="center",a.textBaseline="middle",a.globalAlpha=u,a.strokeStyle=w,a.lineWidth=y,a.font=z,a.translate(f[0]*e,f[1]*e),a.strokeText(d,0,0),a.restore());a.save();a.textAlign="center";a.textBaseline="middle";a.globalAlpha=B;a.fillStyle=N;a.font=l;a.translate(f[0]*e,f[1]*e);a.fillText(d,0,0);a.restore();R&&(E.save(),this.setHitContextStyle(E,S),this.drawHitRoundRect(E,k,p,n+2*r,q+2*r,G),E.fill(),E.restore())};f.featureIdToHex=function(a){a="000000"+(Number(a)+1).toString(16);var c=a.length;return a="#"+a.substring(c-6,c)};f.setHitContextStyle=function(a,b){var c=this.featureIdToHex(b);a.globalAlpha=1;a.fillStyle=c};f.drawHitRoundRect=function(a,b,d,e,f,k){a.beginPath();a.arc(b+k,d+k,k,Math.PI,3*Math.PI/2);a.lineTo(e-k+b,d);a.arc(e-k+b,k+d,k,3*Math.PI/2,2*Math.PI);a.lineTo(e+b,f+d-k);a.arc(e-k+b,f-k+d,k,0,1*Math.PI/2);a.lineTo(k+b,f+d);a.arc(k+b,f-k+d,k,1*Math.PI/2,Math.PI);a.closePath()};l.exports=f},{"../../../utils/gistools/BoxSet":34,"../../../utils/gistools/GisTools":35,"./Util":19}],17:[function(f,l,q){function e(a,b,c){var e=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0];b=f[1];c=f[2];this.d=b+2*c;for(var g=0;g<this.d*this.d;g++){var n=f[d+g],k=f[d+g+1];e.push(n===k?null:f.subarray(n,k))}g=f[d+e.length+1];this.keys=f.subarray(f[d+e.length],g);this.bboxes=f.subarray(g);this.insert=this._insertReadonly}else{this.d=b+2*c;for(f=0;f<this.d*this.d;f++)e.push([]);this.keys=[];this.bboxes=[]}this.n=b;this.extent=a;this.padding=c;this.scale=b/a;this.uid=0;b=c/b*a;this.min=-b;this.max=a+b}l.exports=e;var d=3;e.prototype.insert=function(a,b,c,d,e){this._forEachCell(b,c,d,e,this._insertCell,this.uid++);this.keys.push(a);this.bboxes.push(b);this.bboxes.push(c);this.bboxes.push(d);this.bboxes.push(e)};e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer.";};e.prototype._insertCell=function(a,b,c,d,e,f){this.cells[e].push(f)};e.prototype.query=function(a,b,c,d){var e=this.min,f=this.max;if(a<=e&&b<=e&&f<=c&&f<=d)return Array.prototype.slice.call(this.keys);e=[];this._forEachCell(a,b,c,d,this._queryCell,e,{});return e};e.prototype._queryCell=function(a,b,c,d,e,f,n){e=this.cells[e];if(null!==e)for(var g=this.keys,h=this.bboxes,m=0;m<e.length;m++){var l=e[m];if(void 0===n[l]){var r=4*l;a<=h[r+2]&&b<=h[r+3]&&c>=h[r+0]&&d>=h[r+1]?(n[l]=!0,f.push(g[l])):n[l]=!1}}};e.prototype._forEachCell=function(a,b,c,d,e,f,n){for(var g=this._convertToCellCoord(a),h=this._convertToCellCoord(b),m=this._convertToCellCoord(c),l=this._convertToCellCoord(d);g<=m;g++)for(var r=h;r<=l;r++)if(e.call(this,a,b,c,d,this.d*r+g,f,n))return};e.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))};e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,b=d+this.cells.length+1+1,c=0,e=0;e<this.cells.length;e++)c+=this.cells[e].length;c=new Int32Array(b+c+this.keys.length+this.bboxes.length);c[0]=this.extent;c[1]=this.n;c[2]=this.padding;for(e=0;e<a.length;e++){var f=a[e];c[d+e]=b;c.set(f,b);b+=f.length}c[d+a.length]=b;c.set(this.keys,b);b+=this.keys.length;c[d+a.length+1]=b;c.set(this.bboxes,b);return c.buffer}},{}],18:[function(f,l,q){var e=f("./Util");f=function(d,a){this.boxDistance=0;this.ctx=d;this.formatFont=a};f.prototype.setBox=function(d,a){d.forEach(function(b,c){b.hidden=!1;b.label=e.formatLabel(b.label);0==b.style.show?b.hidden=!0:(1==b.type&&(a?this.setPointBox(b,b.sourceAngleData,this.ctx):this.setPointBox(b,b.datas,this.ctx)),2==b.type&&("text"==b.lineType&&(a?this.setTextLineBox(b,b.sourceAngleData,this.ctx):this.setTextLineBox(b,b.datas,this.ctx)),"code"==b.lineType&&(a?this.setCodeLineBox(b,b.sourceAngleData,this.ctx):this.setCodeLineBox(b,b.datas,this.ctx)),"arrow"==b.lineType&&(a?this.setArrowLineBox(b,b.sourceAngleData):this.setArrowLineBox(b,b.datas))))}.bind(this));return this.filterFeature(d)};f.prototype.setPointBox=function(d,a,b){var c=d.style,f,m,g=c.graphicWidth,n=c.graphicHeight;(f=d.iconImg)?g&&n||(g=f.width,n=f.height):n=g=0;f=g;m=n;if(c.labelFunction){var k=new Function("label",c.labelFunction);try{d.label=k.call({},d.label)}catch(v){console.warn(d.label+": \u8c03\u7528labelFunction\u5931\u8d25!")}}if((k=e.isNotNull(d.label))||0!=g&&0!=n){if(k){d.label+="";m=d.label.split(" ");f=0;b.save();b.font=this.formatFont?e.formatFont(c.pointFillFont,1,!0):c.pointFillFont;for(k=0;k<m.length;k++){var p=b.measureText(m[k]).width;f=p>f?p:f}b.restore();m=c.pointHeight*m.length+2*(m.length-1);m=m>n?m:n}b=c.pointOffsetX;k=c.pointOffsetY;b||(b=0);k||(k=0);a=[a[0][0][0],a[0][0][1]];a[0]+=b;a[1]+=k;1!=c.pointHashBackground&&(c.pointBackgroundGap=0);if(0==n||0==g)c.graphicDistance=0;b=[a[0]-.5*g,a[1]-c.pointBackgroundGap-.5*m,a[0]+.5*g+c.graphicDistance+f+2*c.pointBackgroundGap,a[1]+.5*m+c.pointBackgroundGap];var k=[a[0]-.5*g-c.graphicDistance-f-2*c.pointBackgroundGap,b[1],a[0]+.5*g,b[3]],p=[a[0]-.5*f-c.pointBackgroundGap,a[1]-.5*n,a[0]+.5*f+c.pointBackgroundGap,a[1]+.5*n+c.graphicDistance+2*c.pointBackgroundGap+m],t=[p[0],a[1]-c.graphicDistance-2*c.pointBackgroundGap-m-.5*n,p[2],a[1]+.5*n];b=this.boxScale(b,c.pointBoxDisance);k=this.boxScale(k,c.pointBoxDisance);p=this.boxScale(p,c.pointBoxDisance);t=this.boxScale(t,c.pointBoxDisance);b=[b,k,p,t];c.direction||(c.direction=0);d.boxs=b;d.box=b[c.direction];b=n;c.pointHeight>n&&(b=c.pointHeight);k=[a[0]-.5*f,a[1]+c.graphicDistance+c.pointBackgroundGap+.5*b+.5*n];g=[[a[0]+.5*g+c.graphicDistance+c.pointBackgroundGap,a[1]-.5*m+.5*b],[a[0]-.5*g-c.graphicDistance-c.pointBackgroundGap-f,a[1]-.5*m+.5*b],k,[k[0],a[1]-c.graphicDistance-c.pointBackgroundGap-m+.5*b-.5*n]];d.fourPoints=g;d.style.textPoint=g[c.direction]}else d.hidden=!0};f.prototype.setTextLineBox=function(d,a,b){var c=d.label;if(0==a.length)d.hidden=!0;else{var f=d.style;d.textPoints=a;var m=[];if(1==f.lineHashBackground||1==a.length){var g=a[0][0];1<a.length&&(g=a[Math.floor(c.length/2)][0]);b.save();b.font=this.formatFont?e.formatFont(f.lineFillFont,1,!0):f.lineFillFont;a=b.measureText(d.label).width;b.restore();a=[g[0]-a/2-f.lineBackgroundGap,g[1]-.5*f.lineHeight-f.lineBackgroundGap,g[0]+a/2+f.lineBackgroundGap,g[1]+.5*f.lineHeight+f.lineBackgroundGap];this.boxScale(a,f.lineTextBoxDisance);m.push(a)}else{if(f.lineTextRotate)for(b=0;b<a.length;b++)a[b][1]=f.lineTextRotate;else if(this.textToSameBearing(d.angle,a),!f.isImportant&&this.isMessy(a,f,c)){d.hidden=!0;return}if(f=this.getLineBoxs(c,a,f))m=m.concat(f);else{d.hidden=!0;return}}d.boxs=m}};f.prototype.setCodeLineBox=function(d,a,b){if(0==a.length)d.hidden=!0;else{var c=d.style;a=a[0][0];b.save();b.font=this.formatFont?e.formatFont(c.codeLineFillFont,1,!0):c.codeLineFillFont;var f=b.measureText(d.label).width;b.restore();b=[a[0]-f/2-c.codeLineBackgroundGap,a[1]-.5*c.codeLineHeight-c.codeLineBackgroundGap,a[0]+f/2+c.codeLineBackgroundGap,a[1]+.5*c.codeLineHeight+c.codeLineBackgroundGap];this.boxScale(b,c.lineCodeBoxDisance);d.boxs=[b];d.codePoint=a}};f.prototype.setArrowLineBox=function(d,a){if(2!=a.length)d.hiden=!0;else{var b=a[0][0],c=a[1][0],b=[b[0]<c[0]?b[0]:c[0],b[1]<c[1]?b[1]:c[1],b[0]>c[0]?b[0]:c[0],b[1]>c[1]?b[1]:c[1]];this.boxScale(b,d.style.lineArrowBoxDisance);d.boxs=[b];d.arrowPoint=a}};f.prototype.filterFeature=function(d){for(var a=[],b=0;b<d.length;b++)d[b].hidden||a.push(d[b]);return a};f.prototype.isMessy=function(d,a,b){for(var c=d[0][0],e=c[0],f=c[1],g=c[0],c=c[1],n=d[0][1],k=d[0][1],p=0;p<b.length;p++){var t=d[p][0],l=d[p][1];t[0]>g&&(g=t[0]);t[0]<e&&(e=t[0]);t[1]>c&&(c=t[1]);t[1]<f&&(f=t[1]);l>k&&(k=l);l<n&&(n=l)}if(k-n>a.angle)if(0==a.angleSwitch&&a.angleColor)a.lineFillStyle=a.angleColor;else return!0;return!1};f.prototype.getLineBoxs=function(d,a,b){for(var c=[],e=[],f=0;f<d.length;f++){var g=a[f][0];0==a[f][1]&&(a[f][1]=.5);var n=[g[0]-.6*b.lineHeight,g[1]-.6*b.lineHeight,g[0]+.6*b.lineHeight,g[1]+.6*b.lineHeight];this.boxScale(n,b.lineTextBoxDisance);e.push([g[0]-.5*b.lineHeight,g[1]-.6*b.lineHeight,g[0]+.5*b.lineHeight,g[1]+.5*b.lineHeight]);c.push(n)}if(!b.isImportant)for(d=0;d<e.length-1;d++)for(a=e[d],b=d+1;b<e.length;b++)if(this.crashBox(a,e[b]))return null;return c};f.prototype.crashBox=function(d,a){return d[0]<=a[2]&&d[2]>=a[0]&&d[1]<=a[3]&&d[3]>=a[1]};f.prototype.boxScale=function(d,a){a||(a=this.boxDistance);d[0]-=.5*a;d[1]-=.5*a;d[2]+=.5*a;d[3]+=.5*a;return d};f.prototype.textToSameBearing=function(d,a){45<=d?d-=90:-45>=d&&(d+=90);for(var b=0;b<a.length;b++){var c=a[b][1],e=d-c;45<e&&(a[b][1]=c+90);-45>e&&(a[b][1]=c-90)}};l.exports=f},{"./Util":19}],19:[function(f,l,q){f=function(){};f.getRealLength=function(e){for(var d=e.length,a=0,b=0;b<d;b++)var c=e.charCodeAt(b),a=0<=c&&128>=c?a+.5:a+1;return a};f.isNotNull=function(e){return!e&&0!=e||"string"==typeof e&&(e=e.toLowerCase(),""==e||"undefined"==e||"null"==e)?!1:!0};f.formatFont=function(e,d,a){var b=e;a&&(e=e.split(" "),e[e.length-1]="SimHei",b=e.join(" "));return b.replace(/(\d+\.?\d*)(px|em|rem|pt)/g,function(a,b,e){b=12>b?12*d:Math.round(b)*d;return b+e})};f.formatLabel=function(e){e&&0<e.length&&(e=e.replace(/([\x00-\x1f\x7f])/g,""),e=e.replace(/(\s*$)/g,""),e=e.replace(/<br\/>/g,""));return e};f.getAngle=function(e,d){return 0==d[0]-e[0]?d[1]>e[0]?90:-90:360*Math.atan((d[1]-e[1])/(d[0]-e[0]))/(2*Math.PI)};l.exports=f},{}],20:[function(f,l,q){var e=f("../../../utils/Cache"),d=f("../avoid/GDrawGeomerty");q=f("./../../../utils/es6-promise");var a=q.Promise,b=q.getParamJSON,c=f("./LabelDrawer"),h=f("./../avoid/GAnnoAvoid"),m=f("./../avoid/GCutLine");f=function(){this.height=this.width=0;this.grid=[];this.cache=new e(256);this.gwvtAnno=null;this.dataSource=[];this.isReady=!1;this.maxExtent=[];this.extent=[];this.res=0;this.tileSize=256;this.hitDetection=!1;this.features=[];this.requestingTiles={};this.hasImportant=!0;this.ratio=1;var a=document.createElement("CANVAS").getContext("2d",{isQuality:!0});this.GAnnoAvoid=new h(a,!1)};f.prototype.init=function(a,b,c,d){this.tileSize=c;this.gwvtAnno=d;this.initCanvas(a,b);this.loadResources()};f.prototype.loadResources=function(){if(0==this.dataSource.length)this.isReady=!1;else{this.cache.clean();for(var b=[],c=0;c<this.dataSource.length;c++){var d=this.dataSource[c];"URLDataSource"==d.type&&(b=b.concat(d.loadStyle()));"LocalDataSource"==d.type&&(b=b.concat(d.loadTexture()))}0<b.length?a.all(b).then(function(){this.isReady=!0;0<this.grid.length&&this.requestLabelTiles(this.grid)}.bind(this)):this.isReady=!0}};f.prototype.initCanvas=function(a,b){this.width=a;this.height=b;this.root||(this.root=document.createElement("canvas"));this.root.style.width=this.width+"px";this.root.style.height=this.height+"px";this.root.width=this.width*this.ratio;this.root.height=this.height*this.ratio;this.root.id="labelCanvas";this.canvas=this.root.getContext("2d",{isQuality:!0});this.hitDetection&&(this.hitCanvas||(this.hitCanvas=document.createElement("canvas")),this.hitCanvas.style.width=this.width+"px",this.hitCanvas.style.height=this.height+"px",this.hitCanvas.width=this.width,this.hitCanvas.height=this.height,this.hitContext=this.hitCanvas.getContext("2d",{isQuality:!0}))};f.prototype.addDataSource=function(a){"URLDataSource"==a.type&&(a.url=a.url+"\x26tilesize\x3d"+this.tileSize);"URLDataSource"!=a.type&&"LocalDataSource"!=a.type||this.dataSource.push(a)};f.prototype.removeDataSourceById=function(a){for(var b=0;b<this.dataSource.length;b++)if(this.dataSource[b].id==a){this.dataSource.splice(b,1);break}};f.prototype.getDataSourceById=function(a){for(var b=0;b<this.dataSource.length;b++)if(this.dataSource[b].id==a)return this.dataSource[b]};f.prototype.clean=function(){this.canvas.clearRect(0,0,this.width*this.ratio,this.height*this.ratio);this.hitContext&&this.hitContext.clearRect(0,0,this.width,this.height)};f.prototype.redraw=function(){0!=this.grid.length&&(this.cache.clean(),this.loadResources())};f.prototype.requestLabelTiles=function(a,b){this.grid=a;if(this.isReady){var c=this.getRequestTileUrls(a);this.sendRequest(c)}};f.prototype.getLocalLabelDatas=function(){for(var a=[],b=0;b<this.dataSource.length;b++){var c=this.dataSource[b];if("LocalDataSource"==c.type)for(var d=0;d<c.features.length;d++){var e=c.features[d];e.inBounds(this.extent)&&(1==e.type&&(e.sourceAngleData=[[e.sourceData,0]],e.transformData(this.extent,this.res),e.label=e.getFeatureLabel(),e.textures=c.textures,a.push(e)),2==e.type&&(e.label=e.getFeatureLabel(),e.textures=c.textures,a=a.concat(this.cutLineFeature(e,!0))))}}return a};f.prototype.getRequestTileUrls=function(a){this.hitCacheUrls=[];this.currentTileDatas=[];for(var b={},c={},d=0;d<this.dataSource.length;d++){var e=this.dataSource[d];if("URLDataSource"==e.type)for(var f=e.url,g=0;g<a.length;g++){var h=a[g],m=f.replace("${x}",h.col).replace("{x}",h.col),m=m.replace("${y}",h.row).replace("{y}",h.row),m=m.replace("${z}",h.level).replace("{z}",h.level);if(0<e.urlArray.length)var l=e.urlArray[Math.round(Math.random()*(e.urlArray.length-1))],m=m.split("/mapserver")[1],m=l+"/mapserver"+m;this.cache.getItem(m)?this.hitCacheUrls.push(m):this.requestingTiles[m]?c[m]=!0:b[m]={url:m,xyz:h,dataSourceId:e.id,dataType:"json"}}}this.cancelRequest(c);return b};f.prototype.cancelRequest=function(a){for(var b in this.requestingTiles)if(!a[b]){var c=this.requestingTiles[b];delete this.requestingTiles[b];c.xhr.abort();c.requestItem.cancel=!0}};f.prototype.sendRequest=function(a){var c=0,d;for(d in a){var e=a[d],f=b(e);this.requestingTiles[e.url]={xhr:f.xhr,requestItem:e};f.then(this.tileSuccessFunction.bind(this),this.tileFailFunction.bind(this));c++}0==c&&this.sendSuccess([])};f.prototype.tileSuccessFunction=function(a){if(1!=a.param.cancel){var b=a.param.url;delete this.requestingTiles[b];a=this.parseFeature(a);var c=this.GAnnoAvoid.GLabelBox.setBox(a.labelFeatures,a.avoidLineFeatures,!0),c=this.GAnnoAvoid.avoid(c,a.avoidLineFeatures);this.currentTileDatas.push({url:b,labelFeatures:c,avoidLineFeatures:a.avoidLineFeatures});this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas)}};f.prototype.isEmptyObject=function(a){for(var b in a)return!1;return!0};f.prototype.tileFailFunction=function(a){1!=a.param.cancel&&(delete this.requestingTiles[a.param.url],this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas))};f.prototype.sendSuccess=function(a){if(!this.gwvtAnno.animating){for(var b=this.mergeLabelData(a,this.hitCacheUrls).labelFeatures,c=0;c<a.length;c++){var e=a[c];this.cache.push(e.url,e)}a=this.getLocalLabelDatas();b=b.concat(a);this.avoidlabelDatas=this.GAnnoAvoid.defaultAvoid(b,this.hasImportant);this.gwvtAnno.resetCanvasDiv();this.clean();if(this.hitDetection)for(this.features=[],b=0;b<this.avoidlabelDatas.length;b++)a=this.avoidlabelDatas[b],this.features[a.id]=a;d.draw(this.canvas,this.avoidlabelDatas,this.ratio,!1,!1,this.hitContext,this.hitDetection)}};f.prototype.drawAvoidLine=function(a){this.canvas.save();this.canvas.beginPath();for(var b=0;b<a.length;b++){var c=a[b];this.canvas.lineWidth=1;this.canvas.strokeStyle="#fff000";this.canvas.moveTo(c.datas[0],c.datas[1]);for(j=1;j<c.datas.length/2;j++)this.canvas.lineTo(c.datas[2*j],c.datas[2*j+1])}this.canvas.stroke();this.canvas.restore()};f.prototype.parseFeature=function(a){var b=a.data,d=a.param.xyz,e=0,f;for(f in b)b[f].xyz=d,e++;f=[];var g=this.getDataSourceById(a.param.dataSourceId);if(0<e&&g&&g.styleFun){e=[];a=a.param.xyz.level;var h=new c(b,a,e);g.styleFun.call({},h,a);for(a=0;a<e.length;a++)h=e[a],h.textures=g.textures,f=f.concat(this.parseItemData(h))}b=this.parseAvoidLine(b._layerAvoids,d);return{labelFeatures:f,avoidLineFeatures:b}};f.prototype.parseAvoidLine=function(a,b){var c=[],d;for(d in a){var e=a[d];d=parseInt(d);for(var f=0;f<e.length;f++){var g={};g.weight=d;g.sourceDatas=e[f];g.datas=this.transformAvoidLine(e[f],b);g.xyz=b;c.push(g)}}return c};f.prototype.transformAvoidLine=function(a,b){for(var c=(this.extent[0]-this.maxExtent[0])/this.res,d=(this.maxExtent[3]-this.extent[3])/this.res,e=[],f=0;f<a.length/2;f++){var g=a[2*f+1]+b.row*this.tileSize;e.push(a[2*f]+b.col*this.tileSize-c);e.push(g-d)}return e};f.prototype.parseItemData=function(a){var b=[];1==a.type&&(b=this.parsePoint(a));2==a.type&&("LINESTRING"==a[0]&&(b=b.concat(this.parseLine(a))),"MULTILINESTRING"==a[0]&&(b=b.concat(this.parseMultiLine(a,a[2][0][0]))));return b};f.prototype.parsePoint=function(a){var b=[],c=a[2],d=[[c,0]],e=this.transformData(d,a.xyz),f=a.style,h=a.fieldValueMap[f.labelfield],g=a.fieldValueMap.attributeId+"_row_"+a.xyz.row+"_col_"+a.xyz.col+"_level_"+a.xyz.level+"_x_"+d[0][0][0]+"_y_"+d[0][0][1],m=0;a.fieldValueMap[f.avoidField]&&(m=parseInt(a.fieldValueMap[f.avoidField]),isNaN(m)&&(m=0));b.push({id:Math.round(16777216*Math.random()),type:a.type,datas:e,sourceData:c,sourceAngleData:d,label:h,attributeId:a.fieldValueMap.attributeId,primaryId:g,style:f,iconImg:a.textures[f.texture],xyz:a.xyz,weight:m,directions:{0:1,1:1,2:1,3:1},attributes:a.fieldValueMap});return b};f.prototype.parseLine=function(a){return 0==a[2].length?[]:Array.isArray(a[2][0][0])?this.parseMultiLine(a,a[2][0]):this.parseMultiLine(a,a[2])};f.prototype.parseMultiLine=function(a,b){for(var c=[],d=a.style,e=0;e<b.length;e++){var f=b[e];if(0!=f.length){var h=a.fieldValueMap[d.labelfield],g=a.fieldValueMap[d.roadCodeLabel],m=0;a.fieldValueMap[d.avoidField]&&(m=parseInt(a.fieldValueMap[d.avoidField]));c=c.concat(this.cutLineFeature({type:a.type,sourceData:f,label:h,weight:m,roadCodeLabel:g,attributeId:a.fieldValueMap.attributeId,style:d,textures:a.textures,xyz:a.xyz,attributes:a.fieldValueMap},!1))}}return c};f.prototype.cutLineFeature=function(a,b){for(var c=m.cutLineFeature(a),d=0;d<c.length;d++){var e=c[d];e.datas=b?a.transformData(this.extent,this.res):this.transformData(e.sourceAngleData,e.xyz);e.primaryId=e.attributeId+"_row_"+a.xyz.row+"_col_"+a.xyz.col+"_level_"+a.xyz.level+"_x_"+e.sourceAngleData[0][0][0]+"_y_"+e.sourceAngleData[0][0][1];e.id=Math.round(16777216*Math.random());"text"==e.lineType&&(e.centerPoint=e.datas[Math.floor(e.datas.length/2)][0]);"code"==e.lineType&&(e.centerPoint=e.datas[0][0])}return c};f.prototype.transformData=function(a,b){for(var c=(this.extent[0]-this.maxExtent[0])/this.res,d=(this.maxExtent[3]-this.extent[3])/this.res,e=[],f=0;f<a.length;f++){var h=a[f][0];e.push([[h[0]+b.col*this.tileSize-c,h[1]+b.row*this.tileSize-d],a[f][1]])}return e};f.prototype.mergeLabelData=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)var f=a[e],c=c.concat(f.labelFeatures),d=d.concat(f.avoidLineFeatures);for(e=0;e<b.length;e++){for(var f=this.cache.getItem(b[e]).labelFeatures,h=0;h<f.length;h++){var g=f[h];g.datas=this.transformData(g.sourceAngleData,g.xyz);"text"==g.lineType&&(g.centerPoint=g.datas[Math.floor(g.datas.length/2)][0]);"code"==g.lineType&&(g.centerPoint=g.datas[0][0])}c=c.concat(f);f=this.cache.getItem(b[e]).avoidLineFeatures;for(h=0;h<f.length;h++)g=f[h],g.datas=this.transformAvoidLine(g.sourceDatas,g.xyz);d=d.concat(f)}return{labelFeatures:c,avoidLineFeatures:d}};f.prototype.getFeatureByXY=function(a,b){var c=null;if(this.hitDetection){var d=this.hitContext.getImageData(a,b,1,1).data;if(255===d[3]&&(d=d[2]+256*(d[1]+256*d[0])))try{c=this.features[d-1]}catch(t){}}return c};l.exports=f},{"../../../utils/Cache":31,"../avoid/GDrawGeomerty":16,"./../../../utils/es6-promise":33,"./../avoid/GAnnoAvoid":13,"./../avoid/GCutLine":14,"./LabelDrawer":21}],21:[function(f,l,q){f=function(e,d,a){this.layerDataMap=e;this.level=d;this.features=a};f.prototype.getLayer=function(e){this.labelDatas=[];var d=this.layerDataMap[e];if(null==d||null==d.features)return this;for(var a=0;a<d.features.length;a++){var b=d.features[a];b.layerName=e;b.xyz=d.xyz;b.type=d.type;b.fieldValueMap||(b.fieldValueMap=this.getFieldValueMap(d,b));this.labelDatas.push(b)}return this};f.prototype.getGroupLayer=function(e,d){this.labelDatas=[];var a=d.split(","),b=a.length;if(0==b)return this;var c=this.layerDataMap[e];if(null==c||null==c.features)return this;for(var f=0;f<b;f++)if(null!=c.features[a[f]]){var m=c.features[i];m.layerName=e;m.xyz=c.xyz;m.type=c.type;m.fieldValueMap||(m.fieldValueMap=this.getFieldValueMap(c,m));this.labelDatas.push(m)}return this};f.prototype.setStyle=function(e){for(var d={},a=0;a<this.labelDatas.length;d={labelData:d.labelData},a++){d.labelData=this.labelDatas[a];var b=function(a){return function(b){return a.labelData.fieldValueMap[b]}}(d);(b=e.call({},this.level,b))&&1==b.show&&(d.labelData.style=b,d.labelData.fieldValueMap.avoidWeight=b.avoidWeight,this.features.push(d.labelData))}};f.prototype.getFieldValueMap=function(e,d){for(var a={},b=0;b<e.fieldsConfig.length;b++){var c=e.fieldsConfig[b].name,f=e.fieldsConfig[b].index;1==e.fieldsConfig[b].id&&(a.attributeId=d.layerName+d[1][f]);a[c]=d[1][f]}return a};f.prototype.draw=function(){};l.exports=f},{}],22:[function(f,l,q){f=function(){this.id=Math.round(16777216*Math.random());this.type=1;this.sourceData=[];this.datas=[];this.sourceAngleData=[];this.attributes={};this.style={}};f.prototype.addAttribute=function(e,d){this.attributes[e]=d};f.prototype.removeAttributeByKey=function(e){delete this.attributes[e]};f.prototype.getMaxExtent=function(){if(0==this.sourceData.length)return null;for(var e=this.sourceData[0],d=this.sourceData[0],a=this.sourceData[1],b=this.sourceData[1],c=2;c<this.sourceData.length;c++){var f=this.sourceData[c],m=this.sourceData[c+1];f>d&&(d=f);f<e&&(e=f);m>b&&(b=m);m<a&&(a=m);c++}return[e,a,d,b]};f.prototype.inBounds=function(e){var d=this.getMaxExtent();return d?d[0]<=e[2]&&d[2]>=e[0]&&d[1]<=e[3]&&d[3]>=e[1]:!1};f.prototype.transformData=function(e,d){this.datas=[];if(0!=this.sourceData.length){for(var a=e[0],b=e[3],c=[],f=0;f<this.sourceAngleData.length;f++){var m=this.sourceAngleData[f][0];c.push([[(m[0]-a)/d,(b-m[1])/d],this.sourceAngleData[f][1]])}this.datas=c}};f.prototype.getFeatureLabel=function(){var e=this.style.labelfield;return e&&this.attributes[e]?this.attributes[e]+"":null};l.exports=f},{}],23:[function(f,l,q){q=f("./GVMapGrid");f("./draw/GVMapGridUtil");f=q.extend({styleObj:{},styleJs:null,initialize:function(e,d){d.isDynamicMap=!0;1.5<window.devicePixelRatio&&(this.ratio=2);this.sourceUrl||(this.sourceUrl=e);d&&d.tileSize&&(this.tilesize=d.tileSize);this.gVMapGridUtil=new Custom.GVMapGridUtil(d.isDynamicMap);this.gVMapGridUtil.tileSize=this.tilesize;this.gVMapGridUtil.parseUrl(e);this._url=e+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version;L.setOptions(this,d);this.hitDetection=d.hitDetection;this.on("tileunload",this._onTileRemove);this.on("tileload",this._onTileLoad);this.on("tileerror",this._onTileError)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version+"\x26control\x3d"+this.control);this.controlId&&(this._url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version+"\x26controlId\x3d"+this.controlId);this._initContainer();this._levels={};this._tiles={};this.gVMapGridUtil.setStyle(this.styleObj);var e=this.gVMapGridUtil.loadStyle("layer");Promise.all(e).then(function(){this._resetView();this._update()}.bind(this))},addLevels:function(e){this.styleObj[e.levelsKey]=e.levelsData},redraw:function(){this.gVMapGridUtil.formatStyle(this.styleObj,function(){this._map&&(this._removeAllTiles(),this._update())});return this}});l.exports=f},{"./GVMapGrid":24,"./draw/GVMapGridUtil":26}],24:[function(f,l,q){f=L.TileLayer.extend({urlArray:[],sourceUrl:null,textures:{},tileQueue:[],ratio:1,control:null,controlId:null,tilesize:256,initialize:function(e,d){1.5<window.devicePixelRatio&&(this.ratio=2);this.sourceUrl||(this.sourceUrl=e);d&&d.tileSize&&(this.tilesize=d.tileSize);this.gVMapGridUtil=new Custom.GVMapGridUtil;this.gVMapGridUtil.tileSize=this.tilesize;this.gVMapGridUtil.parseUrl(e);this._url=e+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version;L.setOptions(this,d);this.hitDetection=d.hitDetection;this.on("tileunload",this._onTileRemove);this.on("tileload",this._onTileLoad);this.on("tileerror",this._onTileError)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version+"\x26control\x3d"+this.control);this.controlId&&(this._url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version+"\x26controlId\x3d"+this.controlId);this._initContainer();this._levels={};this._tiles={};var e=this.gVMapGridUtil.loadStyle("layer");Promise.all(e).then(function(){this._resetView();this._update()}.bind(this))},createTile:function(e,d){var a=this.tileQueue.pop();a?this._cleanTile(a):a=this.initTile();var b=this.getTileUrl(e);Custom.getJSON({url:b,dataType:"json"}).then(function(b){a.data=b;this._tileOnLoad.apply(this,[d,a])}.bind(this),function(b){this._tileOnError.apply(this,[d,a,b])}.bind(this));return a},getTileUrl:function(e){var d={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};this._map&&!this._map.options.crs.infinite&&(e=this._globalTileRange.max.y-e.y,this.options.tms&&(d.y=e),d["-y"]=e);if(0==this.urlArray.length)return L.Util.template(this._url,L.extend(d,this.options));e=this.urlArray[Math.round(Math.random()*(this.urlArray.length-1))];var a=this._url.split("/mapserver")[1];return L.Util.template(e+"/mapserver"+a,L.extend(d,this.options))},initTile:function(){var e=document.createElement("canvas");e.style.width=this.tilesize+"px";e.style.height=this.tilesize+"px";e.width=this.tilesize;e.height=this.tilesize;var d=e.getContext("2d",{isQuality:!0});e.ctx=d;return e},_onTileRemove:function(e){this.tileQueue.push(e.tile)},_abortLoading:function(){var e,d;for(e in this._tiles)this._tiles[e].coords.z!==this._tileZoom&&(d=this._tiles[e].el,d.complete||L.DomUtil.remove(d))},_onTileLoad:function(e){e=e.tile;this._drawTile(e,e.data);e.complete=!0},_onTileError:function(e){e=e.tile;e.complete=!0;this.tileQueue.push(e)},_tileOnError:function(e,d,a){e(a,d)},_drawTile:function(e,d){var a=e.ctx,b=Math.floor(this._map.getZoom()),a=new DataHolder({layerDataMap:d,ctx:a,ratio:1,control:null,textures:this.gVMapGridUtil.textures,extent:{level:b}});this.gVMapGridUtil.styleFun.call({},a,b)},_cleanTile:function(e){e.ctx.clearRect(0,0,this.tilesize,this.tilesize)},setFilter:function(e){this._url&&e&&(0!=e.layers.length||0!=e.order.length)&&this.gVMapGridUtil.setFilter(e,function(d){d.isIE?(this.controlId=d.id,this.setUrl(this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version+"\x26controlId\x3d"+d.id)):(this.control=d.id,this.setUrl(this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+Custom.Version+"\x26control\x3d"+d.id))}.bind(this))},getFeatureByXY:function(e,d,a){e=this._map.containerPointToLatLng(new L.point(e,d));this.getFeatureByLonlat(e,a)},getFeatureByLonlat:function(e,d){var a=this._map.options.crs.projection.bounds,b=this._map.getBounds(),c=this._map.getPixelBounds(),f=(b._northEast.lat-b._southWest.lat)/(c.max.y-c.min.y),b=this.options.tileSize,c=(a.max.y-e.lat)/(f*b),a=(e.lng-a.min.x)/(f*b),f=this._map.getZoom();this.gVMapGridUtil.pickupFeatures(c,a,f,(a-Math.floor(a))*b,(c-Math.floor(c))*b,this.control,this.controlId,function(a){d(a)})},highlightFeatures:function(e,d){var a=this.gVMapGridUtil.CreateHighlightFilter(e,d);if(0!=a.layers.length){d.color=d.color.replace("#","%23");if(!this.highlightLayer){var b=this.gVMapGridUtil.host+"/mapserver/vmap/"+this.gVMapGridUtil.servername+"/getMAP?x\x3d{x}\x26y\x3d{y}\x26l\x3d{z}\x26styleId\x3d"+this.gVMapGridUtil.styleId;this.control&&(b=b+"\x26control\x3d"+this.control);this.controlId&&(b=b+"\x26controlId\x3d"+this.controlId);this.highlightLayer=new L.GXYZ(b,this.options);this._map.addLayer(this.highlightLayer)}this.highlightLayer.options.opacity=d.opacity;this.highlightLayer._updateOpacity();this.highlightLayer.setFilter(a);this.highlightLayer.setZIndex(this.options.zIndex+1)}},cancelHighlight:function(){this.highlightLayer&&(this._map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});l.exports=f},{}],25:[function(f,l,q){var e=f("./draw/GXYZUtil"),d=f("../../ext/Version");f=L.TileLayer.extend({urlArray:[],sourceUrl:null,gxyzUtil:null,highlightLayer:null,ratio:1,control:null,controlId:null,tilesize:256,initialize:function(a,b){1.5<window.devicePixelRatio&&(this.ratio=2);this.sourceUrl||(this.sourceUrl=a);b&&b.tileSize&&(this.tilesize=b.tileSize);this.gxyzUtil=new e;this.gxyzUtil.tileSize=this.tilesize;this.gxyzUtil.parseUrl(a);this._url=a+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d;L.setOptions(this,b)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26control\x3d"+this.control);this.controlId&&(this._url=this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26controlId\x3d"+this.controlId);this._initContainer();this._levels={};this._tiles={};this._resetView();this._update()},getTileUrl:function(a){var b={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(a),x:a.x,y:a.y,z:this._getZoomForUrl()};this._map&&!this._map.options.crs.infinite&&(a=this._globalTileRange.max.y-a.y,this.options.tms&&(b.y=a),b["-y"]=a);if(0==this.urlArray.length)return L.Util.template(this._url,L.extend(b,this.options));a=this.urlArray[Math.round(Math.random()*(this.urlArray.length-1))];var c=this._url.split("/mapserver")[1];return L.Util.template(a+"/mapserver"+c,L.extend(b,this.options))},setFilter:function(a){this._url&&a&&(0!=a.layers.length||0!=a.order.length)&&this.gxyzUtil.setFilter(a,function(a){a.isIE?(this.controlId=a.id,this.setUrl(this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26controlId\x3d"+a.id)):(this.control=a.id,this.setUrl(this.sourceUrl+"\x26ratio\x3d"+this.ratio+"\x26tilesize\x3d"+this.tilesize+"\x26clientVersion\x3d"+d+"\x26control\x3d"+a.id))}.bind(this))},getFeatureByXY:function(a,b,c){a=this._map.containerPointToLatLng(new L.point(a,b));this.getFeatureByLonlat(a,c)},getFeatureByLonlat:function(a,b){var c=this._map.options.crs.projection.bounds,d=this._map.getBounds(),e=this._map.getPixelBounds(),f=(d._northEast.lat-d._southWest.lat)/(e.max.y-e.min.y),d=this.options.tileSize,e=(c.max.y-a.lat)/(f*d),c=(a.lng-c.min.x)/(f*d),f=this._map.getZoom();this.gxyzUtil.pickupFeatures(e,c,f,(c-Math.floor(c))*d,(e-Math.floor(e))*d,this.control,this.controlId,function(a){b(a)})},highlightFeatures:function(a,b){var c=this.gxyzUtil.CreateHighlightFilter(a,b);0!=c.layers.length&&(b.color=b.color.replace("#","%23"),this.highlightLayer||(this.highlightLayer=new L.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=b.opacity,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(c),this.highlightLayer.setZIndex(this.options.zIndex+1))},highlightEveryFeatures:function(a,b){var c=this.gxyzUtil.CreateEveryHighlightFilter(a);0!=c.layers.length&&(this.highlightLayer||(this.highlightLayer=new L.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=b,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(c),this.highlightLayer.setZIndex(this.options.zIndex+1))},cancelHighlight:function(){this.highlightLayer&&(this._map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});l.exports=f},{"../../ext/Version":3,"./draw/GXYZUtil":27}],26:[function(f,l,q){var e=f("./GXYZUtil");f=f("./../../../utils/es6-promise");var d=f.Deferred,a=f.getJSON;f=function(a){e.call(this);this.textures={};this.isDynamicMap=a;this.styleObj={}};$jscomp.inherits(f,e);f.prototype.setStyle=function(a){this.styleObj=a};f.prototype.formatStyle=function(b,c){this.styleObj=b;var d=JSON.stringify(this.styleObj);a({type:"post",url:this.host+"/mapserver/styleInfo/format.do",data:"styleJson\x3d "+d,dataType:"json"}).then(function(a){this.styleFun=new Function("drawer","level",a.styleJs);c()}.bind(this))};f.prototype.loadStyle=function(b){var c=new d,e=new d;b||(b="label");this.isDynamicMap?(b=JSON.stringify(this.styleObj),a({type:"post",url:"http://127.0.0.1/mapserver/styleInfo/format.do",data:"styleJson\x3d "+b,dataType:"json"}).then(function(a){this.styleFun=new Function("drawer","level",a.styleJs);c.resolve()}.bind(this))):a({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/"+b+"/style.js",dataType:"text"}).then(function(a){this.styleFun=new Function("drawer","level",a);c.resolve()}.bind(this));a({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/label/texture.js",dataType:"text"}).then(function(a){a=JSON.parse(a);var b=0,c;for(c in a)b++;if(0==b)e.resolve();else{var d=0,f;for(f in a)c=new Image,c.name=f,c.onload=function(a){d++;this.textures[a.target.name]=a.target;d==b&&e.resolve()}.bind(this),c.src=a[f]}}.bind(this));return[c,e]};l.exports=f},{"./../../../utils/es6-promise":33,"./GXYZUtil":27}],27:[function(f,l,q){var e=f("./../../../utils/es6-promise").getJSON,d=f("./../../../filter/Filter"),a=f("./../../../filter/FilterLayer"),b=f("../../../ext/Version");f=function(){this.tileSize=256};f.prototype.setFilter=function(a,b){for(var c=0;c<a.layers.length;c++)a.layers[c].id||a.layers.splice(c,1);c=JSON.stringify(a);this.isIE()?e({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control\x3d "+c,dataType:"json"}).then(function(a){a.isIE=!0;b(a)}.bind(this)):b({isIE:!1,id:c})};f.prototype.parseUrl=function(a){a=a.split("?");var b=a[0].split("/mapserver/");this.host=b[0];this.servername=b[1].split("/")[1];a=a[1].split("\x26");for(b=0;b<a.length;b++){var c=a[b].split("\x3d");if("styleId"==c[0]){this.styleId=c[1];break}}};f.prototype.pickupFeatures=function(a,d,f,g,n,k,l,q){a=this.host+"/mapserver/pickup/"+this.servername+"/getData?x\x3d"+d+"\x26y\x3d"+a+"\x26l\x3d"+f+"\x26pixelX\x3d"+g+"\x26pixelY\x3d"+n+"\x26styleId\x3d"+this.styleId+"\x26tilesize\x3d"+this.tileSize+"\x26clientVersion\x3d"+b;k&&(a=a+"\x26control\x3d"+k);l&&(a=a+"\x26controlId\x3d"+l);e({url:a,dataType:"json"}).then(function(a){q(a)},function(){q([])})};f.prototype.CreateHighlightFilter=function(b,e){var c=new d;c.otherDisplay=!1;for(var f in b){var h=b[f],k=!1,l;for(l in h)h=new a,h.id=f,h.idFilter=l,h.color=e,c.addFilterLayer(h),k=!0;k||(h=new a,h.id=f,h.color=e,c.addFilterLayer(h))}return c};f.prototype.CreateEveryHighlightFilter=function(b){var c=new d;c.otherDisplay=!1;for(var e in b){var f=b[e],n=f.style,k=!1,l;for(l in f){k=f[l].style;k.color=k.color.replace("#","%23");var q=new a;q.id=e;q.idFilter=l;q.color=k;c.addFilterLayer(q);k=!0}!k&&n&&(n.color=n.color.replace("#","%23"),q=new a,q.id=e,q.color=n,c.addFilterLayer(q))}return c};f.prototype.isIE=function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1};l.exports=f},{"../../../ext/Version":3,"./../../../filter/Filter":4,"./../../../filter/FilterLayer":5,"./../../../utils/es6-promise":33}],28:[function(f,l,q){f=function(e){this.group={};this.group.id=e;this.group.type="group";this.group.children=[]};f.prototype.addStyle=function(e){this.group.children.push(e.style)};l.exports=f},{}],29:[function(f,l,q){f=function(e,d){this.levelsData=[];this.levelsKey=e+"-"+d};f.prototype.addGroup=function(e){this.levelsData.push(e.group)};f.prototype.addStyleItem=function(e){this.levelsData.push(e.style)};l.exports=f},{}],30:[function(f,l,q){f=function(e,d){this.style={};this.style.id=e;this.style.layer=d;this.style.type="style";this.style.children=[]};f.prototype.queryFilter=function(e,d){e?(this.style.query=e,this.style.fields=d):this.style.query=""};f.prototype.setStyle=function(e){this.style.style=e};f.prototype.addSubStyle=function(e){this.style.children.push(e.style)};l.exports=f},{}],31:[function(f,l,q){f=function(e){this.size=e;this.map={};this.list=[]};f.prototype.push=function(e,d){if(this.list.length>this.size-1){var a=this.list.shift();delete this.map[a]}this.list.push(e);this.map[e]=d};f.prototype.getItem=function(e){return this.map[e]};f.prototype.clean=function(){this.map={};this.list=[]};f.prototype.length=function(){return this.list.length};l.exports=f},{}],32:[function(f,l,q){function e(){this.id=this.createUUID()}e.prototype.valueOf=function(){return this.id};e.prototype.toString=function(){return this.id};e.prototype.createUUID=function(){var d=new Date(1582,10,15,0,0,0,0),a=(new Date).getTime()-d.getTime(),d=e.getIntegerBits(a,0,31),b=e.getIntegerBits(a,32,47),a=e.getIntegerBits(a,48,59)+"2",c=e.getIntegerBits(e.rand(4095),0,7),f=e.getIntegerBits(e.rand(4095),0,7),m=e.getIntegerBits(e.rand(8191),0,7)+e.getIntegerBits(e.rand(8191),8,15)+e.getIntegerBits(e.rand(8191),0,7)+e.getIntegerBits(e.rand(8191),8,15)+e.getIntegerBits(e.rand(8191),0,15);return d+b+a+c+f+m};e.getIntegerBits=function(d,a,b){d=e.returnBase(d,16);var c=[],f="",m;for(m=0;m<d.length;m++)c.push(d.substring(m,m+1));for(m=Math.floor(a/4);m<=Math.floor(b/4);m++)f=c[m]&&""!=c[m]?f+c[m]:f+"0";return f};e.returnBase=function(d,a){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");if(d<a)b=b[d];else var c=""+Math.floor(d/a),e=d-c*a,b=c>=a?this.returnBase(c,a)+b[e]:b[c]+b[e];return b};e.rand=function(d){return Math.floor(Math.random()*d)};l.exports=e},{}],33:[function(f,l,q){(function(e,d){var a=function(){function a(){return function(){return e.nextTick(n)}}function c(){return"undefined"!==typeof W?function(){W(n)}:g()}function h(){var a=0,b=new Z(n),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function m(){var a=new MessageChannel;a.port1.onmessage=n;return function(){return a.port2.postMessage(0)}}function g(){var a=setTimeout;return function(){return a(n,1)}}function n(){for(var a=0;a<I;a+=2)(0,J[a])(J[a+1]),J[a]=void 0,J[a+1]=void 0;I=0}function k(){try{var a=f("vertx");W=a.runOnLoop||a.runOnContext;return c()}catch(aa){return g()}}function l(a,b){var c=arguments,d=this,e=new this.constructor(v);void 0===e[T]&&H(e);var f=d._state;f?function(){var a=c[f-1];F(function(){return S(f,e,a,d._result)})}():N(d,e,a,b);return e}function q(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(v);w(b,a);return b}function v(){}function r(a){try{return a.then}catch(aa){return O.error=aa,O}}function A(a,b,c,d){try{a.call(b,c,d)}catch(ga){return ga}}function G(a,b,c){F(function(a){var d=!1,e=A(c,b,function(c){d||(d=!0,b!==c?w(a,c):z(a,c))},function(b){d||(d=!0,B(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,B(a,e))},a)}function x(a,b){b._state===P?z(a,b._result):b._state===K?B(a,b._result):N(b,void 0,function(b){return w(a,b)},function(b){return B(a,b)})}function u(a,b,c){b.constructor===a.constructor&&c===l&&b.constructor.resolve===q?x(a,b):c===O?(B(a,O.error),O.error=null):void 0===c?z(a,b):"function"===typeof c?G(a,b,c):z(a,b)}function w(a,b){if(a===b)B(a,new TypeError("You cannot resolve a promise with itself"));else{var c=typeof b;null===b||"object"!==c&&"function"!==c?z(a,b):u(a,b,r(b))}}function y(a){a._onerror&&a._onerror(a._result);E(a)}function z(a,b){a._state===M&&(a._result=b,a._state=P,0!==a._subscribers.length&&F(E,a))}function B(a,b){a._state===M&&(a._state=K,a._result=b,F(y,a))}function N(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null;e[f]=b;e[f+P]=c;e[f+K]=d;0===f&&a._state&&F(E,a)}function E(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,h=0;h<b.length;h+=3)d=b[h],e=b[h+c],d?S(c,d,e,f):e(f);a._subscribers.length=0}}function R(){this.error=null}function S(a,b,c,d){var e="function"===typeof c,f=void 0,h=void 0,g=void 0;if(e){if(c=c(d),c===ha?(g=!0,f=c.error,c.error=null):h=!0,b===c){B(b,new TypeError("A promises callback cannot return that same promise."));return}}else c=d,h=!0;b._state===M&&(e&&h?w(b,c):g?B(b,f):a===P?z(b,c):a===K&&B(b,c))}function V(a,b){try{b(function(b){w(a,b)},function(b){B(a,b)})}catch(ea){B(a,ea)}}function H(a){a[T]=ba++;a._state=void 0;a._result=void 0;a._subscribers=[]}function Q(a,b){this._instanceConstructor=a;this.promise=new a(v);this.promise[T]||H(this.promise);ca(b)?(this._remaining=this.length=b.length,this._result=Array(this.length),0===this.length?z(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&z(this.promise,this._result))):B(this.promise,Error("Array Methods must be provided an Array"))}function C(a){this[T]=ba++;this._result=this._state=void 0;this._subscribers=[];if(v!==a){if("function"!==typeof a)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof C)V(this,a);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}}var X=void 0,ca=X=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},I=0,W=void 0,Y=void 0,F=function(a,b){J[I]=a;J[I+1]=b;I+=2;2===I&&(Y?Y(n):da())},U=(X="undefined"!==typeof window?window:void 0)||{},Z=U.MutationObserver||U.WebKitMutationObserver,U="undefined"===typeof self&&"undefined"!==typeof e&&"[object process]"==={}.toString.call(e),ia="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,J=Array(1E3),da=void 0,da=U?a():Z?h():ia?m():void 0===X&&"function"===typeof f?k():g(),T=Math.random().toString(36).substring(16),M=void 0,P=1,K=2,O=new R,ha=new R,ba=0;Q.prototype._enumerate=function(a){for(var b=0;this._state===M&&b<a.length;b++)this._eachEntry(a[b],b)};Q.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;d===q?(d=r(a),d===l&&a._state!==M?this._settledAt(a._state,b,a._result):"function"!==typeof d?(this._remaining--,this._result[b]=a):c===C?(c=new c(v),u(c,a,d),this._willSettleAt(c,b)):this._willSettleAt(new c(function(b){return b(a)}),b)):this._willSettleAt(d(a),b)};Q.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===M&&(this._remaining--,a===K?B(d,c):this._result[b]=c);0===this._remaining&&z(d,this._result)};Q.prototype._willSettleAt=function(a,b){var c=this;N(a,void 0,function(a){return c._settledAt(P,b,a)},function(a){return c._settledAt(K,b,a)})};C.all=function(a){return(new Q(this,a)).promise};C.race=function(a){var b=this;return ca(a)?new b(function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}):new b(function(a,b){return b(new TypeError("You must pass an array to race."))})};C.resolve=q;C.reject=function(a){var b=new this(v);B(b,a);return b};C._setScheduler=function(a){Y=a};C._setAsap=function(a){F=a};C._asap=F;C.prototype={constructor:C,then:l,"catch":function(a){return this.then(null,a)}};C.polyfill=function(){var a=void 0;if("undefined"!==typeof d)a=d;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(fa){throw Error("polyfill failed because global object is unavailable in this environment");}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(fa){}if("[object Promise]"===c&&!b.cast)return}a.Promise=C};return C.Promise=C}().Promise;l.exports={Promise:a,Deferred:function(){this.promise=new a(function(a,c){this.resolve=a;this.reject=c}.bind(this));this.then=this.promise.then.bind(this.promise);this["catch"]=this.promise["catch"].bind(this.promise)},getJSON:function(b){b.type||(b.type="GET");b.dataType||(b.dataType="json");return new a(function(a,d){var c=new XMLHttpRequest;c.overrideMimeType&&c.overrideMimeType("text/html");c.open(b.type,b.url);c.onreadystatechange=function(){if(this.readyState===this.DONE)if(200===this.status){var c=this.responseText;"json"==b.dataType&&"string"==typeof c&&(c=JSON.parse(c));a(c)}else d(Error("getJSON: "+b.url+" failed with status: ["+this.status+"]"))};c.responseType="text";"GET"==b.type.toUpperCase()&&c.setRequestHeader("Content-Type","text/plain; charset\x3dutf-8");"POST"==b.type.toUpperCase()&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(b.data)})},getParamJSON:function(b){b.type||(b.type="GET");b.dataType||(b.dataType="json");var c=new XMLHttpRequest,d=new a(function(a,d){c.overrideMimeType&&c.overrideMimeType("text/html");var e=!1;setTimeout(function(){"200"!=c.status&&(e=!0,c.abort())},3E4);c.open(b.type,b.url);c.onreadystatechange=function(){if(e)d({param:b,data:"getParamJSON: "+b.url+" timeout"});else if(this.readyState===this.DONE)if(200===this.status){var c=this.responseText;"json"==b.dataType&&"string"==typeof c&&(c=JSON.parse(c));a({param:b,data:c})}else d({param:b,data:"getParamJSON: "+b.url+" failed with status: ["+this.status+"]"})};c.responseType="text";"GET"==b.type.toUpperCase()&&c.setRequestHeader("Content-Type","text/plain; charset\x3dutf-8");"POST"==b.type.toUpperCase()&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(b.data)});d.xhr=c;return d}}}).call(this,f("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{_process:36}],34:[function(f,l,q){var e=function(d,a,b,c,f,m){f=5*f/100;this.left=d-f;this.right=a+f;this.bottom=b-f;this.top=c+f;this.previous=e.createEmptyDoubleArray();this.now=e.createEmptyDoubleArray();this.question=e.createEmptyDoubleArray();this.point_question_quadrant=this.point_now_quadrant=this.point_previous_quadrant=-1};e.createEmptyDoubleArray=function(){return[NaN,NaN]};e.prototype.copy=function(d,a){a[0]=d[0];a[1]=d[1]};e.isEmpty=function(d){return null==d?!0:isNaN(d[0])||isNaN(d[1])?!0:!1};e.prototype.isQuadrant=function(d){var a=d[0];d=d[1];return a<this.left?d>this.top?8:d<this.bottom?2:1:a>this.right?d>this.top?6:d<this.bottom?4:5:d>this.top?7:d<this.bottom?3:9};e.prototype.passrule=function(d,a){return 1==d?1==a||2==a||8==a?2:1:2==d?1==a||2==a||8==a||3==a||4==a?2:1:3==this.point_previous_quadrant?2==this.point_now_quadrant||3==this.point_now_quadrant||4==this.point_now_quadrant?2:1:4==d?2==a||3==a||4==a||5==a||6==a?2:1:5==d?4==a||5==a||6==a?2:1:6==d?4==a||5==a||6==a||7==a||8==a?2:1:7==d?6==a||7==a||8==a?2:1:8==d?6==a||7==a||8==a||1==a||2==a?2:1:1};e.prototype.reset=function(){this.previous[0]=NaN;this.previous[1]=NaN;this.question[0]=NaN;this.question[1]=NaN;this.now[0]=NaN;this.now[1]=NaN;this.point_question_quadrant=this.point_now_quadrant=this.point_previous_quadrant=-1};e.prototype["in"]=function(d){return d[0]<this.left||d[0]>this.right||d[1]<this.bottom||d[1]>this.top?!1:!0};e.length=function(d,a,b,c){d=b-d;a=c-a;return Math.sqrt(d*d+a*a)};e.prototype.push=function(d,a){this.now[0]=d;this.now[1]=a;if(e.isEmpty(this.previous))return this.copy(this.now,this.previous),this.point_previous_quadrant=this.isQuadrant(this.now),[this.now];this.point_now_quadrant=this.isQuadrant(this.now);var b=this.passrule(this.point_previous_quadrant,this.point_now_quadrant);if(1==b){this.point_previous_quadrant=this.isQuadrant(this.now);this.copy(this.now,this.previous);if(e.isEmpty(this.question))return[this.now];b=[];this.copy(this.question,b);this.question=e.createEmptyDoubleArray();return[b,this.now]}if(2==b){if(!e.isEmpty(this.question)&&(b=this.passrule(this.point_question_quadrant,this.point_now_quadrant),1==b))return b=[],this.copy(this.question,b),this.question=e.createEmptyDoubleArray(),[b,this.now];this.copy(this.now,this.question);this.point_question_quadrant=this.point_now_quadrant}return null};l.exports=e},{}],35:[function(f,l,q){var e=function(){};e.pointDistToLine=function(d,a,b,c,e,f){var h=((d-b)*(e-b)+(a-c)*(f-c))/((b-e)*(b-e)+(c-f)*(c-f));b+=h*(e-b);c+=h*(f-c);return Math.sqrt((d-b)*(d-b)+(a-c)*(a-c))};e.isPointOnSegment=function(d,a,b,c,f,m){return d-3>b&&d+3>f||d+3<b&&d-3<f||a-3>c&&a+3>m||a+3<c&&a-3<m?0:3>e.pointDistToLine(d,a,b,c,f,m)?1:0};e.pointInLine=function(d,a,b){var c=[];Array.isArray(b[0])?c=b:c.push(b);for(b=0;b<c.length;b++)for(var f=c[b],m=f.length/2,g=0;g<m-1;g++){var l;l=g+1;if(1==e.isPointOnSegment(d,a,f[2*g],f[2*g+1],f[2*l],f[2*l+1]))return 1}return 0};e.pointInPolygon=function(d,a,b){var c=0,e=[];Array.isArray(b[0])?e=b:e.push(b);for(b=0;b<e.length;b++)for(var f=e[b],g=0,l=f.length/2,k=l-1;g<l;k=g,g++){var p=f[2*g],q=f[2*g+1],v=f[2*k],k=f[2*k+1];if(p===d&&q===a||v===d&&k===a)return 1;if(q<a&&k>=a||q>=a&&k<a){p+=(a-q)*(v-p)/(k-q);if(p===d)return 1;p>d&&(c=!c)}}return c?1:0};e.lineIntersects=function(d,a,b,c,e,f,g,l){var h,m,n,q,r=[null,null];h=(l-f)*(b-d)-(g-e)*(c-a);if(0===h)return null!==r[0]&&null!==r[1]?r:!1;m=a-f;n=d-e;q=(b-d)*m-(c-a)*n;m=((g-e)*m-(l-f)*n)/h;n=q/h;r[0]=d+m*(b-d);r[1]=a+m*(c-a);return 0<n&&1>n?r:!1};e.polyWith=function(d,a){for(var b=d.length/2,c=a.length/2,f,l,g,n,k,p,q,v,r=0;r<b;r++){r!=b-1?(l=d[2*r],g=d[2*r+1],n=d[2*r+2],f=d[2*r+3]):(l=d[2*r],g=d[2*r+1],n=d[0],f=d[1]);for(var A=0;A<c;A++)if(A!=c-1?(p=a[2*A],q=a[2*A+1],v=a[2*A+2],k=a[2*A+3]):(p=a[2*A],q=a[2*A+1],v=a[0],k=a[1]),0!=e.lineIntersects(l,g,n,f,p,q,v,k))return 1}return e.pointInPolygon(a[0],a[1],d)?2:3};e.boxToPolyArr=function(d,a,b,c){var e=[];e.push(d);e.push(a);e.push(d);e.push(c);e.push(b);e.push(c);e.push(b);e.push(a);e.push(d);e.push(a);return e};e.getExtensionPoint=function(d,a,b){var c=a[0]-d[0],e=a[1]-d[1];d=a[0];0==c?a=0<e?a[1]+b:a[1]-b:(b=Math.sqrt(b*b/(e/c*(e/c)+1)),0>c&&(b=-b),d=a[0]+b,a=a[1]+e/c*b);return[d,a]};l.exports=e},{}],36:[function(f,l,q){function e(){throw Error("setTimeout has not been defined");}function d(){throw Error("clearTimeout has not been defined");}function a(a){if(n===setTimeout)return setTimeout(a,0);if((n===e||!n)&&setTimeout)return n=setTimeout,setTimeout(a,0);try{return n(a,0)}catch(G){try{return n.call(null,a,0)}catch(x){return n.call(this,a,0)}}}function b(a){if(k===clearTimeout)return clearTimeout(a);if((k===d||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(a);try{return k(a)}catch(G){try{return k.call(null,a)}catch(x){return k.call(this,a)}}}function c(){t&&v&&(t=!1,v.length?p=v.concat(p):r=-1,p.length&&h())}function h(){if(!t){var d=a(c);t=!0;for(var e=p.length;e;){v=p;for(p=[];++r<e;)v&&v[r].run();r=-1;e=p.length}v=null;t=!1;b(d)}}function m(a,b){this.fun=a;this.array=b}function g(){}f=l.exports={};var n,k;try{n="function"===typeof setTimeout?setTimeout:e}catch(A){n=e}try{k="function"===typeof clearTimeout?clearTimeout:d}catch(A){k=d}var p=[],t=!1,v,r=-1;f.nextTick=function(b){var c=Array(arguments.length-1);if(1<arguments.length)for(var d=1;d<arguments.length;d++)c[d-1]=arguments[d];p.push(new m(b,c));1!==p.length||t||a(h)};m.prototype.run=function(){this.fun.apply(null,this.array)};f.title="browser";f.browser=!0;f.env={};f.argv=[];f.version="";f.versions={};f.on=g;f.addListener=g;f.once=g;f.off=g;f.removeListener=g;f.removeAllListeners=g;f.emit=g;f.prependListener=g;f.prependOnceListener=g;f.listeners=function(a){return[]};f.binding=function(a){throw Error("process.binding is not supported");};f.cwd=function(){return"/"};f.chdir=function(a){throw Error("process.chdir is not supported");};f.umask=function(){return 0}},{}]},{},[6])(6)});