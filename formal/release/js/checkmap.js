!function(e){var a={};function t(n){if(a[n])return a[n].exports;var s=a[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var s in e)t.d(n,s,function(a){return e[a]}.bind(null,s));return n},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="./",t(t.s=0)}([function(e,a){navigator.userAgent.toLowerCase().indexOf("dingtalk")>-1&&document.writeln('<script src="https://appx/web-view.min.js"><\/script>');var t,n,s,o,i,r,c,l,d,m,u,p,v,f,y,g,k,C,b=10,_=[],T=document.getElementById("picker-btn");function h(){_.forEach(function(e,a){var t;switch(e.checkState){case"1":t=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"green-marker",html:"<p>"+(a+1)+"</p>"})});break;case"2":t=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"blue-marker",html:"<p>"+(a+1)+"</p>"})});break;case"3":t=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"red-marker",html:"<p>"+(a+1)+"</p>"})})}s.addLayer(t),t.on("click",function(e){$(".detail_info").hasClass("active")&&$(".detail_info").removeClass("active"),i=parseInt(e.originalEvent.target.textContent)-1,function(e){var a=encodeURI("https://dh.ditu.zj.cn:9443/inverse/getInverseGeocoding.jsonp?&detail=1&zoom=11&latlon="+e.lon+","+e.lat+"&lat=&lon=&customer=2");$.ajax({url:a,dataType:"jsonp",success:function(a){var t=a.city.value+a.dist.value+a.town.value+a.poi;$(".legalEntity_name").text(e.legalEntityName),$(".legalRep_name").text(e.legalRep),$(".legalRep_tel").text(e.tel),$(".address_info").text(t),$(".distance_info").text((parseInt(e.distance)/1e3).toFixed(2)),$(".call_tel").data("tel",e.tel),o={longitude:e.lon,latitude:e.lat,name:a.poi,address:a.poi},$(".detail_info").addClass("active")},error:function(e){dd.alert({content:"地址解析出错"})}})}(_[i])})})}dd.postMessage({type:"init"}),dd.onMessage=function(e){t={lon:e.lon,lat:e.lat}||{lon:120.14989,lat:30.27751},e.cityName||"杭州市",_=e.markDatas,r=e.filterDatas,function(e){if(e)return void function(){n=L.map("map",{crs:L.CRS.CustomEPSG4326,center:t,minZoom:5,zoom:b,inertiaDeceleration:15e3,zoomControl:!1});var e=new L.GXYZ("https://ditu.zjzwfw.gov.cn/mapserver/vmap/zjvmap/getMAP?x={x}&y={y}&l={z}&styleId=tdt_biaozhunyangshi_2017",{tileSize:512,minZoom:5});n.addLayer(e);var a=new L.GXYZ("https://ditu.zjzwfw.gov.cn/mapserver/label/zjvmap/getImg?x={x}&y={y}&l={z}&styleId=tdt_biaozhunyangshi_2017",{tileSize:512,hitDetection:!0,keepBuffer:0,updateWhenZooming:!1});n.addLayer(a),s=L.markerClusterGroup(),h(),n.addLayer(s),function(){var e="",a="",t="",n="";$.each(r.marketType,function(a,t){e+='<dd data-paramCode="'+t.paramCode+'" data-paramCodeType="'+t.paramCodeType+'">'+t.paramName+"</dd>"}),$.each(r.checkType,function(e,t){a+='<dd data-paramCode="'+t.paramCode+'" data-paramCodeType="'+t.paramCodeType+'">'+t.paramName+"</dd>"}),$.each(r.taskStatus,function(e,a){t+='<dd data-paramCode="'+a.paramCode+'" data-paramCodeType="'+a.paramCodeType+'">'+a.paramName+"</dd>"}),$.each(r.superviseTag,function(e,a){n+='<dd data-paramCode="'+a.paramCode+'" data-paramCodeType="'+a.paramCodeType+'">'+a.paramName+"</dd>"}),$("#MARKET_TYPE").html(e),$("#TASK_TYPE").html(a),$("#TASK_STATUS").html(t),$("#SUPERVISE_TAG").html(n),$(".filter_list dd").on("click",function(e){$(this).siblings().removeClass("active"),$(this).addClass("active");var a=$(e.target)[0].dataset.paramcodetype;switch(a){case"MARKET_TYPE":m=$(e.target)[0].dataset.paramcode;break;case"TASK_TYPE":p=$(e.target)[0].dataset.paramcode;break;case"TASK_STATUS":l=$(e.target)[0].dataset.paramcode;break;case"SUPERVISE_TAG":f=$(e.target)[0].dataset.paramcode}})}(),c={},$.each(r.SlicenoLDNameJson,function(e,a){var t=a.addressName;c[t]=[],a.codeAddress&&$.each(a.codeAddress,function(e,a){c[t].push(a.addressName)})}),n.on("click",function(e){$(".detail_info").hasClass("active")&&$(".detail_info").removeClass("active")})}();s.clearLayers(),n.setView([Number(t.lat),Number(t.lon)],b),h()}(e.init)},$(".filterBtn").on("click",function(){$(".custom-mask").addClass("custom-mask--visible"),$(".custom-container").addClass("custom-container--visible"),$(".custom-container li").addClass("active")}),$(".custom-mask").on("click",function(){$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").hasClass("active")?($(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active")):($(".custom-container").removeClass("custom-container--visible"),$(".custom-container li").removeClass("active"))}),$(".custom-container").on("click",function(e){$(".custom-mask").removeClass("custom-mask--visible"),$(".custom-container").removeClass("custom-container--visible"),$(".custom-container li").removeClass("active");var a=$(e.target).data("metter");""==a?$(".filterBtn span").html('不限<i class="icon-arrow"></i>'):$(".filterBtn span").html(a+'<i class="icon-arrow"></i>'),dd.postMessage({type:"distance",val:a})}),$(".floating_box").on("click",function(e){if($(this).addClass("active"),$(".custom-mask").addClass("custom-mask--visible"),$(".filter_list_box").addClass("active"),d){$("#TASK_STATUS dd").removeClass("active");var a=jQuery.makeArray($("#TASK_STATUS dd"));$.each(a,function(e,a){if(a.dataset.paramcode==l)return $(a).addClass("active"),!0})}else $("#TASK_STATUS dd").removeClass("active");if(C?($("#picker-btn").text(g.join("-")),$("#picker-btn").addClass("active")):($("#picker-btn").text("管辖单位|片区"),$("#picker-btn").removeClass("active")),u){$("#MARKET_TYPE dd").removeClass("active");a=jQuery.makeArray($("#MARKET_TYPE dd"));$.each(a,function(e,a){if(a.dataset.paramcode==m)return $(a).addClass("active"),!0})}else $("#MARKET_TYPE dd").removeClass("active");if(v){$("#TASK_TYPE dd").removeClass("active");a=jQuery.makeArray($("#TASK_TYPE dd"));$.each(a,function(e,a){if(a.dataset.paramcode==p)return $(a).addClass("active"),!0})}else $("#TASK_TYPE dd").removeClass("active");if(y){$("#SUPERVISE_TAG dd").removeClass("active");a=jQuery.makeArray($("#SUPERVISE_TAG dd"));$.each(a,function(e,a){if(a.dataset.paramcode==f)return $(a).addClass("active"),!0})}else $("#SUPERVISE_TAG dd").removeClass("active")}),$(".custom-mask").on("touchmove",function(e){e.preventDefault()}),$(".custom-container").on("touchmove",function(e){e.preventDefault()}),$(".iptSearch").on("keydown",function(e){13==e.keyCode&&dd.postMessage({type:"keyword",val:e.target.value||""})}),$(".btn_handler_box li").on("click",function(e){var a=$(e.target).data("filter");""!=a&&"1"!=a&&"2"!=a&&"3"!=a?"reset"!=a||n.setView([Number(t.lat),Number(t.lon)],b):dd.postMessage({type:"checkState",val:a})}),$(".call_tel").on("click",function(){var e=$(".call_tel").data("tel");dd.postMessage({type:"callPhone",val:e})}),$(".menu_icon_3").on("click",function(){dd.postMessage({type:"openMap",val:o})}),$(".detail").on("click",function(){dd.postMessage({type:"detail",val:i})}),$(".gocheck").on("click",function(){dd.postMessage({type:"gocheck",val:i})}),$(".unfind").on("click",function(){dd.postMessage({type:"unfind",val:i})}),$(".reset_btn").on("click",function(){g=[],k=[],T.innerText="管辖单位|片区",$(".filter_type dd").removeClass("active"),$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active"),d="",u="",v="",y="";dd.postMessage({type:"businessDistrict",val:{taskStatus:"",businessDistrict:"",legalEntityCata:"",checkType:"",legalEntityTag:""}})}),$(".confirm_btn").on("click",function(){C=k?k.join(","):"";var e={taskStatus:d=l||"",businessDistrict:C,legalEntityCata:u=m||"",checkType:v=p||"",legalEntityTag:y=f||""};$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active"),dd.postMessage({type:"businessDistrict",val:e})}),T.onclick=function(){new PickerView({bindElem:T,data:c,title:"片区/商圈",leftText:"取消",rightText:"确定",rightFn:function(e){var a;g=[],k=[];var t=r.SlicenoLDNameJson.findIndex(function(a){return a.addressName==e[0]});if(k.push(r.SlicenoLDNameJson[t].code),e[1]){g=e;var n=(a=r.SlicenoLDNameJson[t].codeAddress).findIndex(function(a){return a.addressName==e[1]});k.push(a[n].code)}else g.push(e[0]);T.innerText=g.join("-"),T.setAttribute("class","active")}})}}]);