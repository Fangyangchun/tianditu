!function(e){var t={};function a(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(i,s,function(t){return e[t]}.bind(null,s));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="./",a(a.s=0)}([function(e,t){navigator.userAgent.toLowerCase().indexOf("dingtalk")>-1&&document.writeln('<script src="https://appx/web-view.min.js"><\/script>');var a,i,s,n,o,c,l,r,d,m,u,p,v,f,g,b,h,y,C,k,_,T,x,A,S,N,M,w,D=[],I=[],E=[],j=[],P=16,z=[],G=[],K=[],U=[],R=[],Y=document.getElementById("picker-btn"),O=document.getElementById("district-btn");function B(e){var t="",a=[];a=e?D:E,$.each(a,function(a,i){i.paramCode!=S||e?t+='<dd data-paramCode="'+i.paramCode+'" data-paramCode1="'+i.paramCode1+'" data-paramCode2="'+i.paramCode2+'" data-paramName="'+i.paramName+'">'+i.paramName+"</dd>":t+='<dd class="active" data-paramCode="'+i.paramCode+'" data-paramCode1="'+i.paramCode1+'" data-paramCode2="'+i.paramCode2+'" data-paramName="'+i.paramName+'">'+i.paramName+"</dd>"}),$("#Large_TAG").html(t),$(".large_tag_box").css("display","block"),$("#Large_TAG dd").on("click",function(){$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active");var e=$(this).data("paramcode");N=e,w=$(this).data("paramname"),x="",_="",$(".tagInfo").text(w),dd.postMessage({type:"smallTag",val:e})})}function J(e){var t=[];if((t=e?I:j).length>0){var a="";$.each(t,function(t,i){i.tagCode!=T||e?a+='<dd data-tagCode="'+i.tagCode+'" data-tagName="'+i.tagName+'">'+i.tagName+"</dd>":a+='<dd class="active" data-tagCode="'+i.tagCode+'" data-tagName="'+i.tagName+'">'+i.tagName+"</dd>"}),$("#SMALL_TAG").html(a),$(".small_tag_box").css("display","block"),$("#SMALL_TAG dd").on("click",function(){$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active");var e=$(this).data("tagcode");_=e,x=$(this).data("tagname"),$(".tagInfo").text(x)})}else $("#SMALL_TAG").html(""),$(".small_tag_box").css("display","none")}function V(){f={},$.each(u.DistrictJson,function(e,t){var a=t.name;f[a]=["全部"],t.children&&$.each(t.children,function(e,t){f[a].push(t.name)})})}function Z(){z.forEach(function(e,t){var a;switch(e.checkState){case"1":a=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"green-marker",html:"<p>"+(t+1)+"</p>"})});break;case"2":a=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"blue-marker",html:"<p>"+(t+1)+"</p>"})});break;case"3":a=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"red-marker",html:"<p>"+(t+1)+"</p>"})})}r.addLayer(a),a.on("click",function(e){$(".detail_info").hasClass("active")&&$(".detail_info").removeClass("active"),m=parseInt(e.originalEvent.target.textContent)-1,function(e){var t=encodeURI("https://dh.ditu.zj.cn:9443/inverse/getInverseGeocoding.jsonp?&detail=1&zoom=11&latlon="+e.lon+","+e.lat+"&lat=&lon=&customer=2");$.ajax({url:t,dataType:"jsonp",success:function(t){var a=t.city.value+t.dist.value+t.town.value+t.poi;$(".legalEntity_name").text(e.legalEntityName),$(".legalRep_name").text(e.legalRep),$(".legalRep_tel").text(e.tel),$(".address_info").text(a),$(".distance_info").text((parseInt(e.distance)/1e3).toFixed(2)),$(".call_tel").data("tel",e.tel),d={longitude:e.lon,latitude:e.lat,name:t.poi,address:t.poi},$(".detail_info").addClass("active")},error:function(e){dd.alert({content:"地址解析出错"})}})}(z[m])})})}dd.postMessage({type:"init"}),dd.onMessage=function(e){switch(e.dataType){case"init":dd.postMessage({type:"init"});break;case"render":e.userId,e.token,e.baseUrl,e.tagAction,n={lon:e.lon,lat:e.lat},e.cityName||"杭州市",z=e.markDatas,u=e.filterDatas,p=e.userLevel,e.showDistrict,a=e.tagLineData,function(){o=L.map("map",{crs:L.CRS.CustomEPSG4326,center:n,minZoom:5,zoom:P,inertiaDeceleration:15e3,zoomControl:!1});var e=new L.GVMapGrid("https://ditu.zjzwfw.gov.cn/mapserver/data/zjvmap/getData?x={x}&y={y}&l={z}&styleId=tdt_biaozhunyangshi_2017",{tileSize:512,maxZoom:21,keepBuffer:0,updateWhenZooming:!1});o.addLayer(e);var t=new L.GXYZ("https://ditu.zjzwfw.gov.cn/mapserver/label/zjvmap/getImg?x={x}&y={y}&l={z}&styleId=tdt_biaozhunyangshi_2017",{tileSize:512,hitDetection:!0,keepBuffer:0,updateWhenZooming:!1});o.addLayer(t);var s=L.icon({iconUrl:"../img/indoor_pub_poi_pressed.png",iconSize:[21,30],iconAnchor:[10,20]});c=L.marker([o.getCenter().lat,o.getCenter().lng],{draggable:!1,opacity:1,icon:s}),o.addLayer(c),r=L.markerClusterGroup(),Z(),o.addLayer(r),$(".whiteBtn").addClass("active"),$(".check_title .check_title-txt").text($(".whiteBtn").data("title")),$(".check_title").fadeIn(),function(){var e="",t="",s="",n="";$.each(u.marketType,function(t,a){e+='<dd data-paramCode="'+a.paramCode+'" data-paramCodeType="'+a.paramCodeType+'">'+a.paramName+"</dd>"}),$.each(u.checkType,function(e,a){t+='<dd data-paramCode="'+a.paramCode+'" data-paramCodeType="'+a.paramCodeType+'">'+a.paramName+"</dd>"}),$.each(u.taskStatus,function(e,t){s+='<dd data-paramCode="'+t.paramCode+'" data-paramCodeType="'+t.paramCodeType+'">'+t.paramName+"</dd>"}),$.each(a,function(e,t){n+='<dd data-dutyDeptCode="'+t.dutyDeptCode+'">'+t.dutyDeptName+"</dd>"}),$("#MARKET_TYPE").html(e),$("#TASK_TYPE").html(t),$("#TASK_STATUS").html(s),$("#SUP_TAG_LINE").html(n),$(".filter_list dd").on("click",function(e){$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active");var t=$(e.target)[0].dataset.paramcodetype;switch(t){case"MARKET_TYPE":h=$(e.target)[0].dataset.paramcode;break;case"TASK_TYPE":C=$(e.target)[0].dataset.paramcode;break;case"TASK_STATUS":g=$(e.target)[0].dataset.paramcode}}),$("#SUP_TAG_LINE dd").on("click",function(){i=$(this).data("dutydeptcode"),dutyDeptCodeName=$(this).text(),$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active"),_="",x="",N="",w="",$(".large_tag_box").css("display","none"),$(".small_tag_box").css("display","none"),$(".tagInfo").text(dutyDeptCodeName),$(".tagInfo-box").css("display","block"),dd.postMessage({type:"superTag",val:i})})}(),p?(Y.style.display="-webkit-box",v={},$.each(u.SlicenoLDNameJson,function(e,t){var a=t.name;v[a]=[],t.children&&$.each(t.children,function(e,t){v[a].push(t.name)})})):(O.style.display="-webkit-box",V());o.on("click",function(e){$(".detail_info").hasClass("active")&&$(".detail_info").removeClass("active")})}();break;case"updateMarks":z=e.markDatas,r.clearLayers(),o.setView([Number(n.lat),Number(n.lon)],P),Z();break;case"showDistrict":e.showDistrict&&(u=e.filterDatas,O.style.display="-webkit-box",V());break;case"queryLargeTag":D=e.largeTagData,B(!0);break;case"querySmallTag":I=e.smallTagData,J(!0);break;case"location":n.lat=e.lat,n.lon=e.lon,$(".check_title").fadeOut(),$(".btn_type_box li").removeClass("active"),r.clearLayers(),o.setView([Number(n.lat),Number(n.lon)],P),l?l.setLatLng([Number(n.lat),Number(n.lon)]):(l=L.circle([Number(n.lat),Number(n.lon)],60,{color:"rgba(255, 255, 255, 0)",fillColor:"#3296FA"}),o.addLayer(l)),c.unbindTooltip().setLatLng([Number(n.lat),Number(n.lon)]),function(e){$.ajax({url:encodeURI("https://dh.ditu.zj.cn:9443/inverse/getInverseGeocoding.jsonp?&detail=1&zoom=11&latlon="+e.lon+","+e.lat+"&lat=&lon=&customer=2"),dataType:"jsonp",success:function(e){c.bindTooltip(e.city.value+e.dist.value+e.town.value+e.poi,{offset:[0,10],direction:"bottom"}).openTooltip()},error:function(e){dd.alert({content:"地址解析出错"})}})}({lon:e.lon,lat:e.lat})}},$(".filterBtn").on("click",function(){$(".custom-mask").addClass("custom-mask--visible"),$(".custom-container").addClass("custom-container--visible"),$(".custom-container li").addClass("active")}),$(".clear-txt").on("click",function(){$(".check_title").fadeOut()}),$(".custom-mask").on("click",function(){$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").hasClass("active")?($(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active")):($(".custom-container").removeClass("custom-container--visible"),$(".custom-container li").removeClass("active"))}),$(".custom-container").on("click",function(e){$(".custom-mask").removeClass("custom-mask--visible"),$(".custom-container").removeClass("custom-container--visible"),$(".custom-container li").removeClass("active");var t=$(e.target).data("metter");""==t?$(".filterBtn span").html('不限<i class="icon-arrow"></i>'):$(".filterBtn span").html(t+'<i class="icon-arrow"></i>'),dd.postMessage({type:"distance",val:t})}),$(".floating_box").on("click",function(e){if($(this).addClass("active"),$(".custom-mask").addClass("custom-mask--visible"),$(".filter_list_box").addClass("active"),b){$("#TASK_STATUS dd").removeClass("active");var t=jQuery.makeArray($("#TASK_STATUS dd"));$.each(t,function(e,t){if(t.dataset.paramcode==g)return $(t).addClass("active"),!0})}else $("#TASK_STATUS dd").removeClass("active");if(K.length>0||R.length>0?p?($("#picker-btn").text(G.join("-")),$("#picker-btn").addClass("active"),U&&($("#district-btn").text(U.join("-")),$("#district-btn").addClass("active"))):($("#district-btn").text(U.join("-")),$("#district-btn").addClass("active")):p?($("#picker-btn").text("市|区|县"),$("#picker-btn").removeClass("active"),$("#district-btn").text("商圈/片区"),$("#district-btn").removeClass("active"),$("#district-btn").css("display","none")):($("#district-btn").text("商圈/片区"),$("#district-btn").removeClass("active")),$(".tagInfo-box").css("display","none"),$(".large_tag_box").css("display","none"),$(".small_tag_box").css("display","none"),$("#SUP_TAG_LINE dd").removeClass("active"),S){t=jQuery.makeArray($("#SUP_TAG_LINE dd"));$.each(t,function(e,t){if(t.dataset.dutydeptcode==s)return $(t).addClass("active"),!0}),B(!1),J(!1),T?$(".tagInfo").text(A):$(".tagInfo").text(M),$(".tagInfo-box").css("display","block")}else $(".tagInfo").text(""),$("#Large_TAG").html(""),$("#SMALL_TAG").html("");if(y){$("#MARKET_TYPE dd").removeClass("active");t=jQuery.makeArray($("#MARKET_TYPE dd"));$.each(t,function(e,t){if(t.dataset.paramcode==h)return $(t).addClass("active"),!0})}else $("#MARKET_TYPE dd").removeClass("active");if(k){$("#TASK_TYPE dd").removeClass("active");t=jQuery.makeArray($("#TASK_TYPE dd"));$.each(t,function(e,t){if(t.dataset.paramcode==C)return $(t).addClass("active"),!0})}else $("#TASK_TYPE dd").removeClass("active")}),$(".custom-mask").on("touchmove",function(e){e.preventDefault()}),$(".custom-container").on("touchmove",function(e){e.preventDefault()}),$(".iptSearch").on("keydown",function(e){13==e.keyCode&&dd.postMessage({type:"keyword",val:e.target.value||""})}),$(".search-btn").on("click",function(e){var t=$(".iptSearch").val()||"";dd.postMessage({type:"keyword",val:t})}),$(".btn_type_box li").on("click",function(e){var t=$(e.target).data("filter"),a=$(e.target).data("title");if($(this).closest("li").addClass("active").siblings().removeClass("active"),""==t||"1"==t||"2"==t||"3"==t)return $(".check_title .check_title-txt").text(a),$(".check_title").fadeIn(),void dd.postMessage({type:"checkState",val:t});"reset"!=t||dd.postMessage({type:"location"})}),$(".positioning").on("click",function(e){dd.postMessage({type:"location"})}),$(".call_tel").on("click",function(){var e=$(".call_tel").data("tel");dd.postMessage({type:"callPhone",val:e})}),$(".menu_icon_3").on("click",function(){dd.postMessage({type:"openMap",val:d})}),$(".detail").on("click",function(){dd.postMessage({type:"detail",val:m})}),$(".gocheck").on("click",function(){dd.postMessage({type:"gocheck",val:m})}),$(".unfind").on("click",function(){dd.postMessage({type:"unfind",val:m})}),$(".reset_btn").on("click",function(){[],U=[],R=[],G=[],K=[],$("#picker-btn").text("市|区|县"),$("#district-btn").text("商圈/片区"),p?($("#picker-btn").removeClass("active"),$("#district-btn").removeClass("active"),$("#district-btn").css("display","none")):$("#district-btn").removeClass("active"),$(".filter_type dd").removeClass("active"),$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active"),b="",y="",k="","",_="",N="",x="",w="",i="",A="",M="",T="",S="",E=[],j=[],s="";dd.postMessage({type:"businessDistrict",val:{taskStatus:"",businessDistrict:"",legalEntityCata:"",checkType:"",localAdm:"",curMinTagCode:"",curMaxTagCode:""}})}),$(".confirm_btn").on("click",function(){b=g||"",y=h||"",k=C||"",T=_||"",S=N||"",A=x||"",M=w||"",E=D||[],j=I||[],s=S?i:"";var e={taskStatus:b,legalEntityCata:y,checkType:k,curMinTagCode:T,curMaxTagCode:S};1==K.length?(e.localAdm=K[0],e.businessDistrict=""):0==R.length?(e.localAdm=K[0],e.businessDistrict=""):(e.localAdm=R[0],e.businessDistrict=R[1]||""),$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active"),dd.postMessage({type:"businessDistrict",val:e})}),Y.onclick=function(){new PickerView({bindElem:Y,data:v,title:"市|区|县",leftText:"取消",rightText:"确定",rightFn:function(e){var t;G=[],K=[];var a=u.SlicenoLDNameJson.findIndex(function(t){return t.name==e[0]});K.push(u.SlicenoLDNameJson[a].code),G=e;var i=(t=u.SlicenoLDNameJson[a].children).findIndex(function(t){return t.name==e[1]});K.push(t[i].code),Y.innerText=G.join("-"),Y.setAttribute("class","active"),O.innerText="商圈/片区",O.style.display="none",O.setAttribute("class",""),U=[],R=[],dd.postMessage({type:"showDistrict",val:{localAdm:K[K.length-1],selAll:!1}})}})},O.onclick=function(){new PickerView({bindElem:O,data:f,title:"商圈/片区",leftText:"取消",rightText:"确定",rightFn:function(e){var t;U=[],R=[];var a=u.DistrictJson.findIndex(function(t){return t.name==e[0]});if(R.push(u.DistrictJson[a].code),"全部"!=e[1]){U=e;var i=(t=u.DistrictJson[a].children).findIndex(function(t){return t.name==e[1]});R.push(t[i].code)}else U.push(e[0]);O.innerText=U.join("-"),O.setAttribute("class","active")}})}}]);