!function(e){var a={};function t(s){if(a[s])return a[s].exports;var i=a[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=a,t.d=function(e,a,s){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var i in e)t.d(s,i,function(a){return e[a]}.bind(null,i));return s},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="./",t(t.s=0)}([function(e,a){navigator.userAgent.toLowerCase().indexOf("dingtalk")>-1&&document.writeln('<script src="https://appx/web-view.min.js"><\/script>');var t,s,i,n,o,c,r,l,d,m,u,p,v,f,g,h,b,C,y,k,_,T,x,A,S,M,N,D=[],w=[],I=[],E=[],j=16,P=[],z=[],G=[],K=[],U=[],Y=document.getElementById("picker-btn"),R=document.getElementById("district-btn");function B(e){var a="",t=[];t=e?D:I,$.each(t,function(t,s){s.paramCode!=A||e?a+='<dd data-paramCode="'+s.paramCode+'" data-paramCode1="'+s.paramCode1+'" data-paramCode2="'+s.paramCode2+'" data-paramName="'+s.paramName+'">'+s.paramName+"</dd>":a+='<dd class="active" data-paramCode="'+s.paramCode+'" data-paramCode1="'+s.paramCode1+'" data-paramCode2="'+s.paramCode2+'" data-paramName="'+s.paramName+'">'+s.paramName+"</dd>"}),$("#Large_TAG").html(a),$(".large_tag_box").css("display","block"),$("#Large_TAG dd").on("click",function(){$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active");var e=$(this).data("paramcode");S=e,N=$(this).data("paramname"),T="",k="",$(".tagInfo").text(N),dd.postMessage({type:"smallTag",val:e})})}function O(e){var a=[];if((a=e?w:E).length>0){var t="";$.each(a,function(a,s){s.tagCode!=_||e?t+='<dd data-tagCode="'+s.tagCode+'" data-tagName="'+s.tagName+'">'+s.tagName+"</dd>":t+='<dd class="active" data-tagCode="'+s.tagCode+'" data-tagName="'+s.tagName+'">'+s.tagName+"</dd>"}),$("#SMALL_TAG").html(t),$(".small_tag_box").css("display","block"),$("#SMALL_TAG dd").on("click",function(){$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active");var e=$(this).data("tagcode");k=e,T=$(this).data("tagname"),$(".tagInfo").text(T)})}else $("#SMALL_TAG").html(""),$(".small_tag_box").css("display","none")}function J(){v={},$.each(m.DistrictJson,function(e,a){var t=a.name;v[t]=["全部"],a.children&&$.each(a.children,function(e,a){v[t].push(a.name)})})}function V(){P.forEach(function(e,a){var t;switch(e.checkState){case"1":t=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"green-marker",html:"<p>"+(a+1)+"</p>"})});break;case"2":t=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"blue-marker",html:"<p>"+(a+1)+"</p>"})});break;case"3":t=L.marker([e.lat,e.lon],{draggable:!1,opacity:1,icon:L.divIcon({className:"red-marker",html:"<p>"+(a+1)+"</p>"})})}r.addLayer(t),t.on("click",function(e){$(".detail_info").hasClass("active")&&$(".detail_info").removeClass("active"),d=parseInt(e.originalEvent.target.textContent)-1,function(e){var a=encodeURI("https://dh.ditu.zj.cn:9443/inverse/getInverseGeocoding.jsonp?&detail=1&zoom=11&latlon="+e.lon+","+e.lat+"&lat=&lon=&customer=2");$.ajax({url:a,dataType:"jsonp",success:function(a){var t=a.city.value+a.dist.value+a.town.value+a.poi;$(".legalEntity_name").text(e.legalEntityName),$(".legalRep_name").text(e.legalRep),$(".legalRep_tel").text(e.tel),$(".address_info").text(t),$(".distance_info").text((parseInt(e.distance)/1e3).toFixed(2)),$(".call_tel").data("tel",e.tel),l={longitude:e.lon,latitude:e.lat,name:a.poi,address:a.poi},$(".detail_info").addClass("active")},error:function(e){dd.alert({content:"地址解析出错"})}})}(P[d])})})}dd.postMessage({type:"init"}),dd.onMessage=function(e){switch(e.dataType){case"init":dd.postMessage({type:"init"});break;case"render":e.userId,e.token,e.baseUrl,e.tagAction,n={lon:e.lon,lat:e.lat},e.cityName||"杭州市",P=e.markDatas,m=e.filterDatas,u=e.userLevel,e.showDistrict,t=e.tagLineData,function(){o=L.map("map",{crs:L.CRS.CustomEPSG4326,center:n,minZoom:5,zoom:j,inertiaDeceleration:15e3,zoomControl:!1});var e=new L.GVMapGrid("http://ditu.zjzwfw.gov.cn/mapserver/data/zjvmap/getData?x={x}&y={y}&l={z}&styleId=tdt_biaozhunyangshi_2017",{tileSize:512,maxZoom:21,keepBuffer:0,updateWhenZooming:!1});o.addLayer(e);var a=new L.GXYZ("https://ditu.zjzwfw.gov.cn/mapserver/label/zjvmap/getImg?x={x}&y={y}&l={z}&styleId=tdt_biaozhunyangshi_2017",{tileSize:512,hitDetection:!0,keepBuffer:0,updateWhenZooming:!1});o.addLayer(a);var i=L.icon({iconUrl:"../img/indoor_pub_poi_pressed.png",iconSize:[21,30],iconAnchor:[10,20]}),c=L.marker([o.getCenter().lat,o.getCenter().lng],{draggable:!1,opacity:1,icon:i});o.addLayer(c),r=L.markerClusterGroup(),V(),o.addLayer(r),$(".whiteBtn").addClass("active"),$(".check_title").text($(".whiteBtn").data("title")).fadeIn(),function(){var e="",a="",i="",n="";$.each(m.marketType,function(a,t){e+='<dd data-paramCode="'+t.paramCode+'" data-paramCodeType="'+t.paramCodeType+'">'+t.paramName+"</dd>"}),$.each(m.checkType,function(e,t){a+='<dd data-paramCode="'+t.paramCode+'" data-paramCodeType="'+t.paramCodeType+'">'+t.paramName+"</dd>"}),$.each(m.taskStatus,function(e,a){i+='<dd data-paramCode="'+a.paramCode+'" data-paramCodeType="'+a.paramCodeType+'">'+a.paramName+"</dd>"}),$.each(t,function(e,a){n+='<dd data-dutyDeptCode="'+a.dutyDeptCode+'">'+a.dutyDeptName+"</dd>"}),$("#MARKET_TYPE").html(e),$("#TASK_TYPE").html(a),$("#TASK_STATUS").html(i),$("#SUP_TAG_LINE").html(n),$(".filter_list dd").on("click",function(e){$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active");var a=$(e.target)[0].dataset.paramcodetype;switch(a){case"MARKET_TYPE":h=$(e.target)[0].dataset.paramcode;break;case"TASK_TYPE":C=$(e.target)[0].dataset.paramcode;break;case"TASK_STATUS":f=$(e.target)[0].dataset.paramcode}}),$("#SUP_TAG_LINE dd").on("click",function(){s=$(this).data("dutydeptcode"),dutyDeptCodeName=$(this).text(),$(this).siblings().removeClass("active"),$(this).hasClass("active")||$(this).addClass("active"),k="",T="",S="",N="",$(".large_tag_box").css("display","none"),$(".small_tag_box").css("display","none"),$(".tagInfo").text(dutyDeptCodeName),$(".tagInfo-box").css("display","block"),dd.postMessage({type:"superTag",val:s})})}(),u?(Y.style.display="inline-block",p={},$.each(m.SlicenoLDNameJson,function(e,a){var t=a.name;p[t]=[],a.children&&$.each(a.children,function(e,a){p[t].push(a.name)})})):(R.style.display="inline-block",J());o.on("click",function(e){$(".detail_info").hasClass("active")&&$(".detail_info").removeClass("active")})}();break;case"updateMarks":P=e.markDatas,r.clearLayers(),o.setView([Number(n.lat),Number(n.lon)],j),V();break;case"showDistrict":e.showDistrict&&(m=e.filterDatas,R.style.display="inline-block",J());break;case"queryLargeTag":D=e.largeTagData,B(!0);break;case"querySmallTag":w=e.smallTagData,O(!0);break;case"location":n.lat=e.lat,n.lon=e.lon,$(".check_title").fadeOut(),r.clearLayers(),o.setView([Number(n.lat),Number(n.lon)],j),c?c.setLatLng([Number(n.lat),Number(n.lon)]):c=L.circle([o.getCenter().lat,o.getCenter().lng],{radius:30}),o.addLayer(c)}},$(".filterBtn").on("click",function(){$(".custom-mask").addClass("custom-mask--visible"),$(".custom-container").addClass("custom-container--visible"),$(".custom-container li").addClass("active")}),$(".custom-mask").on("click",function(){$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").hasClass("active")?($(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active")):($(".custom-container").removeClass("custom-container--visible"),$(".custom-container li").removeClass("active"))}),$(".custom-container").on("click",function(e){$(".custom-mask").removeClass("custom-mask--visible"),$(".custom-container").removeClass("custom-container--visible"),$(".custom-container li").removeClass("active");var a=$(e.target).data("metter");""==a?$(".filterBtn span").html('不限<i class="icon-arrow"></i>'):$(".filterBtn span").html(a+'<i class="icon-arrow"></i>'),dd.postMessage({type:"distance",val:a})}),$(".floating_box").on("click",function(e){if($(this).addClass("active"),$(".custom-mask").addClass("custom-mask--visible"),$(".filter_list_box").addClass("active"),g){$("#TASK_STATUS dd").removeClass("active");var a=jQuery.makeArray($("#TASK_STATUS dd"));$.each(a,function(e,a){if(a.dataset.paramcode==f)return $(a).addClass("active"),!0})}else $("#TASK_STATUS dd").removeClass("active");if(G.length>0||U.length>0?u?($("#picker-btn").text(z.join("-")),$("#picker-btn").addClass("active"),K&&($("#district-btn").text(K.join("-")),$("#district-btn").addClass("active"))):($("#district-btn").text(K.join("-")),$("#district-btn").addClass("active")):u?($("#picker-btn").text("市|区|县"),$("#picker-btn").removeClass("active"),$("#district-btn").text("商圈/片区"),$("#district-btn").removeClass("active"),$("#district-btn").css("display","none")):($("#district-btn").text("商圈/片区"),$("#district-btn").removeClass("active")),$(".tagInfo-box").css("display","none"),$(".large_tag_box").css("display","none"),$(".small_tag_box").css("display","none"),$("#SUP_TAG_LINE dd").removeClass("active"),A){a=jQuery.makeArray($("#SUP_TAG_LINE dd"));$.each(a,function(e,a){if(a.dataset.dutydeptcode==i)return $(a).addClass("active"),!0}),B(!1),O(!1),_?$(".tagInfo").text(x):$(".tagInfo").text(M),$(".tagInfo-box").css("display","block")}else $(".tagInfo").text(""),$("#Large_TAG").html(""),$("#SMALL_TAG").html("");if(b){$("#MARKET_TYPE dd").removeClass("active");a=jQuery.makeArray($("#MARKET_TYPE dd"));$.each(a,function(e,a){if(a.dataset.paramcode==h)return $(a).addClass("active"),!0})}else $("#MARKET_TYPE dd").removeClass("active");if(y){$("#TASK_TYPE dd").removeClass("active");a=jQuery.makeArray($("#TASK_TYPE dd"));$.each(a,function(e,a){if(a.dataset.paramcode==C)return $(a).addClass("active"),!0})}else $("#TASK_TYPE dd").removeClass("active")}),$(".custom-mask").on("touchmove",function(e){e.preventDefault()}),$(".custom-container").on("touchmove",function(e){e.preventDefault()}),$(".iptSearch").on("keydown",function(e){13==e.keyCode&&dd.postMessage({type:"keyword",val:e.target.value||""})}),$(".search-btn").on("click",function(e){var a=$(".iptSearch").val()||"";dd.postMessage({type:"keyword",val:a})}),$(".btn_handler_box li").on("click",function(e){var a=$(e.target).data("filter"),t=$(e.target).data("title");if($(this).closest("li").addClass("active").siblings().removeClass("active"),""==a||"1"==a||"2"==a||"3"==a)return $(".check_title").text(t).fadeIn(),void dd.postMessage({type:"checkState",val:a});"reset"!=a||dd.postMessage({type:"location"})}),$(".call_tel").on("click",function(){var e=$(".call_tel").data("tel");dd.postMessage({type:"callPhone",val:e})}),$(".menu_icon_3").on("click",function(){dd.postMessage({type:"openMap",val:l})}),$(".detail").on("click",function(){dd.postMessage({type:"detail",val:d})}),$(".gocheck").on("click",function(){dd.postMessage({type:"gocheck",val:d})}),$(".unfind").on("click",function(){dd.postMessage({type:"unfind",val:d})}),$(".reset_btn").on("click",function(){[],K=[],U=[],z=[],G=[],$("#picker-btn").text("市|区|县"),$("#district-btn").text("商圈/片区"),u?($("#picker-btn").removeClass("active"),$("#district-btn").removeClass("active"),$("#district-btn").css("display","none")):$("#district-btn").removeClass("active"),$(".filter_type dd").removeClass("active"),$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active"),g="",b="",y="","",k="",S="",T="",N="",s="",x="",M="",_="",A="",I=[],E=[],i="";dd.postMessage({type:"businessDistrict",val:{taskStatus:"",businessDistrict:"",legalEntityCata:"",checkType:"",localAdm:"",curMinTagCode:"",curMaxTagCode:""}})}),$(".confirm_btn").on("click",function(){g=f||"",b=h||"",y=C||"",_=k||"",A=S||"",x=T||"",M=N||"",I=D||[],E=w||[],i=A?s:"";var e={taskStatus:g,legalEntityCata:b,checkType:y,curMinTagCode:_,curMaxTagCode:A};1==G.length?(e.localAdm=G[0],e.businessDistrict=""):0==U.length?(e.localAdm=G[0],e.businessDistrict=""):(e.localAdm=U[0],e.businessDistrict=U[1]||""),$(".custom-mask").removeClass("custom-mask--visible"),$(".floating_box").removeClass("active"),$(".filter_list_box").removeClass("active"),dd.postMessage({type:"businessDistrict",val:e})}),Y.onclick=function(){new PickerView({bindElem:Y,data:p,title:"市|区|县",leftText:"取消",rightText:"确定",rightFn:function(e){var a;z=[],G=[];var t=m.SlicenoLDNameJson.findIndex(function(a){return a.name==e[0]});G.push(m.SlicenoLDNameJson[t].code),z=e;var s=(a=m.SlicenoLDNameJson[t].children).findIndex(function(a){return a.name==e[1]});G.push(a[s].code),Y.innerText=z.join("-"),Y.setAttribute("class","active"),R.innerText="商圈/片区",R.style.display="none",R.setAttribute("class",""),K=[],U=[],dd.postMessage({type:"showDistrict",val:{localAdm:G[G.length-1],selAll:!1}})}})},R.onclick=function(){new PickerView({bindElem:R,data:v,title:"商圈/片区",leftText:"取消",rightText:"确定",rightFn:function(e){var a;K=[],U=[];var t=m.DistrictJson.findIndex(function(a){return a.name==e[0]});if(U.push(m.DistrictJson[t].code),"全部"!=e[1]){K=e;var s=(a=m.DistrictJson[t].children).findIndex(function(a){return a.name==e[1]});U.push(a[s].code)}else K.push(e[0]);R.innerText=K.join("-"),R.setAttribute("class","active")}})}}]);